<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orchid Continuum ‚Äî Breeder Assist (Prototype)</title>
    <style>
        :root {
            --primary: #6B3FA0;
            --secondary: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --bg: #1a1a1a;
            --surface: #2d2d2d;
            --text: #ffffff;
            --text-muted: #adb5bd;
            --border: #495057;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg) 0%, #2a2a2a 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 2rem 0;
            background: linear-gradient(135deg, var(--primary) 0%, #8B5CF6 100%);
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: var(--surface);
            border-radius: 10px;
            margin-bottom: 2rem;
            overflow-x: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tab {
            flex: 1;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            border: none;
            background: transparent;
            color: var(--text-muted);
            min-width: 120px;
        }

        .tab:hover {
            background: rgba(255,255,255,0.1);
            color: var(--text);
        }

        .tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(107, 63, 160, 0.3);
        }

        .tab-content {
            background: var(--surface);
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none !important;
        }

        .card {
            background: #3a3a3a;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .card h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #553285;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .slider-group {
            margin-bottom: 1rem;
        }

        .slider {
            width: 100%;
            margin: 0.5rem 0;
        }

        .grid {
            display: grid;
            gap: 1rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-info {
            background: rgba(23, 162, 184, 0.2);
            border-left: 4px solid var(--info);
        }

        .alert-success {
            background: rgba(40, 167, 69, 0.2);
            border-left: 4px solid var(--secondary);
        }

        .alert-warning {
            background: rgba(255, 193, 7, 0.2);
            border-left: 4px solid var(--warning);
            color: var(--text);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .table th,
        .table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }

        .table th {
            background: var(--dark);
            font-weight: 600;
        }

        .table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border);
        }

        .security-badge {
            display: inline-block;
            background: var(--secondary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--surface);
            border-radius: 10px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .performance-stats {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .stat {
            background: var(--dark);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-align: center;
            flex: 1;
            min-width: 120px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .grid-2,
            .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üå∫ Orchid Continuum ‚Äî Breeder Assist</h1>
            <p>Advanced breeding system with privacy controls, predictive modeling, and comprehensive judging</p>
        </div>

        <!-- Main Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="projects">üîê Projects</button>
            <button class="tab" data-tab="collection">üìä Collection</button>
            <button class="tab" data-tab="design">üéØ Design</button>
            <button class="tab" data-tab="recommend">üìà Recommend</button>
            <button class="tab" data-tab="journal">üìù Journal</button>
            <button class="tab" data-tab="judging">üèÜ Judging</button>
            <button class="tab" data-tab="explorer">üîç Explorer</button>
            <button class="tab" data-tab="learn">üìö Learn</button>
            <button class="tab" data-tab="import">üì• Import</button>
            <button class="tab" data-tab="export">üì§ Export</button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Projects Tab -->
            <div id="projects" class="tab-panel">
                <div class="grid grid-2">
                    <div class="card">
                        <h3>üîê Pro Breeder Mode</h3>
                        <div class="form-group">
                            <label>Project Name</label>
                            <input type="text" id="projectName" class="form-control" placeholder="My Breeding Program">
                        </div>
                        <div class="form-group">
                            <label>Security Passphrase</label>
                            <input type="password" id="projectPassphrase" class="form-control" placeholder="Enter secure passphrase">
                        </div>
                        <div class="form-group">
                            <label>Privacy Mode</label>
                            <select id="privacyMode" class="form-control">
                                <option value="local-only">Local-only (Never shared)</option>
                                <option value="share-insights">Share anonymous insights</option>
                                <option value="collaborative">Collaborative (with partners)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Genus Focus</label>
                            <select id="genusFocus" class="form-control">
                                <option value="cattleya">Cattleya</option>
                                <option value="phalaenopsis">Phalaenopsis</option>
                                <option value="dendrobium">Dendrobium</option>
                                <option value="cymbidium">Cymbidium</option>
                                <option value="oncidium">Oncidium</option>
                                <option value="sarcochilus">Sarcochilus</option>
                                <option value="multi-genus">Multi-genus</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-bottom: 0.5rem;" onclick="createProject()">
                            ‚ûï Create New Project
                        </button>
                        <button class="btn btn-outline" style="width: 100%;" onclick="loadProject()">
                            üìÇ Load Existing Project
                        </button>
                    </div>
                    <div class="card">
                        <h3>üìÅ Your Breeding Projects</h3>
                        <div id="projectsList">
                            <div class="alert alert-info">
                                <strong>No projects yet</strong><br>
                                Create your first encrypted breeding project to get started. All data is stored locally with AES-GCM encryption.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Collection Tab -->
            <div id="collection" class="tab-panel hidden">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>üå∏ Plant Collection</h3>
                        <div>
                            <button class="btn btn-secondary" onclick="importCSV()">üì§ Import CSV</button>
                            <button class="btn btn-primary" onclick="addPlant()">‚ûï Add Plant</button>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="table" id="plantsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Genus</th>
                                    <th>Grex/Species</th>
                                    <th>Clonal Name</th>
                                    <th>Parent 1</th>
                                    <th>Parent 2</th>
                                    <th>Awards</th>
                                    <th>Traits</th>
                                    <th>Privacy</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="plantsTableBody">
                                <!-- Plants will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Design (Reverse) Tab -->
            <div id="design" class="tab-panel hidden">
                <div class="grid grid-2">
                    <div class="card">
                        <h3>üéØ Target Traits</h3>
                        <div id="traitSliders"></div>
                        <div class="form-group">
                            <label>Color Family</label>
                            <select id="colorFamily" class="form-control">
                                <option value="white">White</option>
                                <option value="yellow">Yellow</option>
                                <option value="orange">Orange</option>
                                <option value="pink">Pink</option>
                                <option value="red">Red</option>
                                <option value="purple">Purple</option>
                                <option value="blue">Blue</option>
                                <option value="green">Green</option>
                            </select>
                        </div>
                        <button class="btn btn-warning" style="width: 100%;" onclick="findCrosses()">
                            üîç Find Crosses
                        </button>
                        <div class="performance-stats" id="searchStats" style="display: none;">
                            <div class="stat">
                                <div class="stat-value" id="searchTime">-</div>
                                <div class="stat-label">Runtime (ms)</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="pairCount">-</div>
                                <div class="stat-label">Pairs Evaluated</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>üìã Recommended Crosses</h3>
                        <div id="crossRecommendations">
                            <div class="alert alert-info">
                                Set your target traits and click "Find Crosses" to see AI recommendations with explainability.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommend (Forward) Tab -->
            <div id="recommend" class="tab-panel hidden">
                <div class="grid grid-2">
                    <div class="card">
                        <h3>üìà Forward Breeding</h3>
                        <div class="form-group">
                            <label>Select Plants (Hold Ctrl/Cmd for multiple)</label>
                            <select id="parentSelection" class="form-control" multiple size="6">
                                <!-- Will be populated from collection -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Optimization Goal</label>
                            <select id="optimizationGoal" class="form-control">
                                <option value="awardability">Awardability</option>
                                <option value="floriferousness">Floriferousness</option>
                                <option value="color-novelty">Color Novelty</option>
                                <option value="climate-fit">Climate Adaptation</option>
                                <option value="balanced">Balanced Improvement</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="enableBeamSearch"> Enable Beam Search (A√óB)√óC
                            </label>
                        </div>
                        <button class="btn btn-primary" style="width: 100%;" onclick="generateForwardRecommendations()">
                            üß† Generate Recommendations
                        </button>
                        <div class="performance-stats" id="forwardSearchStats" style="display: none;">
                            <div class="stat">
                                <div class="stat-value" id="forwardSearchTime">-</div>
                                <div class="stat-label">Runtime (ms)</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="forwardPairCount">-</div>
                                <div class="stat-label">Pairs Evaluated</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>üí° Breeding Pairings</h3>
                        <div id="forwardRecommendations">
                            <div class="alert alert-info">
                                Select parent plants and optimization goal to see ranked pairing recommendations with explainability.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Journal Tab -->
            <div id="journal" class="tab-panel hidden">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>üìù Breeding Journal</h3>
                        <button class="btn btn-primary" onclick="addCrossRecord()">‚ûï New Cross</button>
                    </div>
                    <div id="crossRecords">
                        <div class="alert alert-info">
                            No crosses recorded yet. Click "New Cross" to start tracking your breeding program.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Judging Tab -->
            <div id="judging" class="tab-panel hidden">
                <div class="grid grid-2">
                    <div class="card">
                        <h3>üèÜ Judging System</h3>
                        <div class="form-group">
                            <label>Select System</label>
                            <select id="judgingSystem" class="form-control" onchange="loadJudgingWeights()">
                                <option value="aos">AOS (American Orchid Society)</option>
                                <option value="joga">JOGA (Japan Orchid Growers Association)</option>
                                <option value="anos">ANOS (Australian Native Orchid Society)</option>
                                <option value="nzos">NZOS (New Zealand Orchid Society)</option>
                                <option value="eojc">EOJC (European Orchid Judging Centre)</option>
                                <option value="custom">Custom Weights</option>
                            </select>
                        </div>
                        <div id="judgingWeights"></div>
                        <button class="btn btn-warning" style="width: 100%;" onclick="saveJudgingProfile()">
                            üíæ Save Profile
                        </button>
                    </div>
                    <div class="card">
                        <h3>üìä Judging Preview</h3>
                        <canvas id="judgingChart" width="400" height="300" style="max-width: 100%;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Explorer Tab -->
            <div id="explorer" class="tab-panel hidden">
                <div class="card">
                    <h3>üîç Data Explorer</h3>
                    <div class="grid grid-2">
                        <div>
                            <h4>Trait Scatterplot</h4>
                            <div class="form-group">
                                <label>X-Axis</label>
                                <select id="xAxisTrait" class="form-control">
                                    <option value="roundness">Roundness</option>
                                    <option value="flatness">Flatness</option>
                                    <option value="color_saturation">Color Saturation</option>
                                    <option value="flower_size">Flower Size</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Y-Axis</label>
                                <select id="yAxisTrait" class="form-control">
                                    <option value="flatness">Flatness</option>
                                    <option value="roundness">Roundness</option>
                                    <option value="flowers_per_spike">Flowers per Spike</option>
                                    <option value="symmetry">Symmetry</option>
                                </select>
                            </div>
                            <button class="btn btn-info" onclick="generateScatterplot()">üìà Generate Plot</button>
                        </div>
                        <div>
                            <canvas id="explorerChart" width="400" height="300" style="max-width: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Learn Tab -->
            <div id="learn" class="tab-panel hidden">
                <div class="grid grid-2">
                    <div class="card" style="max-height: 500px;">
                        <h3>üìö Learning Modules</h3>
                        <div style="max-height: 400px; overflow-y: auto;">
                            <div class="lesson-item active" data-lesson="1" onclick="loadLesson(1)">
                                üìñ 1. Orchid Genetics Basics
                            </div>
                            <div class="lesson-item" data-lesson="2" onclick="loadLesson(2)">
                                üìù 2. Record-keeping
                            </div>
                            <div class="lesson-item" data-lesson="3" onclick="loadLesson(3)">
                                üì∏ 3. Photography for Breeding
                            </div>
                            <div class="lesson-item" data-lesson="4" onclick="loadLesson(4)">
                                üìä 4. Heritability Estimation
                            </div>
                            <div class="lesson-item" data-lesson="5" onclick="loadLesson(5)">
                                üèÜ 5. Judging Systems Overview
                            </div>
                            <div class="lesson-item" data-lesson="6" onclick="loadLesson(6)">
                                üéØ 6. Planning Crossing Programs
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>üìñ Learning Content</h3>
                        <div id="lessonContent" style="max-height: 400px; overflow-y: auto;">
                            <!-- Lesson content will be loaded here -->
                        </div>
                        <div id="quizSection" style="margin-top: 1rem;">
                            <!-- Quiz will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Import Tab -->
            <div id="import" class="tab-panel hidden">
                <div class="card">
                    <h3>üì• Proof-of-Concept Import</h3>
                    <div class="alert alert-info">
                        Import public datasets from RHS, OrchidRoots, or OrchidPro. Demo includes sample Sarcochilus & Phalaenopsis data.
                    </div>
                    <div class="grid grid-3">
                        <div class="card">
                            <h4>RHS Format</h4>
                            <p>grex, seed_parent, pollen_parent, registrant, date, url</p>
                            <button class="btn btn-secondary" onclick="loadDemoRHS()">Load Demo Data</button>
                        </div>
                        <div class="card">
                            <h4>OrchidRoots Format</h4>
                            <p>name, parent1, parent2, url, img_url</p>
                            <button class="btn btn-secondary" onclick="loadDemoOrchidRoots()">Load Demo Data</button>
                        </div>
                        <div class="card">
                            <h4>OrchidPro Format</h4>
                            <p>award, date, plant_name, parents, region, img_url</p>
                            <button class="btn btn-secondary" onclick="loadDemoOrchidPro()">Load Demo Data</button>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label>Or paste CSV data:</label>
                        <textarea id="csvInput" class="form-control" rows="6" placeholder="Paste your CSV data here..."></textarea>
                        <button class="btn btn-primary" style="margin-top: 0.5rem;" onclick="importCustomCSV()">Import Custom CSV</button>
                    </div>
                </div>
            </div>

            <!-- Export Tab -->
            <div id="export" class="tab-panel hidden">
                <div class="card">
                    <h3>üì§ Export Options</h3>
                    <div class="grid grid-2">
                        <div class="card">
                            <h4>üîê Encrypted Project Backup</h4>
                            <p>Export complete project with AES-GCM encryption (.ocp file)</p>
                            <button class="btn btn-primary" onclick="exportEncrypted()">Export Encrypted</button>
                        </div>
                        <div class="card">
                            <h4>üìä Decrypted JSON</h4>
                            <p>Local-only export with warning</p>
                            <button class="btn btn-warning" onclick="exportDecrypted()">Export Decrypted</button>
                        </div>
                        <div class="card">
                            <h4>üìà Anonymous Insights</h4>
                            <p>Trait summaries (means, SDs, heritability)</p>
                            <button class="btn btn-secondary" onclick="exportAnonymous()">Export Insights</button>
                        </div>
                        <div class="card">
                            <h4>üìÑ Journal Report</h4>
                            <p>Printable PDF via CSS</p>
                            <button class="btn btn-info" onclick="printJournal()">Print Journal</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>üîí Your proprietary data never leaves your device unless you choose to export.</strong></p>
            <p>AES-GCM encryption ‚Ä¢ PBKDF2 key derivation ‚Ä¢ Local IndexedDB storage</p>
            <p>¬© 2025 Orchid Continuum - Created by Jeffery S. Parham</p>
        </div>
    </div>

    <!-- Modals will be added here dynamically -->

    <script>
        // Global variables
        let currentProject = null;
        let plantCollection = [];
        let crossRecords = [];
        let judgingProfiles = {};
        let lessonProgress = {};
        let demoData = {};

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            initializeJudgingProfiles();
            initializeDemoData();
            loadStoredData();
            setupEventListeners();
            loadLesson(1); // Load first lesson by default
        });

        function initializeApp() {
            // Setup tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            // Setup trait sliders
            setupTraitSliders();
            
            // Initialize judging chart
            initializeJudgingChart();
        }

        function switchTab(tabName) {
            // Hide all panels
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.add('hidden');
            });
            
            // Show selected panel
            document.getElementById(tabName).classList.remove('hidden');
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }

        function setupTraitSliders() {
            const traits = {
                roundness: { value: 0.20, label: 'Roundness' },
                flatness: { value: 0.10, label: 'Flatness' },
                color_saturation: { value: 0.18, label: 'Color Saturation' },
                presentation: { value: 0.08, label: 'Presentation' },
                symmetry: { value: 0.10, label: 'Symmetry' },
                flower_size: { value: 0.10, label: 'Flower Size' },
                flowers_per_spike: { value: 0.08, label: 'Flowers per Spike' },
                substance_texture: { value: 0.08, label: 'Substance & Texture' },
                lip_definition: { value: 0.05, label: 'Lip Definition' },
                pattern_quality: { value: 0.03, label: 'Pattern Quality' }
            };

            const container = document.getElementById('traitSliders');
            container.innerHTML = Object.entries(traits).map(([key, trait]) => `
                <div class="slider-group">
                    <label>${trait.label}: <span id="${key}Value">${trait.value.toFixed(2)}</span></label>
                    <input type="range" id="${key}Slider" class="slider form-control" 
                           min="0" max="1" step="0.01" value="${trait.value}"
                           oninput="updateTraitValue('${key}', this.value)">
                </div>
            `).join('');
        }

        function updateTraitValue(trait, value) {
            document.getElementById(trait + 'Value').textContent = parseFloat(value).toFixed(2);
        }

        // Initialize judging profiles with all systems
        function initializeJudgingProfiles() {
            judgingProfiles = {
                aos: {
                    roundness: 0.20,
                    flatness: 0.10,
                    color_saturation: 0.18,
                    presentation: 0.08,
                    symmetry: 0.10,
                    flower_size: 0.10,
                    flowers_per_spike: 0.08,
                    substance_texture: 0.08,
                    lip_definition: 0.05,
                    pattern_quality: 0.03
                },
                joga: {
                    roundness: 0.15,
                    flatness: 0.12,
                    color_saturation: 0.20,
                    presentation: 0.12,
                    symmetry: 0.15,
                    flower_size: 0.08,
                    flowers_per_spike: 0.06,
                    substance_texture: 0.07,
                    lip_definition: 0.03,
                    pattern_quality: 0.02
                },
                anos: {
                    roundness: 0.18,
                    flatness: 0.08,
                    color_saturation: 0.16,
                    presentation: 0.10,
                    symmetry: 0.12,
                    flower_size: 0.12,
                    flowers_per_spike: 0.10,
                    substance_texture: 0.09,
                    lip_definition: 0.03,
                    pattern_quality: 0.02
                },
                nzos: {
                    roundness: 0.22,
                    flatness: 0.11,
                    color_saturation: 0.17,
                    presentation: 0.09,
                    symmetry: 0.11,
                    flower_size: 0.09,
                    flowers_per_spike: 0.07,
                    substance_texture: 0.08,
                    lip_definition: 0.04,
                    pattern_quality: 0.02
                },
                eojc: {
                    roundness: 0.19,
                    flatness: 0.09,
                    color_saturation: 0.19,
                    presentation: 0.11,
                    symmetry: 0.13,
                    flower_size: 0.11,
                    flowers_per_spike: 0.06,
                    substance_texture: 0.07,
                    lip_definition: 0.03,
                    pattern_quality: 0.02
                }
            };
            
            loadJudgingWeights();
        }

        function loadJudgingWeights() {
            const system = document.getElementById('judgingSystem').value;
            const weights = judgingProfiles[system] || judgingProfiles.aos;
            const container = document.getElementById('judgingWeights');
            
            container.innerHTML = Object.entries(weights).map(([trait, weight]) => `
                <div class="slider-group">
                    <label>${trait.replace('_', ' ').toUpperCase()}: <span id="${trait}WeightVal">${weight.toFixed(2)}</span></label>
                    <input type="range" id="${trait}WeightSlider" class="slider form-control" 
                           min="0" max="1" step="0.01" value="${weight}" 
                           oninput="updateJudgingWeight('${trait}', this.value)">
                </div>
            `).join('');
            
            updateJudgingChart();
        }

        function updateJudgingWeight(trait, value) {
            document.getElementById(trait + 'WeightVal').textContent = parseFloat(value).toFixed(2);
            updateJudgingChart();
        }

        function initializeJudgingChart() {
            // Initialize canvas for judging weights visualization
            updateJudgingChart();
        }

        function updateJudgingChart() {
            const canvas = document.getElementById('judgingChart');
            const ctx = canvas.getContext('2d');
            const system = document.getElementById('judgingSystem')?.value || 'aos';
            const weights = judgingProfiles[system] || judgingProfiles.aos;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw bar chart
            const entries = Object.entries(weights);
            const barWidth = canvas.width / entries.length - 10;
            const maxHeight = canvas.height - 40;
            
            entries.forEach(([trait, weight], index) => {
                const x = index * (barWidth + 10) + 5;
                const height = weight * maxHeight;
                const y = canvas.height - height - 20;
                
                // Draw bar
                ctx.fillStyle = '#6B3FA0';
                ctx.fillRect(x, y, barWidth, height);
                
                // Draw label
                ctx.fillStyle = '#ffffff';
                ctx.font = '10px Arial';
                ctx.save();
                ctx.translate(x + barWidth/2, canvas.height - 5);
                ctx.rotate(-Math.PI/4);
                ctx.textAlign = 'right';
                ctx.fillText(trait.replace('_', ' '), 0, 0);
                ctx.restore();
                
                // Draw value
                ctx.textAlign = 'center';
                ctx.fillText(weight.toFixed(2), x + barWidth/2, y - 5);
            });
        }

        // Demo data initialization
        function initializeDemoData() {
            demoData = {
                sarcochilus: [
                    { name: 'Sarcochilus Kulnura Magic', parent1: 'Sarc. fitzhart', parent2: 'Sarc. hartmanii', awards: 'HCC/AOS', traits: { roundness: 0.85, color_saturation: 0.92 }},
                    { name: 'Sarcochilus Heidi', parent1: 'Sarc. fitzhart', parent2: 'Sarc. weinthalii', awards: 'AM/AOS', traits: { roundness: 0.78, color_saturation: 0.88 }},
                    { name: 'Sarcochilus Fitzhart', parent1: 'Sarc. hartmanii', parent2: 'Sarc. fitzgeraldii', awards: 'Species', traits: { roundness: 0.82, color_saturation: 0.75 }}
                ],
                phalaenopsis: [
                    { name: 'Phalaenopsis Brother Sara Gold', parent1: 'Phal. Brother Golden Potential', parent2: 'Phal. Sara Lee', awards: 'HCC/AOS', traits: { roundness: 0.91, color_saturation: 0.95 }},
                    { name: 'Phalaenopsis Golden Peoker', parent1: 'Phal. Golden Buddha', parent2: 'Phal. Peoker\'s Pride', awards: 'AM/AOS', traits: { roundness: 0.89, color_saturation: 0.93 }},
                    { name: 'Phalaenopsis Tying Shin Champion', parent1: 'Phal. Tying Shin Fly Eagle', parent2: 'Phal. Champion', awards: 'FCC/AOS', traits: { roundness: 0.94, color_saturation: 0.97 }}
                ]
            };
        }

        // Project management functions
        async function createProject() {
            const name = document.getElementById('projectName').value;
            const passphrase = document.getElementById('projectPassphrase').value;
            const privacy = document.getElementById('privacyMode').value;
            const genus = document.getElementById('genusFocus').value;
            
            if (!name || !passphrase) {
                alert('Please enter both project name and passphrase');
                return;
            }
            
            if (passphrase.length < 8) {
                alert('Passphrase must be at least 8 characters long');
                return;
            }
            
            const project = {
                id: Date.now().toString(),
                name: name,
                privacy: privacy,
                genus: genus,
                created: new Date().toISOString(),
                plants: [],
                crosses: [],
                notes: [],
                encrypted: true
            };
            
            try {
                await saveProjectEncrypted(project, passphrase);
                displayProjects();
                clearProjectForm();
                alert('Project created successfully!');
            } catch (error) {
                alert('Error creating project: ' + error.message);
            }
        }

        async function saveProjectEncrypted(project, passphrase) {
            try {
                // Generate salt and derive key
                const salt = crypto.getRandomValues(new Uint8Array(16));
                const key = await deriveKey(passphrase, salt);
                
                // Encrypt project data
                const projectData = JSON.stringify(project);
                const encrypted = await encryptData(projectData, key);
                
                // Store encrypted project
                const encryptedProject = {
                    id: project.id,
                    name: project.name, // Keep name unencrypted for display
                    created: project.created,
                    privacy: project.privacy,
                    genus: project.genus,
                    salt: Array.from(salt),
                    encrypted: encrypted,
                    version: '1.0'
                };
                
                const projects = JSON.parse(localStorage.getItem('orchidProjects') || '[]');
                const existingIndex = projects.findIndex(p => p.id === project.id);
                
                if (existingIndex >= 0) {
                    projects[existingIndex] = encryptedProject;
                } else {
                    projects.push(encryptedProject);
                }
                
                localStorage.setItem('orchidProjects', JSON.stringify(projects));
                
            } catch (error) {
                throw new Error('Encryption failed: ' + error.message);
            }
        }

        async function deriveKey(passphrase, salt) {
            const encoder = new TextEncoder();
            const keyMaterial = await crypto.subtle.importKey(
                'raw',
                encoder.encode(passphrase),
                { name: 'PBKDF2' },
                false,
                ['deriveBits', 'deriveKey']
            );
            
            return await crypto.subtle.deriveKey(
                {
                    name: 'PBKDF2',
                    salt: salt,
                    iterations: 100000,
                    hash: 'SHA-256'
                },
                keyMaterial,
                { name: 'AES-GCM', length: 256 },
                false,
                ['encrypt', 'decrypt']
            );
        }

        async function encryptData(data, key) {
            const encoder = new TextEncoder();
            const iv = crypto.getRandomValues(new Uint8Array(12));
            
            const encrypted = await crypto.subtle.encrypt(
                { name: 'AES-GCM', iv: iv },
                key,
                encoder.encode(data)
            );
            
            return {
                iv: Array.from(iv),
                data: Array.from(new Uint8Array(encrypted))
            };
        }

        async function decryptData(encryptedData, key) {
            const iv = new Uint8Array(encryptedData.iv);
            const data = new Uint8Array(encryptedData.data);
            
            const decrypted = await crypto.subtle.decrypt(
                { name: 'AES-GCM', iv: iv },
                key,
                data
            );
            
            const decoder = new TextDecoder();
            return decoder.decode(decrypted);
        }

        function loadStoredData() {
            displayProjects();
            updatePlantSelectors();
        }

        function displayProjects() {
            const projects = JSON.parse(localStorage.getItem('orchidProjects') || '[]');
            const container = document.getElementById('projectsList');
            
            if (projects.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <strong>No projects yet</strong><br>
                        Create your first encrypted breeding project to get started. All data is stored locally with AES-GCM encryption.
                    </div>
                `;
                return;
            }
            
            container.innerHTML = projects.map(project => `
                <div class="card" style="margin-bottom: 1rem;">
                    <h4>${project.name} <span class="security-badge">üîê Encrypted</span></h4>
                    <p style="color: var(--text-muted);">
                        ${project.genus} ‚Ä¢ ${project.privacy} ‚Ä¢ ${new Date(project.created).toLocaleDateString()}
                    </p>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-primary" onclick="openProject('${project.id}')">
                            üìÇ Open
                        </button>
                        <button class="btn btn-danger" onclick="deleteProject('${project.id}')">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function clearProjectForm() {
            document.getElementById('projectName').value = '';
            document.getElementById('projectPassphrase').value = '';
            document.getElementById('privacyMode').value = 'local-only';
            document.getElementById('genusFocus').value = 'cattleya';
        }

        // Search algorithms
        function findCrosses() {
            const startTime = performance.now();
            
            // Get target traits
            const targetTraits = {};
            ['roundness', 'flatness', 'color_saturation', 'presentation', 'symmetry', 
             'flower_size', 'flowers_per_spike', 'substance_texture', 'lip_definition', 'pattern_quality'].forEach(trait => {
                const slider = document.getElementById(trait + 'Slider');
                if (slider) {
                    targetTraits[trait] = parseFloat(slider.value);
                }
            });
            
            const colorFamily = document.getElementById('colorFamily').value;
            
            // Simulate search through plant collection
            let pairs = [];
            let pairCount = 0;
            
            // Use demo data if no current project
            const searchData = currentProject ? currentProject.plants : [...demoData.sarcochilus, ...demoData.phalaenopsis];
            
            // Generate all unique pairs (cap at 2000)
            for (let i = 0; i < searchData.length && pairCount < 2000; i++) {
                for (let j = i + 1; j < searchData.length && pairCount < 2000; j++) {
                    const plant1 = searchData[i];
                    const plant2 = searchData[j];
                    
                    const score = calculateCrossScore(plant1, plant2, targetTraits, colorFamily);
                    pairs.push({
                        plant1: plant1,
                        plant2: plant2,
                        score: score,
                        explanation: generateExplanation(plant1, plant2, targetTraits)
                    });
                    pairCount++;
                }
            }
            
            // Sort by score
            pairs.sort((a, b) => b.score - a.score);
            
            const endTime = performance.now();
            const runtime = Math.round(endTime - startTime);
            
            // Display results
            displayCrossRecommendations(pairs.slice(0, 10), runtime, pairCount);
        }

        function calculateCrossScore(plant1, plant2, targetTraits, colorFamily) {
            // Simplified scoring algorithm
            let score = 0;
            let totalWeight = 0;
            
            Object.entries(targetTraits).forEach(([trait, target]) => {
                const p1Value = plant1.traits?.[trait] || 0.5;
                const p2Value = plant2.traits?.[trait] || 0.5;
                const predictedOffspring = (p1Value + p2Value) / 2;
                const difference = Math.abs(predictedOffspring - target);
                const traitScore = Math.max(0, 1 - difference);
                
                score += traitScore * target; // Weight by target importance
                totalWeight += target;
            });
            
            return totalWeight > 0 ? (score / totalWeight) * 100 : 0;
        }

        function generateExplanation(plant1, plant2, targetTraits) {
            const topTraits = Object.entries(targetTraits)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .map(([trait]) => trait.replace('_', ' '));
            
            return `Strong match for ${topTraits.join(', ')}. Expected offspring will inherit complementary traits from both parents.`;
        }

        function displayCrossRecommendations(pairs, runtime, pairCount) {
            const container = document.getElementById('crossRecommendations');
            
            container.innerHTML = pairs.map((pair, index) => `
                <div class="card" style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: between; align-items: center;">
                        <div style="flex: 1;">
                            <h4>Rank ${index + 1}: ${pair.plant1.name} √ó ${pair.plant2.name}</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${pair.score}%"></div>
                            </div>
                            <p style="margin: 0.5rem 0;"><strong>Goal Match: ${pair.score.toFixed(1)}%</strong></p>
                            <p style="color: var(--text-muted); font-size: 0.9rem;">${pair.explanation}</p>
                        </div>
                        <div style="margin-left: 1rem; text-align: center;">
                            <button class="btn btn-primary" onclick="addToJournal('${pair.plant1.name}', '${pair.plant2.name}')">
                                ‚ûï Add to Journal
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Update performance stats
            document.getElementById('searchStats').style.display = 'flex';
            document.getElementById('searchTime').textContent = runtime;
            document.getElementById('pairCount').textContent = pairCount;
        }

        function generateForwardRecommendations() {
            const startTime = performance.now();
            const selectedPlants = Array.from(document.getElementById('parentSelection').selectedOptions)
                .map(option => option.value);
            const goal = document.getElementById('optimizationGoal').value;
            const enableBeamSearch = document.getElementById('enableBeamSearch').checked;
            
            if (selectedPlants.length < 2) {
                alert('Please select at least 2 plants');
                return;
            }
            
            // Simulate forward breeding algorithm
            let recommendations = [];
            let pairCount = 0;
            
            // Generate pairwise recommendations
            for (let i = 0; i < selectedPlants.length; i++) {
                for (let j = i + 1; j < selectedPlants.length; j++) {
                    const score = Math.random() * 100; // Simplified scoring
                    recommendations.push({
                        parent1: selectedPlants[i],
                        parent2: selectedPlants[j],
                        score: score,
                        goal: goal
                    });
                    pairCount++;
                }
            }
            
            // If beam search enabled, add two-step recommendations
            if (enableBeamSearch && recommendations.length > 0) {
                // Add (A√óB)√óC combinations
                recommendations.slice(0, 3).forEach(rec => {
                    selectedPlants.forEach(plant => {
                        if (plant !== rec.parent1 && plant !== rec.parent2) {
                            recommendations.push({
                                parent1: `(${rec.parent1} √ó ${rec.parent2})`,
                                parent2: plant,
                                score: Math.random() * 90, // Slightly lower scores for complexity
                                goal: goal,
                                twoStep: true
                            });
                            pairCount++;
                        }
                    });
                });
            }
            
            recommendations.sort((a, b) => b.score - a.score);
            
            const endTime = performance.now();
            const runtime = Math.round(endTime - startTime);
            
            displayForwardRecommendations(recommendations.slice(0, 8), runtime, pairCount);
        }

        function displayForwardRecommendations(recommendations, runtime, pairCount) {
            const container = document.getElementById('forwardRecommendations');
            
            container.innerHTML = recommendations.map((rec, index) => `
                <div class="card" style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: between; align-items: center;">
                        <div style="flex: 1;">
                            <h4>Rank ${index + 1}: ${rec.parent1} √ó ${rec.parent2}</h4>
                            ${rec.twoStep ? '<span class="security-badge">2-Step</span>' : ''}
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${rec.score}%"></div>
                            </div>
                            <p><strong>${rec.goal.replace('-', ' ').toUpperCase()} Score: ${rec.score.toFixed(1)}%</strong></p>
                            <p style="color: var(--text-muted);">Expected improvement in ${rec.goal.replace('-', ' ')} characteristics</p>
                        </div>
                        <button class="btn btn-primary" onclick="addToJournal('${rec.parent1}', '${rec.parent2}')">
                            ‚ûï Add to Journal
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Update performance stats
            document.getElementById('forwardSearchStats').style.display = 'flex';
            document.getElementById('forwardSearchTime').textContent = runtime;
            document.getElementById('forwardPairCount').textContent = pairCount;
        }

        // Journal functions
        function addToJournal(parent1, parent2) {
            const cross = {
                id: Date.now().toString(),
                parent1: parent1,
                parent2: parent2,
                date: new Date().toISOString().split('T')[0],
                stage: 'planned',
                notes: ''
            };
            
            crossRecords.push(cross);
            updateCrossRecordsDisplay();
            alert(`Cross ${parent1} √ó ${parent2} added to journal!`);
        }

        function addCrossRecord() {
            const cross = {
                id: Date.now().toString(),
                parent1: '',
                parent2: '',
                date: new Date().toISOString().split('T')[0],
                stage: 'planned',
                notes: ''
            };
            
            crossRecords.push(cross);
            updateCrossRecordsDisplay();
        }

        function updateCrossRecordsDisplay() {
            const container = document.getElementById('crossRecords');
            
            if (crossRecords.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        No crosses recorded yet. Click "New Cross" to start tracking your breeding program.
                    </div>
                `;
                return;
            }
            
            container.innerHTML = crossRecords.map(cross => `
                <div class="card" style="margin-bottom: 1rem;">
                    <h4>${cross.parent1 || 'Parent 1'} √ó ${cross.parent2 || 'Parent 2'}</h4>
                    <p><strong>Date:</strong> ${cross.date} | <strong>Stage:</strong> ${cross.stage}</p>
                    <p><strong>Notes:</strong> ${cross.notes || 'No notes yet'}</p>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-warning" onclick="editCrossRecord('${cross.id}')">‚úèÔ∏è Edit</button>
                        <button class="btn btn-danger" onclick="deleteCrossRecord('${cross.id}')">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Learning system
        function loadLesson(lessonNumber) {
            const lessons = {
                1: {
                    title: "Orchid Genetics Basics",
                    content: `
                        <h4>Understanding Orchid Inheritance</h4>
                        <p>Orchid breeding involves complex genetic interactions beyond simple Mendelian genetics:</p>
                        <ul>
                            <li><strong>Polygenic Traits:</strong> Most characteristics like color and size involve multiple genes</li>
                            <li><strong>Epistasis:</strong> Gene interactions can modify expression patterns</li>
                            <li><strong>Environmental Effects:</strong> Growing conditions significantly influence trait expression</li>
                            <li><strong>Heterosis:</strong> Hybrid vigor often produces superior offspring</li>
                        </ul>
                        <h5>Key Concepts</h5>
                        <p><strong>Heritability (h¬≤):</strong> Proportion of trait variation due to genetics vs environment. Higher heritability = more predictable inheritance.</p>
                        <p><strong>Quantitative Traits:</strong> Continuous variation (e.g., flower size) follows normal distribution patterns.</p>
                    `,
                    quiz: {
                        question: "What does high heritability indicate in orchid breeding?",
                        options: [
                            "Environmental factors dominate",
                            "Genetic factors dominate trait expression",
                            "No predictable inheritance",
                            "Only dominant genes matter"
                        ],
                        correct: 1
                    }
                },
                2: {
                    title: "Record-keeping for Breeders",
                    content: `
                        <h4>Essential Breeding Records</h4>
                        <p>Systematic documentation is crucial for breeding success:</p>
                        <h5>Plant Identification</h5>
                        <ul>
                            <li>Unique ID system (genus abbreviation + number)</li>
                            <li>Complete parentage (seed parent √ó pollen parent)</li>
                            <li>Source and acquisition date</li>
                            <li>Growth requirements and cultural notes</li>
                        </ul>
                        <h5>Cross Documentation</h5>
                        <ul>
                            <li>Pollination date and environmental conditions</li>
                            <li>Pod development timeline with photos</li>
                            <li>Seed harvesting and sowing records</li>
                            <li>Germination rates and growth milestones</li>
                        </ul>
                        <div class="alert alert-warning">
                            <strong>Best Practice:</strong> Always maintain duplicate records and photograph all breeding plants before crossing.
                        </div>
                    `,
                    quiz: {
                        question: "What is the most important element of plant identification?",
                        options: [
                            "Common name only",
                            "Unique ID with complete parentage",
                            "Just the genus",
                            "Purchase price"
                        ],
                        correct: 1
                    }
                },
                3: {
                    title: "Photography for Breeding",
                    content: `
                        <h4>Documenting Orchid Traits</h4>
                        <p>Quality photography is essential for trait analysis and record-keeping:</p>
                        <h5>Technical Requirements</h5>
                        <ul>
                            <li>Consistent lighting (daylight or full-spectrum LED)</li>
                            <li>Neutral background to avoid color contamination</li>
                            <li>Multiple angles: front view, side profile, dorsal sepal detail</li>
                            <li>Scale reference (ruler or coin) for size documentation</li>
                        </ul>
                        <h5>Trait Documentation</h5>
                        <ul>
                            <li><strong>Shape Analysis:</strong> Full flower face-on for roundness/flatness</li>
                            <li><strong>Color Accuracy:</strong> Consistent white balance and exposure</li>
                            <li><strong>Pattern Details:</strong> Close-up shots of lip and petal markings</li>
                            <li><strong>Plant Habit:</strong> Full plant photos showing growth pattern</li>
                        </ul>
                        <p><strong>Computer Vision Benefits:</strong> Consistent photography enables automated trait extraction using AI analysis.</p>
                    `,
                    quiz: {
                        question: "Why is consistent lighting important in orchid photography?",
                        options: [
                            "Makes photos look pretty",
                            "Enables accurate color and trait analysis",
                            "Saves battery life",
                            "Reduces file size"
                        ],
                        correct: 1
                    }
                },
                4: {
                    title: "Heritability Estimation",
                    content: `
                        <h4>Parent-Offspring Regression</h4>
                        <p>Heritability (h¬≤) measures how much trait variation is genetic vs environmental:</p>
                        <h5>Calculation Methods</h5>
                        <ul>
                            <li><strong>Narrow-sense h¬≤:</strong> Additive genetic effects only</li>
                            <li><strong>Broad-sense H¬≤:</strong> All genetic effects (additive + dominance + epistasis)</li>
                            <li><strong>Regression slope:</strong> Offspring value vs parent average</li>
                        </ul>
                        <h5>Practical Application</h5>
                        <p>For quantitative traits like flower size:</p>
                        <p><code>h¬≤ = (Offspring mean - Population mean) / (Parent mean - Population mean)</code></p>
                        <p>Values range from 0 (all environmental) to 1 (all genetic).</p>
                        <div class="alert alert-info">
                            <strong>Typical Orchid Heritabilities:</strong><br>
                            Flower size: 0.6-0.8<br>
                            Color intensity: 0.4-0.7<br>
                            Plant vigor: 0.3-0.5
                        </div>
                    `,
                    quiz: {
                        question: "A heritability of 0.8 means:",
                        options: [
                            "80% of individuals show the trait",
                            "80% of trait variation is due to genetics",
                            "The trait appears in 8 out of 10 offspring",
                            "80% of genes are involved"
                        ],
                        correct: 1
                    }
                },
                5: {
                    title: "Judging Systems Overview",
                    content: `
                        <h4>International Orchid Judging</h4>
                        <p>Different organizations emphasize various traits:</p>
                        <h5>Major Systems</h5>
                        <ul>
                            <li><strong>AOS:</strong> Balanced approach, emphasis on flower quality</li>
                            <li><strong>JOGA:</strong> High weight on color saturation and symmetry</li>
                            <li><strong>ANOS:</strong> Values larger flowers and Australian climate adaptation</li>
                            <li><strong>NZOS:</strong> Similar to AOS but with regional preferences</li>
                            <li><strong>EOJC:</strong> European standards with color and presentation focus</li>
                        </ul>
                        <h5>Award Categories</h5>
                        <ul>
                            <li><strong>FCC:</strong> First Class Certificate (90+ points, exceptional)</li>
                            <li><strong>AM:</strong> Award of Merit (80-89 points, excellent)</li>
                            <li><strong>HCC:</strong> Highly Commended Certificate (75-79 points, very good)</li>
                        </ul>
                        <p><strong>Breeding Strategy:</strong> Understanding judging criteria helps select parents to produce awardable offspring.</p>
                    `,
                    quiz: {
                        question: "What is the minimum point requirement for an Award of Merit (AM)?",
                        options: [
                            "75 points",
                            "80 points",
                            "85 points",
                            "90 points"
                        ],
                        correct: 1
                    }
                },
                6: {
                    title: "Planning Crossing Programs",
                    content: `
                        <h4>Strategic Breeding Approaches</h4>
                        <p>Successful breeding programs require long-term planning:</p>
                        <h5>Forward Design</h5>
                        <ul>
                            <li>Start with excellent parents</li>
                            <li>Define specific improvement goals</li>
                            <li>Plan multiple generation crosses</li>
                            <li>Consider market demands and judging trends</li>
                        </ul>
                        <h5>Reverse Design</h5>
                        <ul>
                            <li>Define ideal target traits</li>
                            <li>Work backward to identify parent combinations</li>
                            <li>Use predictive modeling for trait inheritance</li>
                            <li>Account for linkage and epistasis</li>
                        </ul>
                        <h5>Risk Management</h5>
                        <ul>
                            <li>Make multiple crosses per breeding goal</li>
                            <li>Maintain diverse genetic base</li>
                            <li>Document everything for future reference</li>
                            <li>Plan for 5-7 year development cycles</li>
                        </ul>
                        <div class="alert alert-success">
                            <strong>Success Tip:</strong> The best breeders combine scientific methodology with artistic vision and patience.
                        </div>
                    `,
                    quiz: {
                        question: "What is the typical time from cross to first flowering in orchids?",
                        options: [
                            "1-2 years",
                            "3-4 years",
                            "5-7 years",
                            "10+ years"
                        ],
                        correct: 2
                    }
                }
            };

            const lesson = lessons[lessonNumber];
            if (!lesson) return;

            // Update lesson content
            document.getElementById('lessonContent').innerHTML = `
                <h3>${lesson.title}</h3>
                ${lesson.content}
            `;

            // Update quiz section
            document.getElementById('quizSection').innerHTML = `
                <div class="card">
                    <h4>üìù Quick Quiz</h4>
                    <p><strong>${lesson.quiz.question}</strong></p>
                    ${lesson.quiz.options.map((option, index) => `
                        <label style="display: block; margin: 0.5rem 0; cursor: pointer;">
                            <input type="radio" name="quiz${lessonNumber}" value="${index}" style="margin-right: 0.5rem;">
                            ${option}
                        </label>
                    `).join('')}
                    <button class="btn btn-primary" onclick="checkQuizAnswer(${lessonNumber}, ${lesson.quiz.correct})">
                        ‚úì Check Answer
                    </button>
                </div>
            `;

            // Update active lesson
            document.querySelectorAll('.lesson-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-lesson="${lessonNumber}"]`).classList.add('active');
        }

        function checkQuizAnswer(lessonNumber, correctAnswer) {
            const selected = document.querySelector(`input[name="quiz${lessonNumber}"]:checked`);
            if (!selected) {
                alert('Please select an answer');
                return;
            }
            
            const isCorrect = parseInt(selected.value) === correctAnswer;
            if (isCorrect) {
                alert('‚úÖ Correct! Well done.');
                lessonProgress[lessonNumber] = true;
            } else {
                alert('‚ùå Not quite right. Try again or review the lesson material.');
            }
        }

        // Demo data loading functions
        function loadDemoRHS() {
            alert('Loading RHS demo data...');
            // In a real implementation, this would parse and import RHS CSV format
        }

        function loadDemoOrchidRoots() {
            alert('Loading OrchidRoots demo data...');
            // In a real implementation, this would parse and import OrchidRoots CSV format
        }

        function loadDemoOrchidPro() {
            alert('Loading OrchidPro demo data...');
            // In a real implementation, this would parse and import OrchidPro CSV format
        }

        function importCustomCSV() {
            const csvData = document.getElementById('csvInput').value;
            if (!csvData.trim()) {
                alert('Please paste CSV data first');
                return;
            }
            
            alert('CSV import functionality would be implemented here');
            // In a real implementation, this would parse and import the CSV
        }

        // Export functions
        function exportEncrypted() {
            if (!currentProject) {
                alert('Please open a project first');
                return;
            }
            
            alert('Encrypted export (.ocp file) would be generated here');
        }

        function exportDecrypted() {
            if (!currentProject) {
                alert('Please open a project first');
                return;
            }
            
            const confirmed = confirm('‚ö†Ô∏è Warning: This will export your data in readable format. Continue?');
            if (confirmed) {
                alert('Decrypted JSON export would be generated here');
            }
        }

        function exportAnonymous() {
            alert('Anonymous insights export would be generated here');
        }

        function printJournal() {
            window.print();
        }

        // Utility functions
        function setupEventListeners() {
            // Add any additional event listeners here
        }

        function updatePlantSelectors() {
            const selector = document.getElementById('parentSelection');
            if (selector && currentProject) {
                selector.innerHTML = currentProject.plants.map(plant => 
                    `<option value="${plant.id}">${plant.name}</option>`
                ).join('');
            }
        }

        // CSS for lesson items
        const style = document.createElement('style');
        style.textContent = `
            .lesson-item {
                padding: 0.75rem;
                margin: 0.25rem 0;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s ease;
                border: 2px solid transparent;
            }
            
            .lesson-item:hover {
                background: rgba(255, 255, 255, 0.1);
            }
            
            .lesson-item.active {
                background: var(--primary);
                color: white;
                border-color: var(--primary);
            }
        `;
        document.head.appendChild(style);

        // Initialize the application when DOM is loaded
        // (This is already handled in the DOMContentLoaded event listener above)
    </script>
</body>
</html>