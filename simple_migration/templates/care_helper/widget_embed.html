<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orchid Care Helper Widget</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .care-widget {
            max-width: 500px;
            margin: 20px auto;
        }
        .example-question:hover {
            background: rgba(255,255,255,0.2) !important;
        }
    </style>
</head>
<body>
    <div class="care-widget">
        <div class="card shadow-lg border-0" style="background: linear-gradient(135deg, #1a1a2e, #16213e);">
            <div class="card-header text-center" style="background: linear-gradient(135deg, #0f3460, #0e6b7d); border: none;">
                <h5 class="text-light mb-0">
                    <i data-feather="help-circle" class="me-2"></i>
                    ðŸŒº Ask Our Orchid Expert
                </h5>
            </div>
            
            <div class="card-body p-4">
                <!-- Compact Care Helper Form -->
                <form id="careHelperForm">
                    <div class="mb-3">
                        <textarea 
                            class="form-control bg-dark text-light border-secondary" 
                            id="orchidQuestion" 
                            name="question"
                            rows="3" 
                            placeholder="Describe your orchid problem..."
                            style="border-radius: 6px; resize: vertical;"
                            required></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <input 
                            type="text" 
                            class="form-control bg-dark text-light border-secondary" 
                            id="userLocation" 
                            name="location"
                            placeholder="Your location (optional)"
                            style="border-radius: 6px;">
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary" id="getAdviceBtn" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 6px;">
                            <i data-feather="search" class="me-2"></i>
                            Get Advice
                            <span class="spinner-border spinner-border-sm ms-2 d-none" id="loadingSpinner"></span>
                        </button>
                    </div>
                </form>
                
                <!-- Compact Results Area -->
                <div id="adviceResults" class="mt-3 d-none">
                    <div class="card bg-dark border-success">
                        <div class="card-header bg-success text-white py-2">
                            <h6 class="mb-0">
                                <i data-feather="check-circle" class="me-2"></i>
                                Expert Advice
                            </h6>
                        </div>
                        <div class="card-body p-3">
                            <div id="adviceContent" class="text-light small"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Error Area -->
                <div id="errorResults" class="mt-3 d-none">
                    <div class="alert alert-danger py-2">
                        <i data-feather="alert-triangle" class="me-2"></i>
                        <span id="errorContent"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
// Same JavaScript as main widget but more compact
feather.replace();

document.getElementById('careHelperForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const question = document.getElementById('orchidQuestion').value.trim();
    const location = document.getElementById('userLocation').value.trim();
    const btn = document.getElementById('getAdviceBtn');
    const spinner = document.getElementById('loadingSpinner');
    const resultsDiv = document.getElementById('adviceResults');
    const errorDiv = document.getElementById('errorResults');
    
    if (!question) {
        showError('Please describe your orchid problem.');
        return;
    }
    
    btn.disabled = true;
    spinner.classList.remove('d-none');
    resultsDiv.classList.add('d-none');
    errorDiv.classList.add('d-none');
    
    try {
        const response = await fetch('/care-helper/ask', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                question: question,
                location: location
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showAdvice(data.advice);
        } else {
            showError(data.error || 'Unable to get advice at this time.');
        }
        
    } catch (error) {
        console.error('Error getting advice:', error);
        showError('Connection error. Please try again.');
    } finally {
        btn.disabled = false;
        spinner.classList.add('d-none');
    }
});

function showAdvice(advice) {
    const content = document.getElementById('adviceContent');
    const resultsDiv = document.getElementById('adviceResults');
    
    content.innerHTML = advice.replace(/\n/g, '<br>');
    resultsDiv.classList.remove('d-none');
}

function showError(message) {
    const errorContent = document.getElementById('errorContent');
    const errorDiv = document.getElementById('errorResults');
    
    errorContent.textContent = message;
    errorDiv.classList.remove('d-none');
}
</script>
</body>
</html>