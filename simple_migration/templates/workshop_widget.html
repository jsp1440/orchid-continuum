<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCOS Workshop Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.css" rel="stylesheet">
    <style>
        .workshop-widget {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .hero-card {
            background: linear-gradient(135deg, #6B3FA0, #9B59B6);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        .hero-card::before {
            content: "üå∫";
            position: absolute;
            font-size: 120px;
            opacity: 0.15;
            right: -10px;
            top: -20px;
        }
        .registration-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
        }
        .price-tag {
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin: 10px 0;
        }
        .materials-included {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }
        .btn-register {
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            padding: 12px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            color: white;
            transition: transform 0.3s ease;
        }
        .btn-register:hover {
            transform: translateY(-2px);
            color: white;
        }
        .culture-sheets-preview {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        .download-link {
            background: #6B3FA0;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-block;
            margin: 5px 10px 5px 0;
            transition: background 0.3s ease;
        }
        .download-link:hover {
            background: #5a2d8a;
            color: white;
            text-decoration: none;
        }
        .workshop-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .detail-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        .countdown-timer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin: 20px 0;
        }
        .registration-status {
            padding: 10px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }
        .spots-available {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .spots-limited {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .spots-full {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="workshop-widget">
        <div class="hero-card">
            <h1>üå∫ FCOS Orchid Workshop</h1>
            <h2>Traditional vs. Semi-Hydroponic Repotting</h2>
            <p class="lead mb-0">Hands-on learning with Dendrobium kingianum</p>
            <p><strong>Saturday, September 28, 2025 ‚Ä¢ 1:00-3:00 PM ‚Ä¢ Los Osos</strong></p>
        </div>

        <!-- Registration Status -->
        <div class="registration-status spots-available" id="registrationStatus">
            ‚úÖ 12 spots available (8 of 20 registered)
        </div>

        <!-- Quick Details -->
        <div class="workshop-details">
            <div class="detail-item">
                <i data-feather="clock" class="mb-2"></i>
                <h5>Duration</h5>
                <p>2 Hours<br>1:00 - 3:00 PM</p>
            </div>
            <div class="detail-item">
                <i data-feather="users" class="mb-2"></i>
                <h5>Class Size</h5>
                <p>Limited to<br>20 Participants</p>
            </div>
            <div class="detail-item">
                <i data-feather="map-pin" class="mb-2"></i>
                <h5>Location</h5>
                <p>Los Osos<br>Community Center</p>
            </div>
            <div class="detail-item">
                <i data-feather="dollar-sign" class="mb-2"></i>
                <h5>Cost</h5>
                <p>Just $10<br>Materials Included</p>
            </div>
        </div>

        <!-- Pricing & What's Included -->
        <div class="registration-card">
            <h3>üéÅ Workshop Package - Only $10</h3>
            <div class="price-tag">$10 Materials Fee</div>
            <p>Everything you need for hands-on learning, plus take-home resources!</p>
            
            <div class="materials-included">
                <h5>üì¶ Materials Included:</h5>
                <div class="row">
                    <div class="col-md-6">
                        <ul>
                            <li>LECA pellets for semi-hydro method</li>
                            <li>Clear plastic pot with drainage holes</li>
                            <li>Fresh bark mix components</li>
                            <li>Root stimulator sample</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul>
                            <li>Fertilizer sample</li>
                            <li>Comprehensive care sheets</li>
                            <li>Semi-hydroponics guide</li>
                            <li>Light refreshments</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Culture Sheets Preview -->
        <div class="culture-sheets-preview">
            <h3>üìö Free Culture Sheets & Guides</h3>
            <p>Download these comprehensive guides right now - no registration required!</p>
            <div class="text-center">
                <a href="/static/workshop_materials/Dendrobium_kingianum_Culture_Sheet.html" class="download-link" target="_blank">
                    <i data-feather="download"></i> D. kingianum Culture Sheet
                </a>
                <a href="/static/workshop_materials/Semi_Hydroponics_LECA_Guide.html" class="download-link" target="_blank">
                    <i data-feather="download"></i> Semi-Hydroponics Guide
                </a>
                <a href="/static/workshop_materials/FCOS_Workshop_Advertisement.html" class="download-link" target="_blank">
                    <i data-feather="download"></i> Workshop Details
                </a>
            </div>
            <p class="mt-3"><small><em>These guides include Ray Barkalow's proven methods from First Rays Orchids and are perfectly adapted for Central Coast growing conditions.</em></small></p>
        </div>

        <!-- Registration Form -->
        <div class="registration-card">
            <h3>üé´ Workshop Registration</h3>
            <div class="form-section">
                <form id="workshopRegistration">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="firstName" class="form-label">First Name *</label>
                                <input type="text" class="form-control" id="firstName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="lastName" class="form-label">Last Name *</label>
                                <input type="text" class="form-control" id="lastName" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address *</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="phone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="phone">
                    </div>
                    
                    <div class="mb-3">
                        <label for="experience" class="form-label">Orchid Growing Experience</label>
                        <select class="form-select" id="experience">
                            <option value="">Select your experience level</option>
                            <option value="beginner">Beginner (0-2 years)</option>
                            <option value="intermediate">Intermediate (3-5 years)</option>
                            <option value="experienced">Experienced (5+ years)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="memberStatus" class="form-label">FCOS Membership Status</label>
                        <select class="form-select" id="memberStatus" required>
                            <option value="">Select membership status</option>
                            <option value="current">Current FCOS Member</option>
                            <option value="former">Former Member</option>
                            <option value="non-member">Not a Member (yet!)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="bringingOrchid">
                            <label class="form-check-label" for="bringingOrchid">
                                I'm bringing an orchid that needs repotting
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3" id="orchidDetails" style="display: none;">
                        <label for="orchidType" class="form-label">What type of orchid are you bringing?</label>
                        <input type="text" class="form-control" id="orchidType" placeholder="e.g., Dendrobium, Phalaenopsis, Cattleya">
                    </div>
                    
                    <div class="mb-3">
                        <label for="interests" class="form-label">Primary Interest</label>
                        <select class="form-select" id="interests">
                            <option value="">What interests you most?</option>
                            <option value="traditional">Traditional bark method</option>
                            <option value="semi-hydro">Semi-hydroponic method</option>
                            <option value="both">Both methods - want to compare</option>
                            <option value="learning">Just learning about repotting</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="specialNeeds" class="form-label">Special Accommodations</label>
                        <textarea class="form-control" id="specialNeeds" rows="2" placeholder="Any accessibility needs or dietary restrictions for refreshments?"></textarea>
                    </div>

                    <!-- Payment Method Selection -->
                    <div class="mb-4">
                        <h5>üí≥ Payment Method</h5>
                        <div class="payment-options">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="paymentChoice" id="payOnline" value="online" checked>
                                <label class="form-check-label" for="payOnline">
                                    <strong>Pay Online with PayPal</strong> - $10.39 (includes fees)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="paymentChoice" id="payLater" value="later">
                                <label class="form-check-label" for="payLater">
                                    <strong>Pay at Workshop</strong> - $10.00 (cash, check, or Venmo)
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="text-center">
                        <!-- Register and Pay Later Button -->
                        <button type="submit" class="btn btn-register btn-lg" id="registerLaterBtn" style="display: none;">
                            <i data-feather="calendar-plus"></i>
                            Register Now - Pay at Workshop
                        </button>
                        
                        <!-- PayPal Payment Section -->
                        <div id="paypalSection">
                            <button type="submit" class="btn btn-register btn-lg mb-3" id="registerOnlineBtn">
                                <i data-feather="calendar-plus"></i>
                                Register and Continue to Payment
                            </button>
                            
                            <!-- PayPal Button Container -->
                            <div id="paypal-button-container" style="display: none; margin-top: 20px;">
                                <p class="text-muted mb-3">Complete your registration with secure PayPal payment:</p>
                                
                                <!-- PayPal Form -->
                                <form action="https://www.paypal.com/donate" method="post" target="_blank" id="paypalForm">
                                    <input type="hidden" name="business" value="fivecitiesorchids@gmail.com" />
                                    <input type="hidden" name="item_name" value="FCOS Orchid Workshop Registration - September 28, 2025" />
                                    <input type="hidden" name="amount" value="10.39" />
                                    <input type="hidden" name="currency_code" value="USD" />
                                    <input type="hidden" name="return" value="https://fivecitiesorchids.org/workshop-success" />
                                    <input type="hidden" name="cancel_return" value="https://fivecitiesorchids.org/workshop-cancelled" />
                                    
                                    <button type="submit" class="btn btn-success btn-lg w-100">
                                        <i data-feather="credit-card"></i>
                                        Pay $10.39 with PayPal
                                    </button>
                                </form>
                                
                                <p class="text-muted mt-2"><small>You'll be redirected to PayPal to complete payment securely</small></p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Workshop Highlights -->
        <div class="registration-card">
            <h3>üåü What You'll Experience</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>Live Demonstration</h5>
                    <p>Watch as we divide and repot a large, healthy Dendrobium kingianum using both methods side-by-side.</p>
                    
                    <h5>Hands-On Practice</h5>
                    <p>Work with your own orchid or practice plants we provide, with expert guidance every step.</p>
                </div>
                <div class="col-md-6">
                    <h5>Expert Methods</h5>
                    <p>Learn Ray Barkalow's proven semi-hydroponic technique - 30+ years of research in action.</p>
                    
                    <h5>Local Focus</h5>
                    <p>Discover why Central Coast climate is perfect for both methods and how to use our natural advantages.</p>
                </div>
            </div>
        </div>

        <!-- Countdown Timer -->
        <div class="countdown-timer">
            <h4>‚è∞ Workshop in <span id="daysLeft">32</span> days!</h4>
            <p>Register now to secure your spot - limited to 20 participants</p>
        </div>

        <!-- Contact & Info -->
        <div class="registration-card">
            <h3>‚ùì Questions or Need Help?</h3>
            <p><strong>Workshop Coordinator:</strong> workshops@fivecitiesorchids.org</p>
            <p><strong>FCOS Info:</strong> info@fivecitiesorchids.org</p>
            <p><strong>Website:</strong> www.fivecitiesorchids.org</p>
            
            <div class="mt-3">
                <small class="text-muted">
                    <em>Five Cities Orchid Society - Growing Together Since 1985</em><br>
                    <em>Serving Arroyo Grande, Grover Beach, Oceano, Pismo Beach, and Shell Beach</em>
                </small>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"></script>
    <script>
        // Initialize Feather icons
        feather.replace();

        // Show/hide orchid details based on checkbox
        document.getElementById('bringingOrchid').addEventListener('change', function() {
            const orchidDetails = document.getElementById('orchidDetails');
            orchidDetails.style.display = this.checked ? 'block' : 'none';
        });

        // Handle payment method selection
        document.querySelectorAll('input[name="paymentChoice"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const registerLaterBtn = document.getElementById('registerLaterBtn');
                const paypalSection = document.getElementById('paypalSection');
                
                if (this.value === 'later') {
                    registerLaterBtn.style.display = 'block';
                    paypalSection.style.display = 'none';
                } else {
                    registerLaterBtn.style.display = 'none';
                    paypalSection.style.display = 'block';
                }
            });
        });

        // Store registration data globally
        let pendingRegistration = null;

        // Form submission
        document.getElementById('workshopRegistration').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect form data
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                experience: document.getElementById('experience').value,
                memberStatus: document.getElementById('memberStatus').value,
                bringingOrchid: document.getElementById('bringingOrchid').checked,
                orchidType: document.getElementById('orchidType').value,
                interests: document.getElementById('interests').value,
                specialNeeds: document.getElementById('specialNeeds').value,
                registrationDate: new Date().toISOString(),
                workshopDate: '2025-09-28',
                amount: document.querySelector('input[name="paymentChoice"]:checked').value === 'online' ? 10.39 : 10.00,
                paymentMethod: document.querySelector('input[name="paymentChoice"]:checked').value
            };

            const paymentChoice = document.querySelector('input[name="paymentChoice"]:checked').value;
            
            if (paymentChoice === 'later') {
                // Direct registration without payment
                submitRegistration(formData);
            } else {
                // Store data and show PayPal
                pendingRegistration = formData;
                showPayPalButton();
            }
        });

        function submitRegistration(formData, paymentData = null) {
            // Show loading state
            const submitBtn = document.querySelector('#workshopRegistration button[type="submit"]:not([style*="display: none"])');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i data-feather="loader"></i> Processing...';
            submitBtn.disabled = true;
            feather.replace();

            // Add payment data if provided
            if (paymentData) {
                formData.paymentId = paymentData.id;
                formData.paymentStatus = 'paid';
                formData.paymentMethod = 'paypal';
            } else {
                formData.paymentStatus = 'pending';
            }

            // Submit to server
            fetch('/api/workshop-registration', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(paymentData ? 
                        'Payment successful! Registration confirmed. You will receive a confirmation email shortly.' :
                        'Registration submitted successfully! You will receive a confirmation email. Payment due at workshop ($10 cash/check).'
                    );
                    
                    // Reset form
                    document.getElementById('workshopRegistration').reset();
                    document.getElementById('orchidDetails').style.display = 'none';
                    document.getElementById('paypal-button-container').style.display = 'none';
                    
                    // Reset payment method to default
                    document.getElementById('payOnline').checked = true;
                    document.getElementById('registerLaterBtn').style.display = 'none';
                    document.getElementById('paypalSection').style.display = 'block';
                    
                    // Update registration count
                    updateRegistrationCount();
                } else {
                    alert('Registration failed: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Registration failed. Please try again.');
            })
            .finally(() => {
                // Reset button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                feather.replace();
            });
        }

        function showPayPalButton() {
            const container = document.getElementById('paypal-button-container');
            container.style.display = 'block';
            
            // Add event listener to PayPal form submission
            document.getElementById('paypalForm').addEventListener('submit', function() {
                // Mark registration as payment pending
                pendingRegistration.paymentStatus = 'pending';
                pendingRegistration.paymentMethod = 'paypal';
                
                // Submit registration to database
                submitRegistration(pendingRegistration);
                
                // Inform user they'll be redirected
                setTimeout(() => {
                    alert('Registration saved! You\'ll now be redirected to PayPal to complete payment.');
                }, 100);
            });
            
            feather.replace(); // Refresh icons
        }

        function updateRegistrationCount() {
            fetch('/api/workshop-stats')
            .then(response => response.json())
            .then(data => {
                const spotsLeft = data.spots_available;
                const confirmed = data.confirmed_registrations;
                document.getElementById('registrationStatus').innerHTML = `‚úÖ ${spotsLeft} spots available (${confirmed} of 20 registered)`;
            })
            .catch(error => {
                console.error('Failed to update registration count:', error);
            });
        }

        // Update countdown timer
        function updateCountdown() {
            const workshopDate = new Date('2025-09-28');
            const now = new Date();
            const timeDiff = workshopDate - now;
            const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
            
            if (daysLeft > 0) {
                document.getElementById('daysLeft').textContent = daysLeft;
            } else {
                document.querySelector('.countdown-timer').innerHTML = '<h4>üéâ Workshop is today!</h4>';
            }
        }

        updateCountdown();
        setInterval(updateCountdown, 1000 * 60 * 60); // Update every hour
    </script>
</body>
</html>