<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Help Us ID These Orchids - Five Cities Orchid Society</title>
    
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f4c75);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }
        
        .hero-section {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(220, 53, 69, 0.1));
            padding: 3rem 0;
            border-bottom: 1px solid rgba(255, 193, 7, 0.3);
            text-align: center;
        }
        
        .hero-title {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ffc107, #dc3545, #fd7e14);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .mystery-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        
        .mystery-card:hover {
            border-color: #ffc107;
            background: rgba(255, 193, 7, 0.1);
            transform: translateY(-5px);
        }
        
        .orchid-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        
        .mystery-badge {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
            color: #000;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 1rem;
        }
        
        .current-label {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 1rem;
        }
        
        .suggested-id {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 1rem;
        }
        
        .voting-section {
            background: rgba(0, 123, 255, 0.1);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 1rem;
        }
        
        .vote-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        
        .vote-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }
        
        .vote-count {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        
        .status-needed {
            color: #ffc107;
            font-weight: bold;
        }
        
        .status-votes {
            color: #17a2b8;
        }
        
        .expert-note {
            background: rgba(102, 16, 242, 0.2);
            border-left: 4px solid #6610f2;
            padding: 10px;
            margin-top: 10px;
            border-radius: 0 8px 8px 0;
        }
        
        .suggestion-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <img src="/static/images/orchid_continuum_new_logo.png" alt="Five Cities Orchid Society" height="40">
                <span class="ms-2">Five Cities Orchid Society</span>
            </a>
            
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/gallery">
                    <i data-feather="image" class="me-1"></i>Gallery
                </a>
                <a class="nav-link" href="/unidentified-orchids">
                    <i data-feather="help-circle" class="me-1"></i>Help ID
                </a>
            </div>
        </div>
    </nav>

    <div class="hero-section">
        <div class="container">
            <h1 class="hero-title">üîç Help Us ID These Orchids</h1>
            <p class="lead">Community-driven identification ‚Ä¢ Expert validation required</p>
            <div class="row mt-4">
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="display-6">{{ stats.unidentified_count }}</div>
                        <div class="status-needed">Orchids Need ID</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="display-6">{{ stats.total_votes }}</div>
                        <div class="status-votes">Community Votes</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="display-6">{{ stats.pending_approval }}</div>
                        <div>Awaiting 2nd Opinion</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-5">
        {% if unidentified_orchids %}
            <div class="row">
                {% for orchid in unidentified_orchids %}
                <div class="col-lg-6 col-xl-4">
                    <div class="mystery-card">
                        <div class="mystery-badge">
                            ü§î Needs Expert ID
                        </div>
                        
                        <img src="{{ orchid.image_url }}" 
                             alt="{{ orchid.display_name }}" 
                             class="orchid-image"
                             onerror="this.src='/static/images/orchid_placeholder.svg'">
                        
                        <div class="current-label">
                            <strong>Currently labeled as:</strong><br>
                            <em>{{ orchid.display_name }}</em>
                            <div class="small text-muted mt-1">
                                Genus: {{ orchid.genus or 'Unknown' }} ‚Ä¢ Species: {{ orchid.species or 'Unknown' }}
                            </div>
                        </div>
                        
                        {% if orchid.suggested_genus %}
                        <div class="suggested-id">
                            <strong>Suggested correct ID:</strong><br>
                            <em>{{ orchid.suggested_genus }}{% if orchid.suggested_species %} {{ orchid.suggested_species }}{% endif %}</em>
                            <div class="vote-count mt-2">
                                <i data-feather="thumbs-up" style="width: 14px; height: 14px;" class="me-1"></i>
                                {{ orchid.identification_votes }} vote{{ 's' if orchid.identification_votes != 1 else '' }}
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="voting-section">
                            <h6><i data-feather="users" class="me-1"></i>Community Vote</h6>
                            <p class="small mb-3">Help us confirm this identification. We need 2+ votes to verify.</p>
                            
                            {% if orchid.suggested_genus %}
                            <button class="vote-btn" onclick="castVote({{ orchid.id }}, 'agree')">
                                <i data-feather="check" style="width: 14px; height: 14px;" class="me-1"></i>
                                Agree with {{ orchid.suggested_genus }}
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="toggleSuggestionForm({{ orchid.id }})">
                                <i data-feather="edit-3" style="width: 14px; height: 14px;" class="me-1"></i>
                                Different ID?
                            </button>
                            {% else %}
                            <button class="btn btn-warning" onclick="toggleSuggestionForm({{ orchid.id }})">
                                <i data-feather="lightbulb" style="width: 14px; height: 14px;" class="me-1"></i>
                                Suggest Identification
                            </button>
                            {% endif %}
                        </div>
                        
                        <!-- Suggestion Form (Hidden by default) -->
                        <div id="suggestion-form-{{ orchid.id }}" class="suggestion-form" style="display: none;">
                            <h6>Suggest New Identification</h6>
                            <div class="row">
                                <div class="col-6">
                                    <input type="text" class="form-control form-control-sm" 
                                           id="genus-{{ orchid.id }}" placeholder="Genus" required>
                                </div>
                                <div class="col-6">
                                    <input type="text" class="form-control form-control-sm" 
                                           id="species-{{ orchid.id }}" placeholder="Species (optional)">
                                </div>
                            </div>
                            <textarea class="form-control form-control-sm mt-2" 
                                      id="notes-{{ orchid.id }}" 
                                      placeholder="Why do you think this is the correct ID? (optional)" 
                                      rows="2"></textarea>
                            <div class="mt-2">
                                <button class="btn btn-success btn-sm" onclick="submitSuggestion({{ orchid.id }})">
                                    Submit Suggestion
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="toggleSuggestionForm({{ orchid.id }})">
                                    Cancel
                                </button>
                            </div>
                        </div>
                        
                        <!-- Expert Notes -->
                        {% for vote in orchid.expert_votes %}
                        <div class="expert-note">
                            <small><strong>Expert Note:</strong> {{ vote.notes }}</small>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-5">
                <div class="display-1">üéâ</div>
                <h3>All Orchids Identified!</h3>
                <p class="lead">Great work community! All orchids currently have proper identification.</p>
                <a href="/gallery" class="btn btn-primary">
                    <i data-feather="image" class="me-1"></i>Browse Verified Gallery
                </a>
            </div>
        {% endif %}
    </div>

    <div class="container-fluid bg-dark py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <h5>How Community Identification Works</h5>
                    <ul class="list-unstyled small">
                        <li>üîç <strong>Report:</strong> Anyone can report a mislabeled orchid</li>
                        <li>ü§î <strong>Review:</strong> Reported orchids move to this "Help Us ID" section</li>
                        <li>üë• <strong>Vote:</strong> Community members suggest and vote on correct IDs</li>
                        <li>‚úÖ <strong>Verify:</strong> 2+ matching votes = verified identification</li>
                        <li>üìö <strong>Return:</strong> Correctly identified orchids return to main gallery</li>
                    </ul>
                </div>
                <div class="col-md-4 text-end">
                    <a href="/gallery" class="btn btn-outline-light">
                        <i data-feather="arrow-left" class="me-1"></i>Back to Gallery
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize Feather icons
        feather.replace();
        
        function toggleSuggestionForm(orchidId) {
            const form = document.getElementById(`suggestion-form-${orchidId}`);
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }
        
        function castVote(orchidId, voteType) {
            if (voteType === 'agree') {
                fetch(`/api/orchid/${orchidId}/vote-agree`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('Vote recorded! Thank you for helping identify this orchid.', 'success');
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showToast(data.message || 'Error recording vote', 'error');
                    }
                })
                .catch(error => {
                    showToast('Error recording vote', 'error');
                });
            }
        }
        
        function submitSuggestion(orchidId) {
            const genus = document.getElementById(`genus-${orchidId}`).value.trim();
            const species = document.getElementById(`species-${orchidId}`).value.trim();
            const notes = document.getElementById(`notes-${orchidId}`).value.trim();
            
            if (!genus) {
                showToast('Please enter at least the genus name', 'error');
                return;
            }
            
            fetch(`/api/orchid/${orchidId}/suggest-id`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    genus: genus,
                    species: species,
                    notes: notes
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('Suggestion submitted! Thank you for contributing.', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showToast(data.message || 'Error submitting suggestion', 'error');
                }
            })
            .catch(error => {
                showToast('Error submitting suggestion', 'error');
            });
        }
        
        function showToast(message, type) {
            // Simple toast notification
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : '#dc3545'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 9999;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>