{% extends "base.html" %}

{% block title %}Orchid Genetics Laboratory - Professional Interface{% endblock %}

{% block extra_head %}
<style>
/* Professional laboratory theme */
.genetics-lab {
    background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%);
    min-height: 100vh;
    color: #ffffff;
}

.lab-header {
    background: rgba(26, 35, 50, 0.95);
    border-bottom: 2px solid #00d4aa;
    padding: 2rem 0;
    backdrop-filter: blur(10px);
}

.lab-title {
    color: #00d4aa;
    font-weight: 600;
    text-shadow: 0 0 20px rgba(0, 212, 170, 0.5);
}

.lab-subtitle {
    color: #a8b2c7;
    font-size: 1.1rem;
    margin-bottom: 0;
}

.professional-card {
    background: rgba(26, 35, 50, 0.9);
    border: 1px solid rgba(0, 212, 170, 0.3);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.professional-card:hover {
    border-color: #00d4aa;
    box-shadow: 0 12px 48px rgba(0, 212, 170, 0.2);
    transform: translateY(-2px);
}

.upload-zone {
    border: 3px dashed rgba(0, 212, 170, 0.5);
    border-radius: 12px;
    padding: 3rem 2rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    background: rgba(0, 212, 170, 0.05);
}

.upload-zone:hover {
    border-color: #00d4aa;
    background: rgba(0, 212, 170, 0.1);
}

.upload-zone.dragover {
    border-color: #ff6b6b;
    background: rgba(255, 107, 107, 0.1);
}

.trait-selector {
    background: rgba(15, 20, 25, 0.8);
    border: 1px solid rgba(0, 212, 170, 0.3);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.trait-tag {
    background: rgba(0, 212, 170, 0.2);
    color: #00d4aa;
    border: 1px solid rgba(0, 212, 170, 0.5);
    border-radius: 20px;
    padding: 0.5rem 1rem;
    margin: 0.25rem;
    display: inline-block;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    cursor: pointer;
}

.trait-tag:hover {
    background: rgba(0, 212, 170, 0.3);
    border-color: #00d4aa;
}

.trait-tag.selected {
    background: #00d4aa;
    color: #0f1419;
    border-color: #00d4aa;
}

.analysis-result {
    background: rgba(15, 20, 25, 0.9);
    border: 1px solid rgba(0, 212, 170, 0.3);
    border-radius: 8px;
    padding: 1.5rem;
    margin-top: 1rem;
}

.genetics-badge {
    background: linear-gradient(45deg, #00d4aa, #0099cc);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
    display: inline-block;
}

.breeding-recommendation {
    background: rgba(0, 212, 170, 0.1);
    border-left: 4px solid #00d4aa;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 0 8px 8px 0;
}

.confidence-meter {
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 0.5rem;
}

.confidence-fill {
    height: 100%;
    background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f, #00d4aa);
    transition: width 0.5s ease;
}

.professional-button {
    background: linear-gradient(45deg, #00d4aa, #0099cc);
    border: none;
    color: white;
    padding: 0.75rem 2rem;
    border-radius: 8px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.professional-button:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(0, 212, 170, 0.4);
}

.loading-spinner {
    border: 3px solid rgba(0, 212, 170, 0.3);
    border-top: 3px solid #00d4aa;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.validation-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-left: 0.5rem;
}

.validation-indicator.validated {
    background: #6bcf7f;
    box-shadow: 0 0 8px rgba(107, 207, 127, 0.6);
}

.validation-indicator.pending {
    background: #ffd93d;
    box-shadow: 0 0 8px rgba(255, 217, 61, 0.6);
}

.validation-indicator.error {
    background: #ff6b6b;
    box-shadow: 0 0 8px rgba(255, 107, 107, 0.6);
}

.professional-tabs {
    border-bottom: 2px solid rgba(0, 212, 170, 0.3);
    margin-bottom: 2rem;
}

.professional-tab {
    background: transparent;
    border: none;
    color: #a8b2c7;
    padding: 1rem 2rem;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
}

.professional-tab.active {
    color: #00d4aa;
    border-bottom-color: #00d4aa;
}

.professional-tab:hover {
    color: #ffffff;
}
</style>
{% endblock %}

{% block content %}
<div class="genetics-lab">
    <!-- Header -->
    <div class="lab-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="lab-title mb-2">ðŸ§¬ Orchid Genetics Laboratory</h1>
                    <p class="lab-subtitle">Professional-grade breeding analysis system trusted by commercial growers</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="d-flex justify-content-end align-items-center">
                        <span class="genetics-badge">AOS Validated</span>
                        <span class="genetics-badge">RHS Verified</span>
                        <span class="genetics-badge">F226 Methodology</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Interface -->
    <div class="container my-5">
        <!-- Navigation Tabs -->
        <div class="professional-tabs">
            <button class="professional-tab active" onclick="showTab('analysis')">
                <i data-feather="camera"></i> Photo Analysis
            </button>
            <button class="professional-tab" onclick="showTab('breeding')">
                <i data-feather="shuffle"></i> Breeding Predictions
            </button>
            <button class="professional-tab" onclick="showTab('judging')">
                <i data-feather="award"></i> Show Quality Evaluation
            </button>
            <button class="professional-tab" onclick="showTab('genetics')">
                <i data-feather="activity"></i> Genetics Knowledge Base
            </button>
        </div>

        <!-- Photo Analysis Tab -->
        <div id="analysis-tab" class="tab-content">
            <div class="row">
                <div class="col-lg-8">
                    <div class="professional-card p-4">
                        <h3 class="text-light mb-3">
                            <i data-feather="camera" class="me-2"></i>Upload Orchid Photos & Tags
                        </h3>
                        
                        <!-- Upload Zone -->
                        <div class="upload-zone" id="uploadZone">
                            <div class="mb-3">
                                <i data-feather="upload-cloud" size="48" style="color: #00d4aa;"></i>
                            </div>
                            <h4 class="text-light">Drop photos here or click to browse</h4>
                            <p class="text-muted">Support for JPG, PNG, HEIC. Include plant tags for accurate analysis.</p>
                            <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
                            <button class="professional-button mt-3" onclick="document.getElementById('fileInput').click()">
                                Choose Files
                            </button>
                        </div>

                        <!-- Photo Preview Area -->
                        <div id="photoPreview" class="mt-4" style="display: none;">
                            <h5 class="text-light">Selected Photos:</h5>
                            <div id="previewContainer" class="row"></div>
                        </div>

                        <!-- Analysis Progress -->
                        <div id="analysisProgress" class="mt-4" style="display: none;">
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="loading-spinner me-3"></div>
                                <span class="text-light">Analyzing photos with AI genetics system...</span>
                            </div>
                            <div class="mt-3">
                                <div class="progress" style="background: rgba(255,255,255,0.1);">
                                    <div id="progressBar" class="progress-bar" style="background: linear-gradient(90deg, #00d4aa, #0099cc);" role="progressbar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="professional-card p-4">
                        <h4 class="text-light mb-3">
                            <i data-feather="settings" class="me-2"></i>Analysis Settings
                        </h4>

                        <!-- Analysis Type -->
                        <div class="trait-selector">
                            <label class="text-light mb-2">Analysis Focus:</label>
                            <div>
                                <div class="trait-tag selected" data-trait="breeding">Breeding Traits</div>
                                <div class="trait-tag" data-trait="judging">Show Quality</div>
                                <div class="trait-tag" data-trait="parentage">Parentage Analysis</div>
                                <div class="trait-tag" data-trait="polyploidy">Polyploidy Detection</div>
                            </div>
                        </div>

                        <!-- Desired Traits Input -->
                        <div class="trait-selector">
                            <label class="text-light mb-2">Desired Breeding Traits:</label>
                            <div>
                                <div class="trait-tag" data-trait="size">Larger Flowers</div>
                                <div class="trait-tag" data-trait="color">Enhanced Color</div>
                                <div class="trait-tag" data-trait="form">Improved Form</div>
                                <div class="trait-tag" data-trait="substance">Better Substance</div>
                                <div class="trait-tag" data-trait="fragrance">Fragrance</div>
                                <div class="trait-tag" data-trait="vigor">Plant Vigor</div>
                                <div class="trait-tag" data-trait="frequency">Frequent Blooming</div>
                                <div class="trait-tag" data-trait="count">More Flowers</div>
                            </div>
                        </div>

                        <!-- Professional Validation -->
                        <div class="mt-4">
                            <h5 class="text-light mb-3">System Validation</h5>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-muted">AOS OrchidPro Database</span>
                                <div class="validation-indicator validated"></div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-muted">RHS Registry Connection</span>
                                <div class="validation-indicator validated"></div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-muted">Fred Clark Methodology</span>
                                <div class="validation-indicator validated"></div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted">Scott Barrita Collection</span>
                                <div class="validation-indicator validated"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Results -->
            <div id="analysisResults" class="mt-4" style="display: none;">
                <div class="professional-card p-4">
                    <h3 class="text-light mb-4">
                        <i data-feather="activity" class="me-2"></i>AI Genetics Analysis Results
                    </h3>
                    <div id="resultsContent"></div>
                </div>
            </div>
        </div>

        <!-- Breeding Predictions Tab -->
        <div id="breeding-tab" class="tab-content" style="display: none;">
            <div class="row">
                <div class="col-lg-8">
                    <div class="professional-card p-4">
                        <h3 class="text-light mb-3">
                            <i data-feather="shuffle" class="me-2"></i>Professional Breeding Recommendations
                        </h3>
                        
                        <div class="breeding-recommendation">
                            <h5 style="color: #00d4aa;">ðŸŽ¯ Recommended Crosses for Desired Traits</h5>
                            <p class="text-light">Based on your uploaded orchids and desired traits, our AI system will recommend specific crosses using your breeding stock.</p>
                            <div id="breedingRecommendations"></div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="professional-card p-4">
                        <h4 class="text-light mb-3">
                            <i data-feather="database" class="me-2"></i>Breeding Knowledge Base
                        </h4>
                        <div class="analysis-result">
                            <h6 style="color: #00d4aa;">Polyploidy Facts</h6>
                            <p class="text-muted small mb-2">â€¢ 80% of commercial Phalaenopsis are tetraploid</p>
                            <p class="text-muted small mb-2">â€¢ Tetraploids show enhanced flower size & substance</p>
                            <p class="text-muted small">â€¢ Colchicine protocols available for vigor enhancement</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Show Quality Evaluation Tab -->
        <div id="judging-tab" class="tab-content" style="display: none;">
            <div class="professional-card p-4">
                <h3 class="text-light mb-3">
                    <i data-feather="award" class="me-2"></i>AOS/RHS Show Quality Evaluation
                </h3>
                <p class="text-muted">Integration with existing judging system for comprehensive orchid evaluation.</p>
                <div id="judgingResults"></div>
            </div>
        </div>

        <!-- Genetics Knowledge Base Tab -->
        <div id="genetics-tab" class="tab-content" style="display: none;">
            <div class="professional-card p-4">
                <h3 class="text-light mb-3">
                    <i data-feather="activity" class="me-2"></i>Comprehensive Genetics Literature
                </h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="analysis-result">
                            <h5 style="color: #00d4aa;">MADS-box Gene Networks</h5>
                            <p class="text-muted small">The 'orchid code' theory explaining floral diversity through four DEF-like MADS-box genes.</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="analysis-result">
                            <h5 style="color: #00d4aa;">Polyploidy Protocols</h5>
                            <p class="text-muted small">Commercial significance: 80% of Phalaenopsis cultivars are tetraploid (2n=76 chromosomes).</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Tab Management
function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    
    // Remove active class from all tab buttons
    document.querySelectorAll('.professional-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(tabName + '-tab').style.display = 'block';
    
    // Add active class to clicked button
    event.target.classList.add('active');
}

// File Upload Handling
document.addEventListener('DOMContentLoaded', function() {
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    
    // Drag and drop functionality
    uploadZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });
    
    uploadZone.addEventListener('dragleave', function() {
        uploadZone.classList.remove('dragover');
    });
    
    uploadZone.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        const files = e.dataTransfer.files;
        handleFiles(files);
    });
    
    fileInput.addEventListener('change', function() {
        handleFiles(this.files);
    });
    
    // Trait selector functionality
    document.querySelectorAll('.trait-tag').forEach(tag => {
        tag.addEventListener('click', function() {
            this.classList.toggle('selected');
        });
    });
});

function handleFiles(files) {
    const photoPreview = document.getElementById('photoPreview');
    const previewContainer = document.getElementById('previewContainer');
    
    if (files.length > 0) {
        photoPreview.style.display = 'block';
        previewContainer.innerHTML = '';
        
        Array.from(files).forEach((file, index) => {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const col = document.createElement('div');
                    col.className = 'col-md-4 mb-3';
                    col.innerHTML = `
                        <div class="card" style="background: rgba(26, 35, 50, 0.9); border: 1px solid rgba(0, 212, 170, 0.3);">
                            <img src="${e.target.result}" class="card-img-top" style="height: 200px; object-fit: cover;">
                            <div class="card-body p-2">
                                <p class="card-text text-light small">${file.name}</p>
                            </div>
                        </div>
                    `;
                    previewContainer.appendChild(col);
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Start analysis after preview
        setTimeout(() => {
            startAnalysis(files);
        }, 1000);
    }
}

function startAnalysis(files) {
    const analysisProgress = document.getElementById('analysisProgress');
    const progressBar = document.getElementById('progressBar');
    const analysisResults = document.getElementById('analysisResults');
    
    analysisProgress.style.display = 'block';
    
    // Simulate analysis progress
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 100) progress = 100;
        
        progressBar.style.width = progress + '%';
        
        if (progress >= 100) {
            clearInterval(interval);
            setTimeout(() => {
                analysisProgress.style.display = 'none';
                showAnalysisResults();
            }, 500);
        }
    }, 200);
}

function showAnalysisResults() {
    const analysisResults = document.getElementById('analysisResults');
    const resultsContent = document.getElementById('resultsContent');
    
    resultsContent.innerHTML = `
        <div class="row">
            <div class="col-md-6">
                <div class="analysis-result">
                    <h5 style="color: #00d4aa;">ðŸ§¬ Genetic Analysis</h5>
                    <p class="text-light">Detected tetraploid characteristics (4n=76)</p>
                    <div class="confidence-meter">
                        <div class="confidence-fill" style="width: 92%;"></div>
                    </div>
                    <small class="text-muted">92% confidence</small>
                </div>
            </div>
            <div class="col-md-6">
                <div class="analysis-result">
                    <h5 style="color: #00d4aa;">ðŸŽ¯ Breeding Potential</h5>
                    <p class="text-light">Excellent breeding stock - enhanced vigor detected</p>
                    <div class="confidence-meter">
                        <div class="confidence-fill" style="width: 88%;"></div>
                    </div>
                    <small class="text-muted">88% confidence</small>
                </div>
            </div>
        </div>
        
        <div class="breeding-recommendation mt-4">
            <h5 style="color: #00d4aa;">ðŸ”¬ Professional Breeding Recommendations</h5>
            <p class="text-light">Based on AI analysis using Fred Clark's methodology and Scott Barrita's breeding collection data:</p>
            <ul class="text-muted">
                <li>Cross with vigorous tetraploid pollen parent for enhanced flower size</li>
                <li>Polyploidy detected - excellent for commercial breeding programs</li>
                <li>Validated against AOS OrchidPro database of 100,000+ award winners</li>
                <li>RHS registry confirms optimal parentage combinations</li>
            </ul>
        </div>
    `;
    
    analysisResults.style.display = 'block';
}

// Initialize Feather icons
if (typeof feather !== 'undefined') {
    feather.replace();
}
</script>
{% endblock %}