<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Submissions - FCOS Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.css" rel="stylesheet">
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, #8E44AD, #9B59B6);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        .submission-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
        }
        .email-preview {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
        }
        .campaign-button {
            background: linear-gradient(135deg, #8E44AD, #9B59B6);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }
        .campaign-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #F4E8F9, #F9F2FF);
            border-radius: 10px;
            border: 1px solid #E1BEE7;
        }
        .member-requirements {
            background: #E8F5E8;
            border-left: 5px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="container">
            <h1><i data-feather="users"></i> Member Submissions</h1>
            <p class="lead">Manage content requests for newsletter, Members Garden, and YouTube features</p>
        </div>
    </div>

    <div class="container">
        <!-- Email Campaign Trigger -->
        <div class="submission-card">
            <h3>üìß Send Submission Request Email</h3>
            <p>Automatically send a beautifully formatted email to all FCOS members requesting submissions for the monthly newsletter and Members Garden.</p>
            
            <div class="member-requirements">
                <h5>üìã Email Will Request:</h5>
                <ul class="mb-0">
                    <li><strong>Orchid Photos</strong> - with genus/species, growing conditions, member name, email, city</li>
                    <li><strong>Growing Stories</strong> - success stories, challenges, rescue tales</li>
                    <li><strong>Care Articles</strong> - tips, techniques, seasonal advice</li>
                    <li><strong>Video Content</strong> - demos, time-lapses, collection tours</li>
                    <li><strong>YouTube Features</strong> - member showcases and educational content</li>
                </ul>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <button class="btn btn-outline-primary w-100" onclick="sendTestEmail()">
                        <i data-feather="mail"></i> Send Test Email
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="campaign-button w-100" onclick="triggerSubmissionRequest()">
                        <i data-feather="send"></i> Send to All Members
                    </button>
                </div>
                <div class="col-md-4">
                    <div id="requestStatus" class="d-flex align-items-center h-100 text-muted">
                        Ready to send
                    </div>
                </div>
            </div>
            
            <!-- Test Email Section -->
            <div class="mt-3" id="testEmailSection">
                <div class="row">
                    <div class="col-md-6">
                        <label for="testEmailAddress" class="form-label">Test Email Address:</label>
                        <input type="email" class="form-control" id="testEmailAddress" value="jeffery@fivecitiesorchidsociety.org" placeholder="Enter email for test">
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-end h-100">
                            <small class="text-muted">Send a test first to see how the email looks before sending to all members.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Preview -->
        <div class="submission-card" id="emailPreview" style="display: none;">
            <h3>üìã Email Content Preview</h3>
            <div class="email-preview" id="emailContent">
                <h4>üå∫ Share Your Orchid Journey - Newsletter Submissions</h4>
                <p><strong>Subject:</strong> üå∫ Share Your Orchid Story - August 2025 Newsletter Submissions</p>
                
                <div class="mt-3">
                    <h5>Email Content Highlights:</h5>
                    <ul>
                        <li>Professional HTML design with FCOS branding</li>
                        <li>Clear submission requirements and deadlines</li>
                        <li>Direct link to Members Garden Google Form</li>
                        <li>Instructions for photo submissions with metadata</li>
                        <li>Information about personal member galleries</li>
                        <li>YouTube channel feature opportunities</li>
                        <li>Beautiful formatting with orchid-themed styling</li>
                    </ul>
                </div>
                
                <div class="mt-3">
                    <h5>Includes These Sections:</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <ul>
                                <li>What we're looking for</li>
                                <li>Photo submission requirements</li>
                                <li>Growing information needed</li>
                                <li>Member attribution guidelines</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul>
                                <li>Newsletter feature benefits</li>
                                <li>Website gallery integration</li>
                                <li>Personal member area access</li>
                                <li>YouTube opportunity details</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reminder Campaign -->
        <div class="submission-card">
            <h3>‚è∞ Submission Deadline Reminders</h3>
            <p>Send gentle reminder emails to members who haven't submitted content as the deadline approaches.</p>
            
            <div class="row">
                <div class="col-md-6">
                    <button class="btn btn-outline-warning w-100" onclick="sendSubmissionReminders()">
                        <i data-feather="clock"></i> Send Deadline Reminders
                    </button>
                </div>
                <div class="col-md-6">
                    <div id="reminderStatus" class="d-flex align-items-center h-100 text-muted">
                        Targets members who haven't submitted yet
                    </div>
                </div>
            </div>
        </div>

        <!-- Members Garden Statistics -->
        <div class="submission-card">
            <h3>üìä Members Garden Statistics</h3>
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <h4 id="totalSubmissions">-</h4>
                    <p>Total Submissions</p>
                </div>
                <div class="stat-card">
                    <h4 id="monthlySubmissions">-</h4>
                    <p>This Month</p>
                </div>
                <div class="stat-card">
                    <h4 id="activeContributors">-</h4>
                    <p>Active Contributors</p>
                </div>
                <div class="stat-card">
                    <h4 id="photoSubmissions">-</h4>
                    <p>Photo Submissions</p>
                </div>
                <div class="stat-card">
                    <h4 id="storySubmissions">-</h4>
                    <p>Story Submissions</p>
                </div>
                <div class="stat-card">
                    <h4 id="engagementRate">-</h4>
                    <p>Engagement Rate</p>
                </div>
            </div>
            
            <button class="btn btn-outline-primary" onclick="loadMembersGardenStats()">
                <i data-feather="refresh-cw"></i> Refresh Statistics
            </button>
        </div>

        <!-- Neon One Integration -->
        <div class="submission-card">
            <h3>üîó Neon One Email Campaign Integration</h3>
            <p>These submission emails integrate seamlessly with your Neon One CRM system:</p>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>Required Email Templates</h5>
                    <ul>
                        <li><strong>FCOS_SUBMISSION_REQUEST</strong> - Main submission request</li>
                        <li><strong>FCOS_SUBMISSION_REMINDER</strong> - Deadline reminders</li>
                        <li><strong>FCOS_SUBMISSION_THANKS</strong> - Thank you for submissions</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Automation Features</h5>
                    <ul>
                        <li>Sends to all active FCOS members</li>
                        <li>Tracks email open and click rates</li>
                        <li>Integrates with member database</li>
                        <li>Automatic thank you emails</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Members Garden Setup -->
        <div class="submission-card">
            <h3>üå± Members Garden Google Form Setup</h3>
            <p>The submission emails direct members to a Google Form that collects:</p>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>Photo Submissions</h5>
                    <ul>
                        <li>Orchid photos (high resolution)</li>
                        <li>Genus and species/hybrid name</li>
                        <li>Growing conditions and medium</li>
                        <li>Light and watering schedule</li>
                        <li>Member name and location</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Content Submissions</h5>
                    <ul>
                        <li>Growing stories and experiences</li>
                        <li>Care tips and techniques</li>
                        <li>Video content for YouTube</li>
                        <li>Member contact information</li>
                        <li>Permission for newsletter use</li>
                    </ul>
                </div>
            </div>
            
            <div class="alert alert-info mt-3">
                <strong>Note:</strong> Update the Google Form ID in the member_submission_email_template.py file to connect to your actual Members Garden form.
            </div>
        </div>

        <!-- Submission Process Flow -->
        <div class="submission-card">
            <h3>üîÑ Submission Process Flow</h3>
            <div class="row">
                <div class="col-md-3 text-center">
                    <div class="stat-card">
                        <h5>1. Email Request</h5>
                        <p>Send to all members via Neon One</p>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="stat-card">
                        <h5>2. Form Submission</h5>
                        <p>Members fill out Google Form</p>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="stat-card">
                        <h5>3. Content Review</h5>
                        <p>Admin reviews and approves</p>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="stat-card">
                        <h5>4. Publication</h5>
                        <p>Featured in newsletter & gallery</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"></script>
    <script>
        feather.replace();

        function sendTestEmail() {
            const testEmail = document.getElementById('testEmailAddress').value;
            const status = document.getElementById('requestStatus');
            
            if (!testEmail) {
                alert('Please enter a test email address');
                return;
            }
            
            status.textContent = 'Sending test email...';

            fetch('/api/trigger-submission-request', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    test_mode: true,
                    test_email: testEmail
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    status.innerHTML = `<span class="text-success">‚úÖ Test email sent to ${testEmail}!</span>`;
                    document.getElementById('emailPreview').style.display = 'block';
                    
                    if (data.campaign_results.email_subject) {
                        status.innerHTML += `<br><small class="text-info">Subject: ${data.campaign_results.email_subject}</small>`;
                    }
                } else {
                    status.innerHTML = '<span class="text-danger">‚ùå Test email failed: ' + data.error + '</span>';
                }
            })
            .catch(error => {
                status.innerHTML = '<span class="text-danger">‚ùå Error: ' + error.message + '</span>';
            });
        }

        function triggerSubmissionRequest() {
            const button = document.querySelector('.campaign-button');
            const status = document.getElementById('requestStatus');
            
            // Confirm before sending to all members
            if (!confirm('Are you sure you want to send submission request emails to ALL FCOS members?')) {
                return;
            }
            
            button.disabled = true;
            button.innerHTML = '<div class="spinner-border spinner-border-sm me-2" role="status"></div>Sending...';
            status.textContent = 'Triggering submission request campaign...';

            fetch('/api/trigger-submission-request', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    test_mode: false
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    status.innerHTML = '<span class="text-success">‚úÖ Submission request emails sent to all FCOS members!</span>';
                    document.getElementById('emailPreview').style.display = 'block';
                    
                    // Show campaign results
                    if (data.campaign_results.email_sent) {
                        status.innerHTML += '<br><small class="text-success">Neon One campaign triggered successfully</small>';
                    }
                } else {
                    status.innerHTML = '<span class="text-danger">‚ùå Campaign failed: ' + data.error + '</span>';
                }
            })
            .catch(error => {
                status.innerHTML = '<span class="text-danger">‚ùå Error: ' + error.message + '</span>';
            })
            .finally(() => {
                button.disabled = false;
                button.innerHTML = '<i data-feather="send"></i> Send to All Members';
                feather.replace();
            });
        }

        function sendSubmissionReminders() {
            const status = document.getElementById('reminderStatus');
            status.textContent = 'Sending deadline reminders...';

            fetch('/api/send-submission-reminders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    status.innerHTML = '<span class="text-success">‚úÖ Reminder emails sent!</span>';
                } else {
                    status.innerHTML = '<span class="text-danger">‚ùå Reminder failed: ' + data.error + '</span>';
                }
            })
            .catch(error => {
                status.innerHTML = '<span class="text-danger">‚ùå Error: ' + error.message + '</span>';
            });
        }

        function loadMembersGardenStats() {
            fetch('/api/members-garden-stats')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const stats = data.stats;
                        document.getElementById('totalSubmissions').textContent = stats.total_submissions;
                        document.getElementById('monthlySubmissions').textContent = stats.monthly_submissions;
                        document.getElementById('activeContributors').textContent = stats.active_contributors;
                        document.getElementById('photoSubmissions').textContent = stats.photo_submissions;
                        document.getElementById('storySubmissions').textContent = stats.story_submissions;
                        document.getElementById('engagementRate').textContent = stats.member_engagement_rate;
                    }
                })
                .catch(error => {
                    console.error('Failed to load stats:', error);
                });
        }

        // Load stats on page load
        loadMembersGardenStats();
    </script>
</body>
</html>