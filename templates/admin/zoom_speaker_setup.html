<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoom Speaker Management - FCOS Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.css" rel="stylesheet">
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, #4A90E2, #5A9FD4);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        .speaker-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
        }
        .speaker-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .marketing-preview {
            background: #E3F2FD;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #2196F3;
        }
        .schedule-button {
            background: linear-gradient(135deg, #4A90E2, #5A9FD4);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }
        .schedule-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
        }
        .engagement-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #E8F4FD, #F0F8FF);
            border-radius: 8px;
            border: 1px solid #B3D9F2;
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="container">
            <h1><i data-feather="video"></i> Zoom Speaker Management</h1>
            <p class="lead">Schedule speakers, automate marketing, and boost member engagement</p>
        </div>
    </div>

    <div class="container">
        <!-- Speaker Setup Form -->
        <div class="speaker-card">
            <h3>üé§ Schedule New Speaker</h3>
            <div class="speaker-form">
                <form id="speakerForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="speakerName" class="form-label">Speaker Name</label>
                                <input type="text" class="form-control" id="speakerName" required>
                            </div>
                            <div class="mb-3">
                                <label for="speakerTopic" class="form-label">Presentation Topic</label>
                                <input type="text" class="form-control" id="speakerTopic" required>
                            </div>
                            <div class="mb-3">
                                <label for="speakerDate" class="form-label">Event Date</label>
                                <input type="date" class="form-control" id="speakerDate" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="speakerTime" class="form-label">Event Time</label>
                                <select class="form-control" id="speakerTime">
                                    <option value="7:00 PM PST">7:00 PM PST</option>
                                    <option value="6:00 PM PST">6:00 PM PST</option>
                                    <option value="8:00 PM PST">8:00 PM PST</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="zoomLink" class="form-label">Zoom Meeting Link</label>
                                <input type="url" class="form-control" id="zoomLink" placeholder="https://zoom.us/j/...">
                            </div>
                            <div class="mb-3">
                                <label for="speakerBio" class="form-label">Speaker Bio</label>
                                <textarea class="form-control" id="speakerBio" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8">
                            <button type="submit" class="schedule-button w-100">
                                <i data-feather="calendar-plus"></i> Schedule Speaker & Trigger Marketing
                            </button>
                        </div>
                        <div class="col-md-4">
                            <div id="scheduleStatus" class="d-flex align-items-center h-100 text-muted">
                                Ready to schedule
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Marketing Preview -->
        <div class="speaker-card" id="marketingPreview" style="display: none;">
            <h3>üì¢ Marketing Campaign Preview</h3>
            <div class="marketing-preview" id="marketingContent">
                <!-- Marketing content will appear here -->
            </div>
            
            <div class="mt-3">
                <h5>Automated Marketing Actions:</h5>
                <ul id="marketingActions">
                    <!-- Marketing actions will be listed here -->
                </ul>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <button class="btn btn-outline-success w-100" onclick="viewSocietyOutreach()">
                            <i data-feather="users"></i> View Partner Society Outreach
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-outline-primary w-100" onclick="viewSocialMediaContent()">
                            <i data-feather="share-2"></i> View Social Media Content
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current/Upcoming Speakers -->
        <div class="speaker-card">
            <h3>üìÖ Scheduled Speakers</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Speaker</th>
                            <th>Topic</th>
                            <th>Date & Time</th>
                            <th>Registrations</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="speakersList">
                        <!-- Example row -->
                        <tr>
                            <td>Dr. Sarah Chen</td>
                            <td>Advanced Cattleya Breeding Techniques</td>
                            <td>Sep 19, 2025 - 7:00 PM PST</td>
                            <td>
                                <span class="badge bg-success">32 registered</span>
                            </td>
                            <td>
                                <span class="badge bg-primary">Scheduled</span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="sendReminders()">Send Reminders</button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="viewRegistrations()">View Registrations</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Engagement Statistics -->
        <div class="speaker-card">
            <h3>üìä Speaker Series Engagement</h3>
            <div class="engagement-stats">
                <div class="stat-box">
                    <h4 id="totalSpeakers">12</h4>
                    <p>Speakers This Year</p>
                </div>
                <div class="stat-box">
                    <h4 id="avgAttendance">45</h4>
                    <p>Avg Attendance</p>
                </div>
                <div class="stat-box">
                    <h4 id="memberEngagement">78%</h4>
                    <p>Member Participation</p>
                </div>
                <div class="stat-box">
                    <h4 id="satisfactionRate">95%</h4>
                    <p>Satisfaction Rate</p>
                </div>
            </div>
        </div>

        <!-- Integration Settings -->
        <div class="speaker-card">
            <h3>‚öôÔ∏è Automation Settings</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>Neon One Email Campaigns</h5>
                    <ul>
                        <li><strong>FCOS_SPEAKER_ANNOUNCEMENT</strong> - Initial speaker announcement</li>
                        <li><strong>FCOS_SPEAKER_REMINDER</strong> - Event reminders (3 days before)</li>
                        <li><strong>FCOS_SPEAKER_FOLLOWUP</strong> - Post-event follow-up</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Marketing Automation</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="autoAnnounce" checked>
                        <label class="form-check-label" for="autoAnnounce">
                            Auto-send announcement emails
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="autoReminders" checked>
                        <label class="form-check-label" for="autoReminders">
                            Auto-send reminders 3 days before
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="socialMedia" checked>
                        <label class="form-check-label" for="socialMedia">
                            Generate social media content
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="memberPriority" checked>
                        <label class="form-check-label" for="memberPriority">
                            Give FCOS members priority registration
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Speaker Ideas Bank -->
        <div class="speaker-card">
            <h3>üí° Speaker Ideas & Topics</h3>
            <div class="row">
                <div class="col-md-4">
                    <h5>Popular Topics</h5>
                    <ul class="list-unstyled">
                        <li>üå± Orchid Propagation Techniques</li>
                        <li>üè† Indoor Growing Systems</li>
                        <li>üå°Ô∏è Climate Control for Orchids</li>
                        <li>üêõ Pest & Disease Management</li>
                        <li>üå∏ Encouraging Blooms</li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Seasonal Topics</h5>
                    <ul class="list-unstyled">
                        <li>üçÇ Fall Orchid Care</li>
                        <li>‚ùÑÔ∏è Winter Protection Strategies</li>
                        <li>üå± Spring Repotting Guidelines</li>
                        <li>‚òÄÔ∏è Summer Watering & Humidity</li>
                        <li>üå∫ Year-Round Blooming</li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Advanced Topics</h5>
                    <ul class="list-unstyled">
                        <li>üß¨ Orchid Breeding & Genetics</li>
                        <li>üåç Conservation Efforts</li>
                        <li>üî¨ Scientific Research Updates</li>
                        <li>üì∏ Orchid Photography</li>
                        <li>üèÜ Show Preparation</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"></script>
    <script>
        feather.replace();

        document.getElementById('speakerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            scheduleSpeaker();
        });

        function scheduleSpeaker() {
            const formData = {
                name: document.getElementById('speakerName').value,
                topic: document.getElementById('speakerTopic').value,
                date: document.getElementById('speakerDate').value,
                time: document.getElementById('speakerTime').value,
                zoom_link: document.getElementById('zoomLink').value,
                bio: document.getElementById('speakerBio').value
            };

            const button = document.querySelector('.schedule-button');
            const status = document.getElementById('scheduleStatus');
            
            button.disabled = true;
            button.innerHTML = '<div class="spinner-border spinner-border-sm me-2" role="status"></div>Scheduling...';
            status.textContent = 'Setting up speaker and triggering marketing...';

            fetch('/api/schedule-zoom-speaker', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayMarketingPreview(data.speaker, data.marketing_results);
                    status.innerHTML = '<span class="text-success">‚úÖ Speaker scheduled and marketing triggered!</span>';
                    
                    // Add to speakers list
                    addSpeakerToList(data.speaker);
                    
                    // Reset form
                    document.getElementById('speakerForm').reset();
                } else {
                    status.innerHTML = '<span class="text-danger">‚ùå Scheduling failed: ' + data.error + '</span>';
                }
            })
            .catch(error => {
                status.innerHTML = '<span class="text-danger">‚ùå Error: ' + error.message + '</span>';
            })
            .finally(() => {
                button.disabled = false;
                button.innerHTML = '<i data-feather="calendar-plus"></i> Schedule Speaker & Trigger Marketing';
                feather.replace();
            });
        }

        function displayMarketingPreview(speaker, marketingResults) {
            document.getElementById('marketingPreview').style.display = 'block';
            
            const content = document.getElementById('marketingContent');
            content.innerHTML = `
                <h5>üì¢ ${speaker.name} - ${speaker.topic}</h5>
                <p><strong>Date:</strong> ${speaker.date} at ${speaker.time}</p>
                <p><strong>Marketing Message:</strong></p>
                <div class="border-start border-primary ps-3">
                    ${marketingResults.social_media_content || 'Marketing content generated for social media and email campaigns.'}
                </div>
            `;

            const actions = document.getElementById('marketingActions');
            actions.innerHTML = `
                <li>‚úÖ Speaker announcement email sent to all FCOS members</li>
                <li>‚úÖ Outreach emails sent to ${marketingResults.cross_promotion_emails || 5} partner orchid societies</li>
                <li>‚úÖ Social media content generated for Facebook, Instagram, and Google</li>
                <li>‚úÖ Registration page created at: ${speaker.registration_link}</li>
                <li>‚úÖ Google My Business event listing created</li>
                <li>‚úÖ Automated reminder scheduled for 3 days before event</li>
                <li>‚úÖ Member priority registration activated</li>
                <li>üìà Estimated additional reach: ${marketingResults.estimated_reach || '2,000+'} orchid enthusiasts</li>
            `;
        }

        function addSpeakerToList(speaker) {
            const tbody = document.getElementById('speakersList');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${speaker.name}</td>
                <td>${speaker.topic}</td>
                <td>${speaker.date} - ${speaker.time}</td>
                <td><span class="badge bg-info">Just scheduled</span></td>
                <td><span class="badge bg-success">Active</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="sendReminders()">Send Reminders</button>
                    <button class="btn btn-sm btn-outline-secondary" onclick="viewRegistrations()">View Registrations</button>
                </td>
            `;
            tbody.insertBefore(row, tbody.firstChild);
        }

        function sendReminders() {
            alert('Reminder emails sent to all registered participants!');
        }

        function viewRegistrations() {
            alert('Registration management feature coming soon!');
        }

        function viewSocietyOutreach() {
            fetch('/admin/society-outreach/current')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        let outreachSummary = `Partner Society Outreach Summary:\n\n`;
                        outreachSummary += `Total Societies: ${data.total_societies}\n`;
                        outreachSummary += `Estimated Reach: ${data.estimated_reach} members\n\n`;
                        
                        outreachSummary += `Societies Contacted:\n`;
                        data.outreach_campaigns.forEach(campaign => {
                            outreachSummary += `‚Ä¢ ${campaign.society_name} (${campaign.estimated_reach} members)\n`;
                        });
                        
                        outreachSummary += `\nOutreach emails are ready to send to partner societies for cross-promotion.`;
                        alert(outreachSummary);
                    } else {
                        alert('Failed to load society outreach data');
                    }
                })
                .catch(error => {
                    alert('Error loading outreach data: ' + error.message);
                });
        }

        function viewSocialMediaContent() {
            fetch('/admin/social-media-content/current')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        let contentSummary = `Social Media Content Generated:\n\n`;
                        
                        if (data.social_content.facebook) {
                            contentSummary += `üìò FACEBOOK EVENT:\n`;
                            contentSummary += `"${data.social_content.facebook.event_title}"\n\n`;
                        }
                        
                        if (data.social_content.instagram) {
                            contentSummary += `üì∏ INSTAGRAM POST:\n`;
                            contentSummary += `${data.social_content.instagram.post_caption.substring(0, 100)}...\n\n`;
                        }
                        
                        if (data.social_content.twitter) {
                            contentSummary += `üê¶ TWITTER POST:\n`;
                            contentSummary += `${data.social_content.twitter.substring(0, 100)}...\n\n`;
                        }
                        
                        contentSummary += `All content is ready to copy and post across your social media platforms!`;
                        alert(contentSummary);
                    } else {
                        alert('Failed to load social media content');
                    }
                })
                .catch(error => {
                    alert('Error loading social media content: ' + error.message);
                });
        }

        // Set default date to next month's third Thursday
        function setDefaultDate() {
            const today = new Date();
            const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
            
            // Find first Thursday
            while (nextMonth.getDay() !== 4) {
                nextMonth.setDate(nextMonth.getDate() + 1);
            }
            
            // Add 14 days to get third Thursday
            nextMonth.setDate(nextMonth.getDate() + 14);
            
            document.getElementById('speakerDate').value = nextMonth.toISOString().split('T')[0];
        }

        // Set default date on page load
        setDefaultDate();
    </script>
</body>
</html>