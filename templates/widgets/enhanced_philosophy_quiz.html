<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Ultimate Orchid Philosophy Quiz</title>
<style>
  :root{
    --ink:#1b2420; --paper:#f5f7f5; --accent:#2b6a30;
    --card-bg: #ffffff; --shadow: rgba(0,0,0,0.12);
  }
  
  html,body{
    margin:0;padding:0;background:var(--paper);color:var(--ink);
    font:18px/1.6 system-ui,-apple-system,'Segoe UI',Roboto,Arial;
  }
  
  .wrap{max-width:1200px;margin:32px auto;padding:0 20px}
  
  h1{font-size:36px;margin:12px 0 20px;color:var(--accent);font-weight:700}
  h2{font-size:28px;margin:24px 0 12px;color:var(--accent);font-weight:600}
  h3{font-size:22px;margin:18px 0 8px;color:var(--ink);font-weight:600}
  
  .card{
    background:var(--card-bg);border-radius:20px;padding:28px;
    box-shadow:0 18px 40px var(--shadow), 0 4px 12px rgba(0,0,0,0.08);
    margin-bottom:24px;
  }
  
  .hero{display:flex;flex-wrap:wrap;gap:20px;align-items:center}
  .hero img{max-width:400px;width:100%;height:auto;border-radius:16px;box-shadow:0 8px 20px var(--shadow)}
  .meta{min-width:300px;flex:1}
  
  .pill{
    display:inline-block;padding:8px 16px;border-radius:999px;
    background:#eef6ef;color:#1f4222;font-weight:700;font-size:16px;
    margin:4px 8px 4px 0;
  }
  
  .grid{display:grid;grid-template-columns:1fr;gap:16px}
  .two-col{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px}
  
  .haiku{
    font-family:"Brush Script MT","Segoe Script","Apple Chancery",cursive;
    font-size:24px;line-height:1.4;text-align:center;padding:16px 20px;
    background:#fafafa;border-radius:12px;border-left:4px solid var(--accent);
    font-style:italic;
  }
  
  .small{color:#6b6b6b;font-size:16px}
  .btn{
    cursor:pointer;border:none;background:var(--accent);color:#fff;
    padding:14px 20px;border-radius:10px;font-weight:700;font-size:16px;
    transition:all 0.2s ease;margin:8px 8px 8px 0;
  }
  .btn:hover{background:#1e5025;transform:translateY(-1px)}
  .btn-secondary{background:#6b7280;color:#fff}
  .btn-secondary:hover{background:#4b5563}
  
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .hide{display:none}
  .show{display:block}
  
  .quiz-intro{
    background:linear-gradient(135deg, #f8fdf8 0%, #e8f5e9 50%, #d4f0d6 100%);
    border-radius:24px;margin-bottom:40px;overflow:hidden;
    box-shadow:0 20px 60px rgba(43, 106, 48, 0.15);
  }
  
  .intro-hero{
    display:grid;grid-template-columns:300px 1fr;gap:30px;
    align-items:center;padding:30px 40px;min-height:280px;
  }
  
  .hero-orchid-image{
    width:100%;height:250px;object-fit:cover;
    border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,0.15);
  }
  
  .intro-content h1{
    font-size:36px;margin-bottom:16px;color:var(--accent);
    font-weight:700;letter-spacing:-0.5px;line-height:1.2;
  }
  
  .philosophy-lead{
    font-size:16px;line-height:1.5;color:#2c5530;
    margin-bottom:12px;font-weight:400;
  }
  
  .orchid-connection{
    font-size:18px;color:var(--accent);font-weight:600;
    margin:12px 0;font-style:italic;
  }
  
  .philosophy-examples{
    background:rgba(255,255,255,0.7);padding:16px;
    border-radius:12px;margin:16px 0;
    border-left:4px solid var(--accent);
  }
  
  .philosophy-examples p{
    font-size:14px;line-height:1.5;color:#1f4222;
    margin:0;font-weight:500;
  }
  
  .quiz-promise{
    font-size:16px;line-height:1.5;color:#2c5530;
    margin:16px 0;font-weight:500;
  }
  
  .call-to-action{
    font-size:18px;color:var(--accent);font-weight:700;
    margin:20px 0 16px;text-align:center;
    padding:16px;background:rgba(255,255,255,0.8);
    border-radius:10px;border:2px solid #c8e6c9;
  }
  
  .quiz-details{
    font-size:14px;color:#6b6b6b;text-align:center;
    margin-top:12px;font-style:italic;
  }
  
  .widget-start-button{
    background:linear-gradient(135deg, var(--accent) 0%, #4caf50 100%);
    color:white;border:none;padding:16px 32px;border-radius:12px;
    font-size:18px;font-weight:600;cursor:pointer;
    box-shadow:0 4px 15px rgba(43, 106, 48, 0.3);
    transition:all 0.3s ease;margin:16px auto;display:block;
  }
  
  .widget-start-button:hover{
    transform:translateY(-2px);box-shadow:0 8px 25px rgba(43, 106, 48, 0.4);
  }
  
  .quiz-header{
    display:flex;justify-content:space-between;align-items:center;
    padding:20px 40px;background:rgba(255,255,255,0.9);
    border-bottom:1px solid #e0e0e0;
  }
  
  .quiz-title-small{
    font-size:24px;color:var(--accent);font-weight:600;margin:0;
  }
  
  .home-button{
    background:linear-gradient(135deg, var(--accent) 0%, #4caf50 100%);
    color:white;border:none;padding:10px 20px;border-radius:8px;
    font-size:14px;font-weight:600;text-decoration:none;
    cursor:pointer;transition:all 0.3s ease;
    box-shadow:0 2px 8px rgba(43, 106, 48, 0.2);
  }
  
  .home-button:hover{
    transform:translateY(-1px);box-shadow:0 4px 12px rgba(43, 106, 48, 0.3);
    color:white;text-decoration:none;
  }
  
  @media (max-width: 900px) {
    .quiz-header{padding:15px 20px}
    .quiz-title-small{font-size:20px}
    .home-button{padding:8px 16px;font-size:12px}
    .intro-hero{
      grid-template-columns:1fr;text-align:center;gap:20px;
      padding:25px 20px;
    }
    .hero-orchid-image{height:200px;max-width:300px;margin:0 auto}
    .intro-content h1{font-size:28px}
    .philosophy-lead{font-size:15px}
    .call-to-action{font-size:16px}
    .widget-start-button{font-size:16px;padding:12px 24px}
  }
  
  .question-card{
    background:#fff;border-radius:16px;padding:24px;margin-bottom:20px;
    border-left:6px solid var(--accent);
    box-shadow:0 6px 20px rgba(0,0,0,0.08);
  }
  
  .question-number{
    display:inline-block;background:var(--accent);color:#fff;
    width:40px;height:40px;border-radius:50%;text-align:center;
    line-height:40px;font-weight:700;margin-right:16px;font-size:18px;
  }
  
  .question-text{font-size:20px;font-weight:600;margin-bottom:16px;line-height:1.4}
  
  .option{
    display:block;width:100%;padding:16px 20px;margin-bottom:12px;
    background:#f8f9fa;border:2px solid #e9ecef;border-radius:12px;
    text-align:left;cursor:pointer;transition:all 0.3s ease;
    font-size:18px;line-height:1.4;color:#495057;
  }
  
  .option:hover{border-color:var(--accent);background:#f0f8f1;color:var(--accent)}
  .option input[type="radio"]{margin-right:12px;transform:scale(1.3)}
  .option:has(input:checked){background:var(--accent);color:#fff;border-color:var(--accent)}
  
  .progress-section{
    background:#f1f3f4;padding:24px;text-align:center;
    border-top:1px solid #e9ecef;border-radius:0 0 20px 20px;
  }
  
  .progress{height:12px;border-radius:10px;background:#e9ecef;margin-bottom:16px}
  .progress-bar{
    background:linear-gradient(90deg, var(--accent), #22c55e);
    border-radius:10px;transition:width 0.3s ease;height:100%;
  }
  
  .submit-btn{
    background:linear-gradient(45deg, var(--accent), #22c55e);
    border:none;color:#fff;padding:16px 32px;font-size:18px;
    font-weight:700;border-radius:50px;cursor:pointer;
    transition:all 0.3s ease;margin-top:16px;
  }
  
  .submit-btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(43, 106, 48, 0.3)}
  .submit-btn:disabled{opacity:0.6;cursor:not-allowed;transform:none}
  
  .result-actions{
    margin-top:24px;text-align:center;padding:20px;
    background:#f8f9fa;border-radius:16px;
  }
  
  .copy-btn, .download-btn{
    background:#6366f1;color:#fff;padding:12px 24px;
    border:none;border-radius:10px;font-weight:600;
    margin:8px;cursor:pointer;transition:all 0.2s ease;
  }
  
  .copy-btn:hover{background:#4f46e5}
  .download-btn{background:#059669}
  .download-btn:hover{background:#047857}
  
  @media (max-width: 768px) {
    .quiz-intro h1{font-size:36px}
    .quiz-intro p{font-size:18px}
    .question-text{font-size:18px}
    .option{font-size:16px;padding:14px 16px}
    .haiku{font-size:20px}
    .hero{flex-direction:column;text-align:center}
    .two-col{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="quiz-header">
    <h2 class="quiz-title-small">üå∫ The Ultimate Orchid Philosophy Quiz</h2>
    <a href="/" class="home-button">üè† Home</a>
  </div>
  
  <div class="quiz-intro">
    <div class="intro-hero">
      <img src="/static/images/gary_collection/DSC_2161.JPG" alt="Beautiful Cattleya orchid in bloom" class="hero-orchid-image" onerror="this.src='/static/images/orchid_placeholder.svg'">
      <div class="intro-content">
        <h1>What's Your Orchid Philosophy?</h1>
        <p class="philosophy-lead">For thousands of years, humans have turned to philosophy for meaning: Stoics prized patience, Epicureans chased joy, Confucians valued balance, and Idealists dreamed of perfection.</p>
        
        <p class="orchid-connection">Now, the orchids you grow may hold the same answers. üå∫</p>
        
        <div class="philosophy-examples">
          <p>Are you a <strong>Stoic Grower</strong>, calmly tending with patience and faith?<br>
          A <strong>Vision Seeker</strong>, pursuing the perfect bloom?<br>
          An <strong>Epicurean</strong>, delighting in fragrance, color, and joy?<br>
          Or perhaps a <strong>Wild Spirit</strong>, thriving beyond rules?</p>
        </div>
        
        <p class="quiz-promise">In just minutes, this quiz will reveal your personal Orchid Philosophy ‚Äî with a custom badge, a poetic haiku, and science-backed grower insights designed for your style.</p>
        
        <p class="call-to-action">‚ú® Take the quiz today, and let your orchids show you who you really are.</p>
        
        <button class="widget-start-button" onclick="startQuiz()">üå∫ Start Your Philosophy Discovery</button>
        
        <p class="quiz-details">Complete all 29 questions to discover your unique growing philosophy and receive your personalized badge.</p>
      </div>
    </div>
  </div>

  <!-- Questions Form (will be populated by JavaScript) -->
  <form id="philosophyQuizForm" class="card">
    <div id="questionsContainer">
      <!-- Questions will be inserted here -->
    </div>
    
    <div class="progress-section">
      <div class="progress">
        <div class="progress-bar" id="quiz-progress" style="width: 0%"></div>
      </div>
      <p class="small">Progress: <span id="progress-text">0 of 29 questions answered</span></p>
      
      <button type="submit" class="submit-btn" id="submit-btn" disabled>
        üå∫ Discover Your Philosophy
      </button>
    </div>
  </form>

  <!-- Results Display -->
  <div id="result" class="hide"></div>

  <!-- Score Debug -->
  <div class="card hide" id="leaderboard">
    <h2>Philosophy Scores</h2>
    <pre id="scoreDump" class="small"></pre>
  </div>
</div>

<script>
/* -----------------------------------------------------------
   QUIZ QUESTIONS (29 questions)
   ----------------------------------------------------------- */
const QUIZ_QUESTIONS = [
  {
    id: 1,
    question: "You walk into a greenhouse. What draws your eye first?",
    options: {
      'A': "The wild, unkempt corner where orchids grow free",
      'B': "The perfectly arranged display with artistic lighting",
      'C': "The empty spaces where beauty once bloomed",
      'D': "The classic setup, time-tested and reliable"
    }
  },
  {
    id: 2,
    question: "When your orchid finally blooms, you...",
    options: {
      'A': "Feel proud‚Äîthis success belongs to you",
      'B': "Share photos with everyone you know",
      'C': "Follow the community guidelines for proper care",
      'D': "Appreciate the fleeting moment without attachment"
    }
  },
  {
    id: 3,
    question: "What's your approach to choosing new orchids?",
    options: {
      'A': "Hunt for the rarest, most perfect specimen",
      'B': "Pick what works reliably in your conditions",
      'C': "Research thoroughly, organize by classification",
      'D': "Choose what brings you immediate joy and fragrance"
    }
  },
  {
    id: 4,
    question: "Your orchid gets a bacterial infection. You...",
    options: {
      'A': "Research the best treatment for your collection",
      'B': "Ask the community for help and advice",
      'C': "Follow established wisdom from experienced growers",
      'D': "Accept that some flowers are meant to fade"
    }
  },
  {
    id: 5,
    question: "How do you feel about following orchid care rules?",
    options: {
      'A': "Old wisdom exists for good reasons",
      'B': "Rules are meant to be creatively bent",
      'C': "Test everything‚Äîeven expert advice",
      'D': "Focus on what serves your goals"
    }
  },
  {
    id: 6,
    question: "What motivates your orchid growing?",
    options: {
      'A': "Creating harmony between tradition and innovation",
      'B': "Solving problems and learning what works",
      'C': "Finding peace through patient cultivation",
      'D': "Questioning assumptions and discovering truth"
    }
  },
  {
    id: 7,
    question: "Your ideal orchid space would be...",
    options: {
      'A': "An artistic gallery showcasing form and beauty",
      'B': "A sensory paradise of color and fragrance",
      'C': "A quiet space accepting both bloom and decay",
      'D': "A natural sanctuary connecting you to something greater"
    }
  },
  {
    id: 8,
    question: "When someone asks for orchid advice, you...",
    options: {
      'A': "Question their assumptions and dig deeper",
      'B': "Offer enthusiastic help and encouragement",
      'C': "Share what has worked best for you",
      'D': "Suggest they find their own patient path"
    }
  },
  {
    id: 9,
    question: "What's your relationship with orchid failures?",
    options: {
      'A': "Test different approaches until you succeed",
      'B': "Honor the lineage of growers who came before",
      'C': "See them as part of a larger spiritual journey",
      'D': "Accept them with calm understanding"
    }
  },
  {
    id: 10,
    question: "Why do orchids matter to you?",
    options: {
      'A': "They reflect your personal achievement and taste",
      'B': "They connect you to a community of fellow enthusiasts",
      'C': "They challenge you to think and question",
      'D': "They teach balance, respect, and proper order"
    }
  },
  // Questions 11-29 (extending the original quiz)
  {
    id: 11,
    question: "When you see a rare orchid you can't afford, you...",
    options: {
      'A': "Accept that some beauty is beyond reach",
      'B': "Find creative ways to experience it anyway",
      'C': "Research everything about it to understand its perfection",
      'D': "Ask experienced growers for their wisdom"
    }
  },
  {
    id: 12,
    question: "Your ideal orchid mentor would be...",
    options: {
      'A': "Someone who questions every conventional method",
      'B': "A generous soul who shares freely with others",
      'C': "A master who embodies traditional wisdom",
      'D': "Someone focused on achieving personal excellence"
    }
  },
  {
    id: 13,
    question: "If you discovered a new orchid species, you would...",
    options: {
      'A': "Document it precisely and scientifically",
      'B': "Share the discovery with the whole community",
      'C': "Contemplate its place in the greater mystery of nature",
      'D': "Focus on how to successfully cultivate it"
    }
  },
  {
    id: 14,
    question: "When orchid trends change, you...",
    options: {
      'A': "Stick with what has worked for generations",
      'B': "Ignore trends and grow what brings you joy",
      'C': "Question whether the trend has real merit",
      'D': "Adapt if the new approach serves your goals"
    }
  },
  {
    id: 15,
    question: "Your greenhouse organization reflects...",
    options: {
      'A': "Systematic classification and clear labeling",
      'B': "Harmonious balance between all elements",
      'C': "A living artwork of form and beauty",
      'D': "Practical efficiency and what works best"
    }
  },
  {
    id: 16,
    question: "When facing a difficult orchid rescue, you...",
    options: {
      'A': "Channel all your energy into saving it",
      'B': "Accept whatever outcome comes with peace",
      'C': "Try every method until something works",
      'D': "Research the traditional rescue techniques"
    }
  },
  {
    id: 17,
    question: "The most rewarding part of orchid growing is...",
    options: {
      'A': "The sensory pleasure of blooms and fragrance",
      'B': "The inner peace it brings to your life",
      'C': "The knowledge you gain about nature",
      'D': "The joy of sharing with others"
    }
  },
  {
    id: 18,
    question: "When you see 'perfect' orchids at shows, you feel...",
    options: {
      'A': "Inspired to achieve that same perfection",
      'B': "Grateful for the fleeting beauty",
      'C': "Curious about the growing techniques used",
      'D': "Appreciation for the artistic presentation"
    }
  },
  {
    id: 19,
    question: "Your approach to orchid photography is...",
    options: {
      'A': "Document every bloom as a precious moment",
      'B': "Capture the artistic beauty and composition",
      'C': "Record scientific details and characteristics",
      'D': "Share the joy with others through images"
    }
  },
  {
    id: 20,
    question: "When an orchid blooms out of season, you...",
    options: {
      'A': "Marvel at nature's mysterious ways",
      'B': "Research what environmental factors caused it",
      'C': "Enjoy the unexpected gift without overthinking",
      'D': "Make notes to replicate the conditions"
    }
  },
  {
    id: 21,
    question: "Your biggest orchid growing fear is...",
    options: {
      'A': "Never achieving the perfection you seek",
      'B': "Losing the peace orchids bring to your life",
      'C': "Running out of space for your growing collection",
      'D': "Making mistakes that harm your plants"
    }
  },
  {
    id: 22,
    question: "When teaching someone about orchids, you emphasize...",
    options: {
      'A': "Questioning assumptions and testing everything",
      'B': "Sharing knowledge generously and building community",
      'C': "Respecting traditional methods and mentors",
      'D': "Finding what works for their unique situation"
    }
  },
  {
    id: 23,
    question: "The orchid that means most to you is...",
    options: {
      'A': "The rarest one you've managed to acquire",
      'B': "One given to you by a dear friend",
      'C': "The first one that ever bloomed for you",
      'D': "One you rescued and brought back to health"
    }
  },
  {
    id: 24,
    question: "When you see orchids in nature, you feel...",
    options: {
      'A': "Deep spiritual connection to something greater",
      'B': "Curiosity about their natural growing conditions",
      'C': "Awe at their perfect adaptation and form",
      'D': "Peaceful acceptance of nature's rhythm"
    }
  },
  {
    id: 25,
    question: "Your orchid budget reflects...",
    options: {
      'A': "Investment in your personal collection goals",
      'B': "Practical spending on what you need most",
      'C': "Resources for sharing and helping others",
      'D': "Careful research before every purchase"
    }
  },
  {
    id: 26,
    question: "When orchid experts disagree on care methods, you...",
    options: {
      'A': "Test different approaches to find what works",
      'B': "Follow the wisdom of established authorities",
      'C': "Question the underlying assumptions of both",
      'D': "Seek harmony between the different viewpoints"
    }
  },
  {
    id: 27,
    question: "The greatest orchid lesson you've learned is...",
    options: {
      'A': "Patience‚Äîeverything happens in its own time",
      'B': "Beauty is fleeting and should be treasured",
      'C': "Knowledge grows through careful observation",
      'D': "Joy multiplies when shared with others"
    }
  },
  {
    id: 28,
    question: "Your dream orchid experience would be...",
    options: {
      'A': "Finding the perfect specimen you've always sought",
      'B': "Sharing a magical bloom moment with loved ones",
      'C': "Discovering something entirely new about orchids",
      'D': "Achieving perfect harmony in your growing space"
    }
  },
  {
    id: 29,
    question: "If you could give one piece of advice to new orchid growers, it would be...",
    options: {
      'A': "Start with easy varieties and learn as you go",
      'B': "Find your local orchid society and get involved",
      'C': "Study the science but trust your observations",
      'D': "Remember that every expert was once a beginner"
    }
  }
];

/* -----------------------------------------------------------
   16 PHILOSOPHIES DATA
   ----------------------------------------------------------- */
const PHILOS = {
  "Enduring Bloom": { // Stoicism
    key:"Stoicism",
    caption:"Patient and calm; every bloom is a gift of its own time.",
    life:"Resilience is your north star. You treasure returns and reliable grace.",
    reflect:"You love plants that reward steady care with faithful bloom.",
    haiku:`Storms will come and pass,
Roots remember how to hold,
Bloom returns in time.`,
    practical:"You keep long-lived workhorses (Oncidium, Phalaenopsis) thriving year to year.",
    science:"Stress‚Äìrecovery cycles can enhance flowering; resilience pays.",
    badge:"https://imgur.com/a/O9jy9rP",
    palette:["Slate Gray","Soft Green"]
  },
  "Fragrance Seeker": { // Epicureanism
    key:"Epicureanism",
    caption:"You savor orchids for color, fragrance, and simple pleasures.",
    life:"You savor life through the senses. Blooms are not just seen‚Äîthey are experienced.",
    reflect:"A garden of delight; fragrance and color are reasons enough.",
    haiku:`Sweet scent fills the air,
Petals glowing, fleeting joy,
Moments made to keep.`,
    practical:"You seek Rhynchostylis, Brassavola, and perfumed Oncidiums.",
    science:"Fragrance evolved for pollinator attraction‚Äîyour delight echoes ecology.",
    badge:"https://imgur.com/a/gwzILYd",
    palette:["Rose Pink","Warm Gold"]
  },
  "Harmony": { // Confucianism
    key:"Confucianism",
    caption:"You grow with balance, tradition, and learned wisdom.",
    life:"You value respect, balance, and right relationships. Care is gratitude.",
    reflect:"Your bench reflects order‚Äîa place for each plant's needs.",
    haiku:`Guided by the past,
Hands respect the root and leaf,
Harmony endures.`,
    practical:"You gift responsibly and encourage stewardship.",
    science:"Balanced light/humidity/airflow are keystones of orchid health.",
    badge:"https://imgur.com/a/Q43hN1U",
    palette:["Jade Green","Gold"]
  },
  "Moonlight Reverie": { // Transcendentalism
    key:"Transcendentalism",
    caption:"Orchids are a spiritual journey and a guide to wonder.",
    life:"Nature is sacred to you; meaning in quiet hours with living things.",
    reflect:"Night-fragrant blooms feel like messages from the world itself.",
    haiku:`Moonlight on soft blooms,
Whispers rise from silent leaves,
Spirit breathes in green.`,
    practical:"You place night-fragrant orchids where you rest or reflect.",
    science:"Brassavola nodosa emits scent at night‚Äîtimed to moth pollinators.",
    badge:"https://imgur.com/a/HxR4aNu",
    palette:["Indigo","Moonlight White"]
  },
  "Veil Orchid": { // Skepticism
    key:"Skepticism",
    caption:"You question, test, and verify before you trust.",
    life:"You seek truth through doubt. Inquiry protects you from easy answers.",
    reflect:"Labels, culture sheets, photos‚Äîyou verify before trusting.",
    haiku:`Each leaf asks a why,
Roots spiral into the truth,
Answers bloom with doubt.`,
    practical:"You research identity and keep notes until evidence repeats.",
    science:"Orchid taxonomy is dynamic; names change with new data.",
    badge:"https://imgur.com/a/MNIglMs",
    palette:["Cool Blue","Silver"]
  },
  "Vanishing Bloom": { // Nihilism
    key:"Nihilism",
    caption:"Every bloom is precious because it vanishes.",
    life:"You accept impermanence. Fallen petals are facts, not failures.",
    reflect:"You honor moments as they are and don't cling.",
    haiku:`Petals drift away,
Silent truth beneath the stem,
Nothing holds for long.`,
    practical:"Enjoy blooms fully; accept their passing without despair.",
    science:"Many Stanhopea/Sobralia bloom for a day‚Äîintensity over duration.",
    badge:"https://imgur.com/a/wSgrdLl",
    palette:["Charcoal","Silver"]
  },
  "Self Bloom": { // Egoism
    key:"Egoism",
    caption:"Your collection reflects your own brilliance.",
    life:"Joy begins with self-respect; you choose what truly delights you.",
    reflect:"Rare, bold, personal‚Äîyour orchids mirror your taste and triumphs.",
    haiku:`Mirror of the self,
Blooming for no eyes but mine,
Joy in solitude.`,
    practical:"Bring home the plant that thrills you‚Äîeven if it's not trendy.",
    science:"Autogamy (self-pollination) in some orchids‚Äîself-sufficiency works.",
    badge:"https://imgur.com/a/92asMXl",
    palette:["Deep Red","Gold"]
  },
  "Wild Sprout": { // Cynicism
    key:"Cynicism",
    caption:"Breaking convention; thriving outside the lines.",
    life:"You prize authenticity over convention. You grow with instinct.",
    reflect:"Mounts, bottles, teacups‚Äîalive beyond rules.",
    haiku:`Roots spill from the pot,
Unruly, untamed, alive,
Truth grows without rules.`,
    practical:"Mount epiphytes on wood; try outdoor microclimates; ignore purism.",
    science:"Wild orchids colonize cliffs, trees, roadsides‚Äîfitness over formality.",
    badge:"https://imgur.com/a/JvdgeyY",
    palette:["Gray","Magenta Flash"]
  },
  "Orchid Muse": { // Renaissance Humanism
    key:"Renaissance Humanism",
    caption:"Orchids as art and living masterpieces.",
    life:"You celebrate art, beauty, and human dignity.",
    reflect:"Symmetry, form, color‚Äîevery flower a masterpiece.",
    haiku:`Velvet petals curve,
Crafted by a careful hand,
Living heritage.`,
    practical:"Value awarded clones and divisions with provenance.",
    science:"AOS judging codifies standards‚Äîtradition shaping beauty.",
    badge:"https://imgur.com/a/AlFdGYN",
    palette:["Burgundy","Renaissance Gold"]
  },
  "Ordered Bloom": { // Aristotelianism
    key:"Aristotelianism",
    caption:"Knowledge through order and precise names.",
    life:"You love clarity and classification.",
    reflect:"Patterns in petals and growth tell how the plant thinks.",
    haiku:`Each leaf has its place,
Patterns hide in nature's code,
Truth in order blooms.`,
    practical:"Organize by genus; track bloom cycles.",
    science:"~30,000 species‚Äîorder helps minds grasp diversity.",
    badge:"https://imgur.com/a/ukuPLxh",
    palette:["Navy","Ivory"]
  },
  "Legacy Bloom": { // Traditionalism
    key:"Traditionalism",
    caption:"You trust the time-tested ways.",
    life:"You honor inherited wisdom and practices.",
    reflect:"Orchids as living heirlooms‚Äîcarried grower to grower.",
    haiku:`Guided by the past,
Hands respect the root and leaf,
Harmony endures.`,
    practical:"Prize awarded lines and classic methods.",
    science:"Proven practices persist because they work.",
    badge:"https://imgur.com/a/Q43hN1U",
    palette:["Parchment Beige","Muted Green"]
  },
  "Grounded Root": { // Pragmatism
    key:"Pragmatism",
    caption:"If it thrives, it stays. Function over form.",
    life:"You value what works; test, observe, keep what helps.",
    reflect:"Experiments that bloom into methods.",
    haiku:`Moss, bark, glass, or clay,
Roots decide what thrives in time,
Bloom proves what is true.`,
    practical:"Try semi-hydro, adjust light/media; standardize what blooms.",
    science:"Hybrids often tolerate varied conditions; adaptability wins.",
    badge:"https://imgur.com/a/56VvvGz",
    palette:["Earth Brown","Moss Green"]
  },
  "Gifted Orchid": { // Altruism
    key:"Altruism",
    caption:"You share divisions generously; joy multiplies.",
    life:"Your instinct is to share; beauty multiplies when given.",
    reflect:"Divisions and keikis become bridges‚Äîfriendship rooted in generosity.",
    haiku:`Hands give living gifts,
Roots entwine across the earth,
Joy grows when it's shared.`,
    practical:"Divide thriving plants for new members; donate to auctions.",
    science:"Keikis are natural clones‚Äîbiology made for sharing.",
    badge:"https://imgur.com/a/Hcjw1Gv",
    palette:["Lavender","Warm Gold"]
  },
  "Vision Vine": { // Idealism
    key:"Idealism",
    caption:"Chasing flawless symmetry and rare cultivars.",
    life:"You chase ideals‚Äîpurity of form, rare color, perfect symmetry.",
    reflect:"Each plant is a step toward the vision you hold.",
    haiku:`Unreachable star,
Petals whisper higher truths,
Dreams take root in green.`,
    practical:"You prize Paph. rothschildianum and line-bred Cattleyas.",
    science:"Hybridizing pursues ideal traits; symmetry is a judging core.",
    badge:"https://imgur.com/a/9acVnRl",
    palette:["Ivory","Royal Purple"]
  },
  "Being in Bloom": { // Present focus
    key:"Being in Bloom",
    caption:"Always hunting the rare, perfect bloom (celebrating the now).",
    life:"You live in the present; every blossom is celebration.",
    reflect:"Orchids remind you to notice what's already here.",
    haiku:`Sun on open bloom,
Morning breathes a golden note,
Now is everything.`,
    practical:"Keep showy hybrids where you see them daily.",
    science:"Light-driven rhythms make presence visible.",
    badge:"https://imgur.com/a/FH4smYG",
    palette:["Gold","Cream"]
  },
  "Wild Bloom": { // Untamed nature
    key:"Wild Bloom",
    caption:"Celebrate what won't be tamed.",
    life:"You celebrate the edge beyond control.",
    reflect:"Sprawl, root, surprise‚Äîalive and authentic.",
    haiku:`Edge of ordered beds,
Green defies the gardener,
Life writes its own map.`,
    practical:"Let epiphytes wander over mounts and stone.",
    science:"Colonization of rough habitats is common‚Äîfitness beats neatness.",
    badge:"https://imgur.com/a/PzuiRKG",
    palette:["Forest","Stone"]
  }
};

/* -----------------------------------------------------------
   EXTENDED SCORING KEY (Q1-Q29)
   ----------------------------------------------------------- */
const KEY = {
  1:  {A:"Cynicism",            B:"Renaissance Humanism", C:"Nihilism",        D:"Traditionalism"},
  2:  {A:"Egoism",              B:"Altruism",            C:"Confucianism",    D:"Nihilism"},
  3:  {A:"Idealism",            B:"Pragmatism",          C:"Aristotelianism", D:"Epicureanism"},
  4:  {A:"Egoism",              B:"Altruism",            C:"Confucianism",    D:"Nihilism"},
  5:  {A:"Traditionalism",      B:"Cynicism",            C:"Skepticism",      D:"Egoism"},
  6:  {A:"Confucianism",        B:"Pragmatism",          C:"Stoicism",        D:"Skepticism"},
  7:  {A:"Renaissance Humanism",B:"Epicureanism",        C:"Nihilism",        D:"Transcendentalism"},
  8:  {A:"Skepticism",          B:"Altruism",            C:"Egoism",          D:"Stoicism"},
  9:  {A:"Pragmatism",          B:"Traditionalism",      C:"Transcendentalism",D:"Stoicism"},
  10: {A:"Egoism",              B:"Altruism",            C:"Skepticism",      D:"Confucianism"},
  // Extended questions 11-29
  11: {A:"Nihilism",            B:"Cynicism",            C:"Idealism",        D:"Traditionalism"},
  12: {A:"Skepticism",          B:"Altruism",            C:"Traditionalism",  D:"Egoism"},
  13: {A:"Aristotelianism",     B:"Altruism",            C:"Transcendentalism",D:"Pragmatism"},
  14: {A:"Traditionalism",      B:"Epicureanism",        C:"Skepticism",      D:"Pragmatism"},
  15: {A:"Aristotelianism",     B:"Confucianism",        C:"Renaissance Humanism",D:"Pragmatism"},
  16: {A:"Egoism",              B:"Stoicism",            C:"Pragmatism",      D:"Traditionalism"},
  17: {A:"Epicureanism",        B:"Stoicism",            C:"Aristotelianism", D:"Altruism"},
  18: {A:"Idealism",            B:"Nihilism",            C:"Skepticism",      D:"Renaissance Humanism"},
  19: {A:"Nihilism",            B:"Renaissance Humanism", C:"Aristotelianism", D:"Altruism"},
  20: {A:"Transcendentalism",   B:"Skepticism",          C:"Epicureanism",    D:"Pragmatism"},
  21: {A:"Idealism",            B:"Stoicism",            C:"Egoism",          D:"Confucianism"},
  22: {A:"Skepticism",          B:"Altruism",            C:"Traditionalism",  D:"Pragmatism"},
  23: {A:"Egoism",              B:"Altruism",            C:"Stoicism",        D:"Pragmatism"},
  24: {A:"Transcendentalism",   B:"Aristotelianism",     C:"Idealism",        D:"Stoicism"},
  25: {A:"Egoism",              B:"Pragmatism",          C:"Altruism",        D:"Skepticism"},
  26: {A:"Pragmatism",          B:"Traditionalism",      C:"Skepticism",      D:"Confucianism"},
  27: {A:"Stoicism",            B:"Nihilism",            C:"Aristotelianism", D:"Altruism"},
  28: {A:"Idealism",            B:"Altruism",            C:"Skepticism",      D:"Confucianism"},
  29: {A:"Pragmatism",          B:"Altruism",            C:"Skepticism",      D:"Traditionalism"}
};

// Tie breaker order
const TIE_ORDER = [
  "Epicureanism","Stoicism","Confucianism","Egoism","Nihilism",
  "Renaissance Humanism","Pragmatism","Transcendentalism","Skepticism",
  "Traditionalism","Cynicism","Idealism","Aristotelianism","Altruism"
];

/* -----------------------------------------------------------
   QUIZ DATA LOADING FROM GOOGLE SHEETS
   ----------------------------------------------------------- */

// Load quiz data from Google Sheets API
async function loadQuizData() {
  try {
    const response = await fetch('/api/enhanced-philosophy-quiz-data');
    const result = await response.json();
    
    if (result.success && result.data) {
      // Update global data with Google Sheets data
      if (result.data.questions && result.data.questions.length > 0) {
        updateQuestionsFromSheet(result.data.questions);
      }
      
      if (result.data.philosophies && result.data.philosophies.length > 0) {
        updatePhilosophiesFromSheet(result.data.philosophies);
      }
      
      if (result.data.scoring_key) {
        updateScoringKeyFromSheet(result.data.scoring_key);
      }
      
      console.log('üìä Quiz data loaded from Google Sheets successfully');
    } else {
      console.warn('‚ö†Ô∏è Using fallback quiz data');
    }
  } catch (error) {
    console.error('‚ùå Failed to load Google Sheets data:', error);
    throw error;
  }
}

// Update questions from Google Sheets
function updateQuestionsFromSheet(sheetsQuestions) {
  QUIZ_QUESTIONS.length = 0; // Clear existing questions
  
  sheetsQuestions.forEach((row, index) => {
    const questionId = row.id || (index + 1);
    QUIZ_QUESTIONS.push({
      id: parseInt(questionId),
      question: row.question || row.Question || '',
      options: {
        'A': row.option_a || row['Option A'] || '',
        'B': row.option_b || row['Option B'] || '',
        'C': row.option_c || row['Option C'] || '',
        'D': row.option_d || row['Option D'] || ''
      }
    });
  });
}

// Update philosophies from Google Sheets
function updatePhilosophiesFromSheet(sheetsPhilosophies) {
  Object.keys(PHILOS).forEach(key => delete PHILOS[key]); // Clear existing
  
  sheetsPhilosophies.forEach(row => {
    const title = row.title || row.Title || '';
    const key = row.key || row.Key || title;
    
    if (title && key) {
      PHILOS[title] = {
        key: key,
        caption: row.caption || row.Caption || '',
        life: row.life_philosophy || row['Life Philosophy'] || '',
        reflect: row.orchid_reflection || row['Orchid Reflection'] || '',
        haiku: row.haiku || row.Haiku || '',
        practical: row.practical || row.Practical || '',
        science: row.science || row.Science || '',
        badge: row.badge || row.Badge || 'https://imgur.com/a/default',
        palette: [row.color1 || row.Color1 || '#ddd', row.color2 || row.Color2 || '#eee']
      };
    }
  });
}

// Update scoring key from Google Sheets
function updateScoringKeyFromSheet(sheetsScoringKey) {
  Object.keys(KEY).forEach(key => delete KEY[key]); // Clear existing
  
  Object.keys(sheetsScoringKey).forEach(questionNum => {
    KEY[questionNum] = sheetsScoringKey[questionNum];
  });
}

/* -----------------------------------------------------------
   QUIZ FUNCTIONALITY
   ----------------------------------------------------------- */

// Generate question HTML
function generateQuestions() {
  const container = document.getElementById('questionsContainer');
  container.innerHTML = ''; // Clear any existing content
  let html = '';
  
  console.log('Generating questions...', QUIZ_QUESTIONS.length, 'questions available');
  
  QUIZ_QUESTIONS.forEach(q => {
    html += `
      <div class="question-card" data-question="${q.id}">
        <div class="question-text">
          <span class="question-number">${q.id}</span>
          ${q.question}
        </div>
        <div class="options">
          ${Object.entries(q.options).map(([key, text]) => `
            <label class="option">
              <input type="radio" name="question_${q.id}" value="${key}" required>
              <strong>${key}.</strong> ${text}
            </label>
          `).join('')}
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
  console.log('Questions generated. Container has', container.children.length, 'question cards');
}

// Score answers
function scoreAnswers(answers) {
  const tally = {};
  for(let q=1; q<=29; q++) {
    const pick = (answers[q]||'').toString().trim().toUpperCase().slice(0,1);
    const phi = KEY[q] && KEY[q][pick];
    if(!phi) continue;
    tally[phi] = (tally[phi]||0) + 1;
  }
  return tally;
}

// Pick winners with tie handling
function pickWinners(tally) {
  let max = 0; 
  Object.values(tally).forEach(v => { if(v>max) max=v; });
  if(max===0) return [];
  
  const tied = Object.keys(tally).filter(k => tally[k] === max);
  if(tied.length <= 1) return tied;
  
  // Deterministic order by TIE_ORDER
  tied.sort((a,b) => TIE_ORDER.indexOf(a) - TIE_ORDER.indexOf(b));
  return tied;
}

// Render results
function renderResult(winners, tally) {
  const resultDiv = document.getElementById('result');
  const scoreDump = document.getElementById('scoreDump');
  const leaderboard = document.getElementById('leaderboard');
  
  resultDiv.classList.remove('hide');
  leaderboard.classList.remove('hide');
  
  scoreDump.textContent = JSON.stringify(tally, null, 2);
  
  const blocks = winners.map(w => {
    // Map philosophy key to public title
    const titleMap = {
      "Stoicism":"Enduring Bloom", "Epicureanism":"Fragrance Seeker",
      "Confucianism":"Harmony", "Transcendentalism":"Moonlight Reverie",
      "Skepticism":"Veil Orchid", "Nihilism":"Vanishing Bloom",
      "Egoism":"Self Bloom", "Cynicism":"Wild Sprout",
      "Renaissance Humanism":"Orchid Muse", "Aristotelianism":"Ordered Bloom",
      "Traditionalism":"Legacy Bloom", "Pragmatism":"Grounded Root",
      "Altruism":"Gifted Orchid", "Idealism":"Vision Vine"
    };
    
    const pubTitle = titleMap[w] || w;
    const P = PHILOS[pubTitle];
    if(!P) return `<p>Missing content for ${w}</p>`;
    
    const [c1,c2] = P.palette||["#ddd","#eee"];
    return `
      <div class="card" id="result-${w.replace(/\s+/g, '-')}">
        <div class="hero">
          <img src="${P.badge}" alt="${pubTitle} badge" loading="lazy">
          <div class="meta">
            <span class="pill">${w}</span>
            <h2 style="margin:12px 0 8px">${pubTitle}</h2>
            <div class="small" style="opacity:.9;font-size:18px">${P.caption||''}</div>
            <div class="row" style="margin-top:12px;gap:8px">
              <span class="pill" style="background:#eef1ff;color:#2a2f6b">${c1}</span>
              <span class="pill" style="background:#fff7e8;color:#7a431e">${c2||''}</span>
            </div>
          </div>
        </div>

        <div class="grid" style="margin-top:20px">
          <div>
            <h3>Life Philosophy</h3>
            <p style="font-size:18px">${P.life||''}</p>
          </div>
          <div>
            <h3>Orchid Reflection</h3>
            <p style="font-size:18px">${P.reflect||''}</p>
          </div>
          <div class="haiku">${(P.haiku||'').replace(/\n/g,'<br>')}</div>
          <div class="two-col">
            <div>
              <h3>Practical Tip</h3>
              <p style="font-size:16px">${P.practical||''}</p>
            </div>
            <div>
              <h3>Botanical Note</h3>
              <p style="font-size:16px">${P.science||''}</p>
            </div>
          </div>
        </div>
        
        <div class="result-actions">
          <h3>Save & Share Your Results</h3>
          <button class="copy-btn" onclick="copyResult('${w}')">üìã Copy Results</button>
          <button class="download-btn" onclick="downloadCertificate('${w}', '${pubTitle}')">üìú Download Certificate</button>
        </div>
      </div>`;
  });
  
  resultDiv.innerHTML = blocks.join('');
  
  // Scroll to results
  setTimeout(() => {
    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);
}

// Copy results to clipboard
function copyResult(philosophy) {
  const titleMap = {
    "Stoicism":"Enduring Bloom", "Epicureanism":"Fragrance Seeker",
    "Confucianism":"Harmony", "Transcendentalism":"Moonlight Reverie",
    "Skepticism":"Veil Orchid", "Nihilism":"Vanishing Bloom",
    "Egoism":"Self Bloom", "Cynicism":"Wild Sprout",
    "Renaissance Humanism":"Orchid Muse", "Aristotelianism":"Ordered Bloom",
    "Traditionalism":"Legacy Bloom", "Pragmatism":"Grounded Root",
    "Altruism":"Gifted Orchid", "Idealism":"Vision Vine"
  };
  
  const pubTitle = titleMap[philosophy] || philosophy;
  const P = PHILOS[pubTitle];
  
  const text = `üå∫ My Orchid Philosophy: ${pubTitle}
${P.caption}

Life Philosophy: ${P.life}
Orchid Reflection: ${P.reflect}

${P.haiku}

Practical Tip: ${P.practical}
Botanical Note: ${P.science}

Discovered at: Five Cities Orchid Society Philosophy Quiz`;

  navigator.clipboard.writeText(text).then(() => {
    alert('Results copied to clipboard! üìã');
  }).catch(() => {
    alert('Could not copy to clipboard. Please select and copy manually.');
  });
}

// Download certificate
function downloadCertificate(philosophy, title) {
  const titleMap = {
    "Stoicism":"Enduring Bloom", "Epicureanism":"Fragrance Seeker",
    "Confucianism":"Harmony", "Transcendentalism":"Moonlight Reverie",
    "Skepticism":"Veil Orchid", "Nihilism":"Vanishing Bloom",
    "Egoism":"Self Bloom", "Cynicism":"Wild Sprout",
    "Renaissance Humanism":"Orchid Muse", "Aristotelianism":"Ordered Bloom",
    "Traditionalism":"Legacy Bloom", "Pragmatism":"Grounded Root",
    "Altruism":"Gifted Orchid", "Idealism":"Vision Vine"
  };
  
  const pubTitle = titleMap[philosophy] || philosophy;
  const P = PHILOS[pubTitle];
  
  const certificateContent = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    ORCHID PHILOSOPHY CERTIFICATE               ‚ïë
‚ïë                                                                ‚ïë
‚ïë                   üå∫ ${pubTitle} üå∫                   ‚ïë
‚ïë                                                                ‚ïë
‚ïë  This certifies that the bearer has discovered their unique    ‚ïë
‚ïë  orchid growing philosophy through careful self-reflection.    ‚ïë
‚ïë                                                                ‚ïë
‚ïë  Philosophy: ${philosophy}                               ‚ïë
‚ïë  Essence: ${P.caption}                                   ‚ïë
‚ïë                                                                ‚ïë
‚ïë  ${P.haiku.replace(/\n/g, '\n‚ïë  ')}                           ‚ïë
‚ïë                                                                ‚ïë
‚ïë  Awarded by: Five Cities Orchid Society                       ‚ïë
‚ïë  Date: ${new Date().toLocaleDateString()}                     ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Life Philosophy: ${P.life}

Orchid Reflection: ${P.reflect}

Practical Growing Tip: ${P.practical}

Scientific Insight: ${P.science}

Color Palette: ${P.palette.join(' + ')}
`;

  const blob = new Blob([certificateContent], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `FCOS-Orchid-Philosophy-${pubTitle.replace(/\s+/g, '-')}.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// Progress tracking
function updateProgress() {
  const answeredQuestions = document.querySelectorAll('input[type="radio"]:checked').length;
  const totalQuestions = 29;
  const progressPercentage = (answeredQuestions / totalQuestions) * 100;
  
  document.getElementById('quiz-progress').style.width = progressPercentage + '%';
  document.getElementById('progress-text').textContent = `${answeredQuestions} of ${totalQuestions} questions answered`;
  
  const submitBtn = document.getElementById('submit-btn');
  if (answeredQuestions === totalQuestions) {
    submitBtn.disabled = false;
    submitBtn.textContent = 'üå∫ Discover Your Philosophy';
  } else {
    submitBtn.disabled = true;
    submitBtn.textContent = `Answer ${totalQuestions - answeredQuestions} more questions`;
  }
}

// Initialize quiz
document.addEventListener('DOMContentLoaded', function() {
  console.log('üéØ Quiz initialization starting...');
  
  // Load quiz data from Google Sheets API
  loadQuizData().then(() => {
    console.log('‚úÖ Google Sheets data loaded, generating questions...');
    // Generate questions after data is loaded
    generateQuestions();
    // Add event listeners after questions are generated
    attachEventListeners();
    // Update progress to enable/disable submit button
    updateProgress();
  }).catch(error => {
    console.error('‚ùå Failed to load quiz data:', error);
    console.log('üìã Using fallback hardcoded data...');
    // Use fallback hardcoded data
    generateQuestions();
    // Add event listeners after questions are generated
    attachEventListeners();
    // Update progress to enable/disable submit button
    updateProgress();
  });
});

// Function to attach event listeners after questions are generated
function attachEventListeners() {
  // Add event listeners to radio buttons
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', function() {
      const currentQuestionCard = this.closest('.question-card');
      const nextQuestionCard = currentQuestionCard.nextElementSibling;
      
      if (nextQuestionCard && nextQuestionCard.classList.contains('question-card')) {
        setTimeout(() => {
          nextQuestionCard.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
        }, 200);
      }
      
      updateProgress();
    });
  });
  
  // Form submission
  document.getElementById('philosophyQuizForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submit-btn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'üå∏ Analyzing your philosophy...';
    
    // Collect answers
    const answers = {};
    for(let q=1; q<=29; q++) {
      const selected = document.querySelector(`input[name="question_${q}"]:checked`);
      if(selected) {
        answers[q] = selected.value;
      }
    }
    
    // Score and display results
    const tally = scoreAnswers(answers);
    const winners = pickWinners(tally);
    renderResult(winners, tally);
  });
  
  // Initial progress update
  updateProgress();
}

// Start quiz function for widget button
function startQuiz() {
  const questionsSection = document.querySelector('.card');
  if (questionsSection) {
    questionsSection.scrollIntoView({ 
      behavior: 'smooth', 
      block: 'start' 
    });
    
    // Focus on first question
    setTimeout(() => {
      const firstQuestion = document.querySelector('.question-card');
      if (firstQuestion) {
        firstQuestion.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'center' 
        });
      }
    }, 500);
  }
}

// Public function for external integration
window.computeAndRender = function(answersObj) {
  const tally = scoreAnswers(answersObj);
  const winners = pickWinners(tally);
  renderResult(winners, tally);
};
</script>
</body>
</html>