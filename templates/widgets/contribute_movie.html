<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contribute Movie - Hollywood Orchids</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    
    <style>
        .contribute-header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 2rem 0;
        }
        
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 0.5rem;
        }
        
        .form-control, .form-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 8px;
            padding: 0.75rem;
        }
        
        .form-control:focus, .form-select:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #e74c3c;
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(231, 76, 60, 0.25);
        }
        
        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .ai-generate-btn {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ai-generate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4);
        }
        
        .ai-generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .preview-section {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
            display: none;
        }
        
        .video-preview {
            width: 100%;
            height: 200px;
            border-radius: 8px;
            border: none;
            background: #000;
        }
        
        .help-text {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 0.25rem;
        }
        
        .required {
            color: #e74c3c;
        }
        
        .success-message {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid #27ae60;
            color: #27ae60;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .error-message {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Contribution Header -->
    <div class="contribute-header">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h1><i data-feather="plus-circle" class="me-2"></i>Contribute to Hollywood Orchids</h1>
                    <p class="lead">Share a movie or TV show that features orchids with our community</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container py-5">
        <div class="form-container">
            <!-- Success/Error Messages -->
            <div id="success-message" class="success-message">
                <i data-feather="check-circle" class="me-2"></i>
                <span id="success-text"></span>
            </div>
            
            <div id="error-message" class="error-message">
                <i data-feather="alert-circle" class="me-2"></i>
                <span id="error-text"></span>
            </div>
            
            <form id="contribute-form">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="title" class="form-label">Movie Title <span class="required">*</span></label>
                            <input type="text" class="form-control" id="title" required 
                                   placeholder="e.g., Adaptation (2002)">
                            <div class="help-text">Include the year in parentheses if known</div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="director" class="form-label">Director</label>
                            <input type="text" class="form-control" id="director" 
                                   placeholder="e.g., Spike Jonze">
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="year" class="form-label">Release Year</label>
                            <input type="number" class="form-control" id="year" min="1900" max="2030"
                                   placeholder="2002">
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="imdb_rating" class="form-label">IMDb Rating</label>
                            <input type="text" class="form-control" id="imdb_rating" 
                                   placeholder="7.7/10">
                            <div class="help-text">Optional - leave blank if unknown</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="video_url" class="form-label">YouTube URL <span class="required">*</span></label>
                    <input type="url" class="form-control" id="video_url" required 
                           placeholder="https://www.youtube.com/watch?v=..." 
                           onchange="previewVideo()">
                    <div class="help-text">Paste the full YouTube URL (trailer, clip, or full movie if available)</div>
                </div>
                
                <div class="form-group">
                    <label for="orchid_focus" class="form-label">Orchid Focus <span class="required">*</span></label>
                    <textarea class="form-control" id="orchid_focus" rows="2" required
                              placeholder="e.g., Ghost orchids (Dendrophylax lindenii) and orchid poaching"></textarea>
                    <div class="help-text">What specific orchids or botanical themes appear in the movie?</div>
                </div>
                
                <div class="form-group">
                    <label for="orchid_significance" class="form-label">Orchid Significance <span class="required">*</span></label>
                    <textarea class="form-control" id="orchid_significance" rows="2" required
                              placeholder="e.g., Central to plot - explores human obsession through rare orchid collecting"></textarea>
                    <div class="help-text">Why are orchids important to this movie's story?</div>
                </div>
                
                <div class="form-group">
                    <label for="description" class="form-label">Movie Description</label>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span></span>
                        <button type="button" class="ai-generate-btn" id="ai-generate" onclick="generateAIDescription()">
                            <i data-feather="zap" style="width: 16px; height: 16px;" class="me-1"></i>
                            AI Generate
                        </button>
                    </div>
                    <textarea class="form-control" id="description" rows="3"
                              placeholder="A brief description of the movie and how orchids fit into the story..."></textarea>
                    <div class="help-text">AI can help generate this based on your other inputs</div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="scientific_accuracy" class="form-label">Scientific Accuracy</label>
                            <select class="form-select" id="scientific_accuracy">
                                <option value="">Select accuracy level</option>
                                <option value="Very High">Very High - Documentary level</option>
                                <option value="High">High - Well researched</option>
                                <option value="Medium">Medium - Some accuracy</option>
                                <option value="Low">Low - Artistic license</option>
                                <option value="Unknown">Unknown</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="contributor_name" class="form-label">Your Name</label>
                            <input type="text" class="form-control" id="contributor_name" 
                                   placeholder="Your name (optional - leave blank to be Anonymous)">
                        </div>
                    </div>
                </div>
                
                <!-- Video Preview Section -->
                <div id="preview-section" class="preview-section">
                    <h5><i data-feather="play" class="me-2"></i>Video Preview</h5>
                    <iframe id="video-preview" class="video-preview"></iframe>
                </div>
                
                <div class="text-center mt-4">
                    <button type="submit" class="submit-btn" id="submit-btn">
                        <i data-feather="send" class="me-2"></i>
                        Submit Movie Contribution
                    </button>
                </div>
            </form>
        </div>
        
        <div class="text-center mt-4">
            <a href="/hollywood-orchids/" class="btn btn-outline-light">
                <i data-feather="arrow-left" class="me-2"></i>
                Back to Hollywood Orchids
            </a>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();
            console.log('📝 Movie contribution form initialized');
        });
        
        function previewVideo() {
            const videoUrl = document.getElementById('video_url').value;
            const videoId = extractYouTubeId(videoUrl);
            
            if (videoId) {
                const previewSection = document.getElementById('preview-section');
                const videoPreview = document.getElementById('video-preview');
                
                videoPreview.src = `https://www.youtube.com/embed/${videoId}`;
                previewSection.style.display = 'block';
                
                console.log('🎥 Video preview loaded:', videoId);
            }
        }
        
        function extractYouTubeId(url) {
            const patterns = [
                /(?:v=|\/)([0-9A-Za-z_-]{11}).*/,
                /(?:embed\/)([0-9A-Za-z_-]{11})/,
                /(?:v\/)([0-9A-Za-z_-]{11})/,
                /^([0-9A-Za-z_-]{11})$/
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) return match[1];
            }
            return null;
        }
        
        function generateAIDescription() {
            const aiBtn = document.getElementById('ai-generate');
            const descriptionField = document.getElementById('description');
            
            const title = document.getElementById('title').value;
            const director = document.getElementById('director').value;
            const year = document.getElementById('year').value;
            const orchidFocus = document.getElementById('orchid_focus').value;
            
            if (!title || !orchidFocus) {
                showError('Please fill in the movie title and orchid focus before generating AI description.');
                return;
            }
            
            aiBtn.disabled = true;
            aiBtn.innerHTML = '<i data-feather="loader" style="width: 16px; height: 16px;" class="me-1"></i> Generating...';
            
            // Make API call to generate description
            fetch('/hollywood-orchids/generate-description', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    title: title,
                    director: director,
                    year: year,
                    orchid_context: orchidFocus
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    descriptionField.value = data.description;
                    showSuccess('AI description generated successfully!');
                } else {
                    descriptionField.value = data.fallback_description || 'AI description generation failed.';
                    showError('AI description generation failed, but a basic description was provided.');
                }
            })
            .catch(error => {
                console.error('AI generation error:', error);
                showError('Failed to generate AI description. Please write one manually.');
            })
            .finally(() => {
                aiBtn.disabled = false;
                aiBtn.innerHTML = '<i data-feather="zap" style="width: 16px; height: 16px;" class="me-1"></i> AI Generate';
                feather.replace();
            });
        }
        
        document.getElementById('contribute-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i data-feather="loader" class="me-2"></i> Submitting...';
            
            // Gather form data
            const formData = {
                title: document.getElementById('title').value,
                director: document.getElementById('director').value,
                year: parseInt(document.getElementById('year').value) || new Date().getFullYear(),
                video_url: document.getElementById('video_url').value,
                orchid_focus: document.getElementById('orchid_focus').value,
                orchid_significance: document.getElementById('orchid_significance').value,
                description: document.getElementById('description').value,
                scientific_accuracy: document.getElementById('scientific_accuracy').value || 'Unknown',
                imdb_rating: document.getElementById('imdb_rating').value || 'Not rated',
                contributor_name: document.getElementById('contributor_name').value || 'Anonymous'
            };
            
            // Submit to API
            fetch('/hollywood-orchids/contribute', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccess(`Movie "${formData.title}" has been submitted successfully! Thank you for contributing.`);
                    
                    // Reset form after successful submission
                    setTimeout(() => {
                        window.location.href = '/hollywood-orchids/';
                    }, 3000);
                } else {
                    showError(data.error || 'Submission failed. Please check your inputs and try again.');
                }
            })
            .catch(error => {
                console.error('Submission error:', error);
                showError('Network error occurred. Please try again later.');
            })
            .finally(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i data-feather="send" class="me-2"></i> Submit Movie Contribution';
                feather.replace();
            });
        });
        
        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            const successText = document.getElementById('success-text');
            
            successText.textContent = message;
            successDiv.style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            
            errorText.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        // Auto-save to localStorage to prevent data loss
        const formFields = ['title', 'director', 'year', 'video_url', 'orchid_focus', 'orchid_significance', 'description', 'scientific_accuracy', 'imdb_rating', 'contributor_name'];
        
        formFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            
            // Load saved data
            const savedValue = localStorage.getItem(`contribute_${fieldId}`);
            if (savedValue) {
                field.value = savedValue;
            }
            
            // Save on change
            field.addEventListener('input', () => {
                localStorage.setItem(`contribute_${fieldId}`, field.value);
            });
        });
        
        // Clear localStorage on successful submission
        function clearFormData() {
            formFields.forEach(fieldId => {
                localStorage.removeItem(`contribute_${fieldId}`);
            });
        }
    </script>
</body>
</html>