<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hollywood Orchids - Cinema & Botanical Beauty</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    
    <style>
        .hollywood-header {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            color: white;
            padding: 3rem 0;
            position: relative;
            overflow: hidden;
        }
        
        .hollywood-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="70" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="80" r="1.5" fill="rgba(255,255,255,0.1)"/></svg>');
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .movie-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 0;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(142, 68, 173, 0.3);
            border-color: rgba(142, 68, 173, 0.5);
        }
        
        .video-container, .poster-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: #000;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
        }
        
        .movie-poster {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .poster-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.7));
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 1rem;
        }
        
        .poster-title {
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 0.5rem;
        }
        
        .poster-year {
            color: rgba(255,255,255,0.9);
            font-size: 0.9rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .video-frame {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .video-overlay:hover {
            background: rgba(0,0,0,0.5);
        }
        
        .play-btn {
            width: 60px;
            height: 60px;
            background: rgba(142, 68, 173, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .play-btn:hover {
            transform: scale(1.1);
            background: rgba(142, 68, 173, 1);
        }
        
        .movie-content {
            padding: 1.5rem;
        }
        
        .movie-title {
            color: #9b59b6;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .orchid-focus {
            background: rgba(39, 174, 96, 0.2);
            border-left: 3px solid #27ae60;
            padding: 0.5rem;
            margin: 1rem 0;
            border-radius: 0 5px 5px 0;
            font-size: 0.9em;
        }
        
        .movie-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .rating {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .expand-btn {
            background: rgba(52, 152, 219, 0.8);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .expand-btn:hover {
            background: rgba(52, 152, 219, 1);
            transform: scale(1.05);
        }
        
        .floating-player {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 400px;
            height: 300px;
            background: rgba(0,0,0,0.95);
            border-radius: 10px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        .floating-player.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .floating-header {
            background: rgba(142, 68, 173, 0.9);
            padding: 0.5rem;
            display: flex;
            justify-content: between;
            align-items: center;
            cursor: move;
        }
        
        .floating-title {
            color: white;
            font-size: 0.9em;
            font-weight: bold;
            flex: 1;
        }
        
        .floating-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .floating-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
        .floating-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .contribute-section {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 15px;
            padding: 2rem;
            margin: 3rem 0;
            text-align: center;
        }
        
        .contribute-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .contribute-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            color: white;
        }
        
        .stats-bar {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 10px;
            margin: 2rem 0;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat {
            flex: 1;
        }
        
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #9b59b6;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: #bbb;
        }
        
        /* Review System Styles */
        .review-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        
        .review-toggle {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .review-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .review-form {
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        
        .review-form.active {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .rating-group {
            margin: 1rem 0;
        }
        
        .star-rating {
            display: flex;
            gap: 0.2rem;
            margin: 0.5rem 0;
        }
        
        .star {
            font-size: 1.5em;
            color: #444;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .star:hover,
        .star.active {
            color: #f39c12;
            transform: scale(1.1);
        }
        
        .review-textarea {
            width: 100%;
            min-height: 80px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.8rem;
            color: white;
            resize: vertical;
        }
        
        .review-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.5rem;
            color: white;
            margin-bottom: 1rem;
        }
        
        .submit-review-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .submit-review-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .reviews-display {
            margin-top: 1.5rem;
        }
        
        .review-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .reviewer-name {
            font-weight: bold;
            color: #9b59b6;
        }
        
        .review-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9em;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        @media (max-width: 768px) {
            .floating-player {
                width: 90vw;
                height: 250px;
                top: 10px;
                right: 5vw;
            }
            
            .video-container {
                height: 150px;
            }
            
            .review-form {
                padding: 1rem;
            }
            
            .star-rating {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Hollywood Orchids Header -->
    <div class="hollywood-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-4 mb-3">🎬 Hollywood Orchids</h1>
                    <p class="lead mb-4">Discover how orchids have captivated filmmakers and audiences in cinema history</p>
                    <div class="d-flex flex-wrap gap-3">
                        <span class="badge bg-light text-dark px-3 py-2">🌺 Botanical Cinema</span>
                        <span class="badge bg-warning text-dark px-3 py-2">🎭 Movie Reviews</span>
                        <span class="badge bg-success px-3 py-2">🔬 Scientific Accuracy</span>
                    </div>
                </div>
                <div class="col-lg-4 text-center">
                    <div class="position-relative">
                        <i data-feather="film" style="width: 80px; height: 80px; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container py-5">
        <!-- Statistics Bar -->
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-number">{{ movies|length }}</div>
                <div class="stat-label">Movies Featured</div>
            </div>
            <div class="stat">
                <div class="stat-number">40+</div>
                <div class="stat-label">Years of Cinema</div>
            </div>
            <div class="stat">
                <div class="stat-number">🌺</div>
                <div class="stat-label">Orchid Species</div>
            </div>
            <div class="stat">
                <div class="stat-number">🎬</div>
                <div class="stat-label">User Contributions</div>
            </div>
        </div>

        <!-- Movie Cards -->
        <div class="row">
            {% for movie_key, movie in movies.items() %}
            <div class="col-lg-6 col-xl-4">
                <div class="movie-card" data-movie="{{ movie_key }}">
                    {% if movie.poster_drive_id %}
                    <div class="poster-container">
                        <img class="movie-poster" 
                             src="/api/drive-photo/{{ movie.poster_drive_id }}" 
                             alt="{{ movie.title }} poster"
                             onerror="this.src='/api/drive-photo/{{ movie.poster_alt_drive_id or movie.poster_drive_id }}'; if (this.src.includes('{{ movie.poster_alt_drive_id or movie.poster_drive_id }}')) this.style.display='none';">
                        <div class="poster-overlay">
                            <div class="poster-title">{{ movie.title }}</div>
                            <div class="poster-year">{{ movie.year }} • {{ movie.genre or 'Classic' }}</div>
                        </div>
                    </div>
                    {% else %}
                    <div class="video-container">
                        <iframe class="video-frame d-none" 
                                data-src="{{ movie.youtube_url }}" 
                                allowfullscreen>
                        </iframe>
                        <div class="video-overlay" onclick="loadVideo(this, '{{ movie.youtube_url }}')">
                            <div class="play-btn">
                                <i data-feather="play"></i>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="movie-content">
                        <h5 class="movie-title">{{ movie.title }}</h5>
                        <p class="text-muted small mb-1">Directed by {{ movie.director }}</p>
                        {% if movie.stars %}
                        <p class="text-muted small mb-2">Starring {{ movie.stars }}</p>
                        {% endif %}
                        
                        <p class="mb-2">{{ movie.description }}</p>
                        
                        <div class="orchid-focus">
                            <strong>🌺 Orchid Focus:</strong> {{ movie.orchid_focus }}
                        </div>
                        
                        <p class="small text-muted">
                            <strong>Significance:</strong> {{ movie.orchid_significance }}
                        </p>
                        
                        <div class="movie-meta">
                            <span class="rating">⭐ {{ movie.imdb_rating }}</span>
                            <div>
                                <button class="expand-btn me-2" onclick="expandToFloating('{{ movie_key }}')">
                                    <i data-feather="external-link" style="width: 16px; height: 16px;"></i>
                                    Float Player
                                </button>
                                <button class="expand-btn" onclick="fullscreen('{{ movie_key }}')">
                                    <i data-feather="maximize" style="width: 16px; height: 16px;"></i>
                                    Fullscreen
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-2">
                            <small class="text-muted">
                                Contributed by {{ movie.contributed_by }} • {{ movie.year }}
                            </small>
                        </div>
                        
                        <!-- Review Section -->
                        <div class="review-section">
                            <button class="review-toggle" onclick="toggleReviewForm('{{ movie_key }}')">
                                <i data-feather="star" style="width: 14px; height: 14px;"></i>
                                Write a Review
                            </button>
                            
                            <div id="review-form-{{ movie_key }}" class="review-form">
                                <form onsubmit="submitReview(event, '{{ movie_key }}')">
                                    <div class="rating-group">
                                        <label><strong>Overall Rating:</strong></label>
                                        <div class="star-rating" data-rating="rating-{{ movie_key }}">
                                            <span class="star" data-value="1">★</span>
                                            <span class="star" data-value="2">★</span>
                                            <span class="star" data-value="3">★</span>
                                            <span class="star" data-value="4">★</span>
                                            <span class="star" data-value="5">★</span>
                                        </div>
                                        <input type="hidden" name="rating" id="rating-{{ movie_key }}" required>
                                    </div>
                                    
                                    <div class="rating-group">
                                        <label><strong>Orchid Symbolism Rating:</strong></label>
                                        <div class="star-rating" data-rating="orchid-rating-{{ movie_key }}">
                                            <span class="star" data-value="1">🌺</span>
                                            <span class="star" data-value="2">🌺</span>
                                            <span class="star" data-value="3">🌺</span>
                                            <span class="star" data-value="4">🌺</span>
                                            <span class="star" data-value="5">🌺</span>
                                        </div>
                                        <input type="hidden" name="orchid_symbolism_rating" id="orchid-rating-{{ movie_key }}" required>
                                    </div>
                                    
                                    <input type="text" name="reviewer_name" placeholder="Your Name" class="review-input" required>
                                    <input type="email" name="reviewer_email" placeholder="Email (optional)" class="review-input">
                                    
                                    <textarea name="review_text" placeholder="Share your thoughts about the orchids in this movie..." class="review-textarea" required></textarea>
                                    
                                    <input type="text" name="favorite_orchid_scene" placeholder="Favorite orchid scene or moment (optional)" class="review-input">
                                    
                                    <div style="margin: 1rem 0;">
                                        <label>
                                            <input type="checkbox" name="would_recommend" checked style="margin-right: 0.5rem;">
                                            I would recommend this movie to other orchid enthusiasts
                                        </label>
                                    </div>
                                    
                                    <button type="submit" class="submit-review-btn">Submit Review</button>
                                </form>
                            </div>
                            
                            <div id="reviews-display-{{ movie_key }}" class="reviews-display">
                                <!-- Reviews will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Contribution Section -->
        <div class="contribute-section">
            <h3><i data-feather="plus-circle" class="me-2"></i>Share Your Orchid Movie Discovery!</h3>
            <p class="mb-4">Know a movie or TV show that features orchids? Help expand our Hollywood Orchids collection!</p>
            <a href="/widgets/hollywood-orchids/contribute" class="contribute-btn">
                <i data-feather="film" class="me-2"></i>
                Contribute a Movie
            </a>
        </div>
        
        <!-- Navigation -->
        <div class="text-center mt-4">
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <a href="/" class="btn btn-outline-light">
                    <i data-feather="home" class="me-2" style="width: 18px; height: 18px;"></i>
                    Homepage
                </a>
                <a href="/widgets/" class="btn btn-outline-info">
                    <i data-feather="grid" class="me-2" style="width: 18px; height: 18px;"></i>
                    Widget Gallery
                </a>
            </div>
        </div>
    </div>

    <!-- Floating Video Player -->
    <div id="floating-player" class="floating-player">
        <div class="floating-header" id="floating-header">
            <div class="floating-title" id="floating-title">Movie Player</div>
            <div class="floating-controls">
                <button class="floating-btn" onclick="minimizeFloating()" title="Minimize">
                    <i data-feather="minus" style="width: 16px; height: 16px;"></i>
                </button>
                <button class="floating-btn" onclick="expandFloating()" title="Expand">
                    <i data-feather="maximize" style="width: 16px; height: 16px;"></i>
                </button>
                <button class="floating-btn" onclick="closeFloating()" title="Close">
                    <i data-feather="x" style="width: 16px; height: 16px;"></i>
                </button>
            </div>
        </div>
        <div class="floating-content">
            <iframe id="floating-video" style="width: 100%; height: calc(100% - 40px); border: none;"></iframe>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let currentFloatingMovie = null;
        let isDragging = false;
        let currentX = 0;
        let currentY = 0;
        let initialX = 0;
        let initialY = 0;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();
            console.log('🎬 Hollywood Orchids initialized');
            
            // Make floating player draggable
            initializeDragging();
        });

        function loadVideo(overlay, videoUrl) {
            const container = overlay.parentElement;
            const iframe = container.querySelector('.video-frame');
            
            // Load video
            iframe.src = videoUrl;
            iframe.classList.remove('d-none');
            overlay.style.display = 'none';
            
            console.log('🎥 Video loaded:', videoUrl);
        }

        function expandToFloating(movieKey) {
            const movieData = {{ movies | tojson }};
            const movie = movieData[movieKey];
            
            if (!movie) return;
            
            const floatingPlayer = document.getElementById('floating-player');
            const floatingTitle = document.getElementById('floating-title');
            const floatingVideo = document.getElementById('floating-video');
            
            // Set content
            floatingTitle.textContent = movie.title;
            floatingVideo.src = movie.youtube_url + '?autoplay=1';
            
            // Show floating player
            floatingPlayer.classList.add('active');
            currentFloatingMovie = movieKey;
            
            console.log('🎪 Floating player opened for:', movie.title);
        }

        function fullscreen(movieKey) {
            const movieData = {{ movies | tojson }};
            const movie = movieData[movieKey];
            
            if (!movie) return;
            
            // Create fullscreen overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0,0,0,0.95);
                z-index: 2000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            `;
            
            const videoContainer = document.createElement('div');
            videoContainer.style.cssText = `
                width: 90vw;
                height: 90vh;
                max-width: 1200px;
                max-height: 675px;
                position: relative;
            `;
            
            const iframe = document.createElement('iframe');
            iframe.src = movie.youtube_url + '?autoplay=1';
            iframe.style.cssText = `
                width: 100%;
                height: 100%;
                border: none;
                border-radius: 10px;
            `;
            
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '<i data-feather="x"></i>';
            closeBtn.style.cssText = `
                position: absolute;
                top: -40px;
                right: 0;
                background: rgba(255,255,255,0.8);
                border: none;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            closeBtn.onclick = () => {
                document.body.removeChild(overlay);
            };
            
            videoContainer.appendChild(iframe);
            videoContainer.appendChild(closeBtn);
            overlay.appendChild(videoContainer);
            document.body.appendChild(overlay);
            
            // Initialize feather icons for the close button
            feather.replace();
            
            console.log('🎬 Fullscreen mode for:', movie.title);
        }

        function closeFloating() {
            const floatingPlayer = document.getElementById('floating-player');
            const floatingVideo = document.getElementById('floating-video');
            
            floatingPlayer.classList.remove('active');
            floatingVideo.src = '';
            currentFloatingMovie = null;
            
            console.log('❌ Floating player closed');
        }

        function minimizeFloating() {
            const floatingPlayer = document.getElementById('floating-player');
            floatingPlayer.style.height = '40px';
            document.getElementById('floating-video').style.display = 'none';
            
            console.log('➖ Floating player minimized');
        }

        function expandFloating() {
            const floatingPlayer = document.getElementById('floating-player');
            floatingPlayer.style.height = '300px';
            document.getElementById('floating-video').style.display = 'block';
            
            console.log('⬆️ Floating player expanded');
        }

        function initializeDragging() {
            const floatingHeader = document.getElementById('floating-header');
            const floatingPlayer = document.getElementById('floating-player');
            
            floatingHeader.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
            
            function dragStart(e) {
                if (e.target.closest('.floating-btn')) return;
                
                isDragging = true;
                initialX = e.clientX - currentX;
                initialY = e.clientY - currentY;
                
                floatingPlayer.style.cursor = 'grabbing';
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                
                // Keep within viewport
                const rect = floatingPlayer.getBoundingClientRect();
                const maxX = window.innerWidth - rect.width;
                const maxY = window.innerHeight - rect.height;
                
                currentX = Math.max(0, Math.min(currentX, maxX));
                currentY = Math.max(0, Math.min(currentY, maxY));
                
                floatingPlayer.style.transform = `translate(${currentX}px, ${currentY}px)`;
                floatingPlayer.style.top = '0';
                floatingPlayer.style.right = 'auto';
                floatingPlayer.style.left = '0';
            }
            
            function dragEnd() {
                isDragging = false;
                floatingPlayer.style.cursor = 'default';
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeFloating();
                
                // Close fullscreen if open
                const fullscreenOverlay = document.querySelector('div[style*="position: fixed"][style*="z-index: 2000"]');
                if (fullscreenOverlay) {
                    document.body.removeChild(fullscreenOverlay);
                }
            }
        });

        // Analytics tracking
        function trackMovieInteraction(movieKey, action) {
            console.log(`📊 Movie interaction: ${movieKey} - ${action}`);
            
            // In production, send to analytics service
            // analytics.track('movie_interaction', { movie: movieKey, action: action });
        }

        // Auto-hide floating player when scrolling (optional)
        let scrollTimeout;
        window.addEventListener('scroll', function() {
            const floatingPlayer = document.getElementById('floating-player');
            if (!floatingPlayer.classList.contains('active')) return;
            
            floatingPlayer.style.opacity = '0.7';
            
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                floatingPlayer.style.opacity = '1';
            }, 1000);
        });

        // Review System Functions
        function toggleReviewForm(movieKey) {
            const form = document.getElementById(`review-form-${movieKey}`);
            const isActive = form.classList.contains('active');
            
            if (isActive) {
                form.classList.remove('active');
            } else {
                form.classList.add('active');
                loadReviews(movieKey);
            }
        }

        function setupStarRatings() {
            document.querySelectorAll('.star-rating').forEach(rating => {
                const stars = rating.querySelectorAll('.star');
                const inputId = rating.getAttribute('data-rating');
                
                stars.forEach((star, index) => {
                    star.addEventListener('click', () => {
                        const value = index + 1;
                        document.getElementById(inputId).value = value;
                        
                        // Update visual state
                        stars.forEach((s, i) => {
                            if (i < value) {
                                s.classList.add('active');
                            } else {
                                s.classList.remove('active');
                            }
                        });
                    });
                    
                    star.addEventListener('mouseover', () => {
                        stars.forEach((s, i) => {
                            if (i <= index) {
                                s.style.color = '#f39c12';
                            } else {
                                s.style.color = '#444';
                            }
                        });
                    });
                });
                
                rating.addEventListener('mouseleave', () => {
                    const currentValue = document.getElementById(inputId).value;
                    stars.forEach((s, i) => {
                        if (i < currentValue) {
                            s.style.color = '#f39c12';
                        } else {
                            s.style.color = '#444';
                        }
                    });
                });
            });
        }

        async function submitReview(event, movieKey) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            formData.append('movie_key', movieKey);
            
            try {
                const response = await fetch('/widgets/hollywood-orchids/submit-review', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show success message
                    alert(result.message);
                    
                    // Reset form
                    form.reset();
                    document.querySelectorAll(`#review-form-${movieKey} .star`).forEach(star => {
                        star.classList.remove('active');
                        star.style.color = '#444';
                    });
                    document.querySelectorAll(`#review-form-${movieKey} input[type="hidden"]`).forEach(input => {
                        input.value = '';
                    });
                    
                    // Reload reviews
                    loadReviews(movieKey);
                    
                    // Hide form
                    document.getElementById(`review-form-${movieKey}`).classList.remove('active');
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Review submission error:', error);
                alert('Failed to submit review. Please try again.');
            }
        }

        async function loadReviews(movieKey) {
            try {
                const response = await fetch(`/widgets/hollywood-orchids/api/reviews/${movieKey}`);
                const data = await response.json();
                
                const container = document.getElementById(`reviews-display-${movieKey}`);
                
                if (data.stats.review_count === 0) {
                    container.innerHTML = '<p class="text-muted">No reviews yet. Be the first to review this movie!</p>';
                    return;
                }
                
                let html = `
                    <div class="review-stats">
                        <div class="stat-item">
                            <span>⭐</span>
                            <span>${data.stats.avg_rating}/5 overall</span>
                        </div>
                        <div class="stat-item">
                            <span>🌺</span>
                            <span>${data.stats.avg_orchid_rating}/5 orchid symbolism</span>
                        </div>
                        <div class="stat-item">
                            <span>📝</span>
                            <span>${data.stats.review_count} review(s)</span>
                        </div>
                    </div>
                `;
                
                data.reviews.forEach(review => {
                    const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
                    const orchidStars = '🌺'.repeat(review.orchid_symbolism_rating);
                    
                    html += `
                        <div class="review-card">
                            <div class="review-header">
                                <span class="reviewer-name">${review.reviewer_name}</span>
                                <span class="text-muted small">${review.created_at}</span>
                            </div>
                            <div class="mb-2">
                                <span title="Overall Rating">${stars}</span>
                                <span title="Orchid Symbolism" style="margin-left: 0.5rem;">${orchidStars}</span>
                            </div>
                            <p>${review.review_text}</p>
                            ${review.favorite_orchid_scene ? `<p class="small text-muted"><strong>Favorite scene:</strong> ${review.favorite_orchid_scene}</p>` : ''}
                            ${review.would_recommend ? '<p class="small text-success">✓ Recommends to orchid enthusiasts</p>' : ''}
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                console.error('Failed to load reviews:', error);
                document.getElementById(`reviews-display-${movieKey}`).innerHTML = 
                    '<p class="text-danger">Failed to load reviews.</p>';
            }
        }

        // Initialize star ratings when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setupStarRatings();
        });
    </script>
</body>
</html>