<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orchid Games Leaderboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #7A4B8E;
            margin: 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-card h3 {
            color: #7A4B8E;
            margin: 0 0 10px 0;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .filters {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .filter-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        select, button {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        button {
            background: #7A4B8E;
            color: white;
            border-color: #7A4B8E;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover {
            background: #6a3d7a;
        }
        .leaderboard-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        .leaderboard-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .table-header {
            background: #7A4B8E;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }
        .table-content {
            max-height: 600px;
            overflow-y: auto;
        }
        .leaderboard-row {
            display: grid;
            grid-template-columns: 60px 1fr 80px 80px 100px 120px;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        .leaderboard-row:hover {
            background: #f8f9fa;
        }
        .rank {
            font-weight: bold;
            color: #7A4B8E;
        }
        .rank.gold { color: #ffd700; }
        .rank.silver { color: #c0c0c0; }
        .rank.bronze { color: #cd7f32; }
        .player-name {
            font-weight: 600;
        }
        .score {
            text-align: center;
            font-weight: bold;
        }
        .percentage {
            text-align: center;
            font-weight: bold;
            color: #28a745;
        }
        .time {
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .top-players, .game-stats {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .top-players h3, .game-stats h3 {
            color: #7A4B8E;
            margin: 0 0 15px 0;
        }
        .top-player {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .top-player:last-child {
            border-bottom: none;
        }
        .game-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .game-stat:last-child {
            border-bottom: none;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        @media (max-width: 768px) {
            .leaderboard-container {
                grid-template-columns: 1fr;
            }
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            .leaderboard-row {
                grid-template-columns: 50px 1fr 60px 80px;
                font-size: 14px;
            }
            .time {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ Orchid Games Leaderboard</h1>
            <p>Top scores across all orchid educational games</p>
        </div>

        <div class="stats-grid" id="stats-grid">
            <div class="loading">Loading statistics...</div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label>Game Type</label>
                <select id="game-filter">
                    <option value="">All Games</option>
                    <option value="quiz">Quiz</option>
                    <option value="memory">Memory Match</option>
                    <option value="trivia">Trivia</option>
                    <option value="guess">Guess the Orchid</option>
                    <option value="crossword">Crossword</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Time Period</label>
                <select id="time-filter">
                    <option value="all">All Time</option>
                    <option value="daily">Today</option>
                    <option value="weekly">This Week</option>
                    <option value="monthly">This Month</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Limit</label>
                <select id="limit-filter">
                    <option value="10">Top 10</option>
                    <option value="25">Top 25</option>
                    <option value="50">Top 50</option>
                </select>
            </div>
            <button onclick="loadLeaderboard()">Update</button>
        </div>

        <div class="leaderboard-container">
            <div class="leaderboard-table">
                <div class="table-header">
                    üèÜ Leaderboard
                </div>
                <div class="table-content" id="leaderboard-content">
                    <div class="loading">Loading leaderboard...</div>
                </div>
            </div>

            <div class="sidebar">
                <div class="top-players">
                    <h3>üåü Top Players</h3>
                    <div id="top-players-content">
                        <div class="loading">Loading...</div>
                    </div>
                </div>

                <div class="game-stats">
                    <h3>üìä Game Statistics</h3>
                    <div id="game-stats-content">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function loadLeaderboard() {
            const gameType = document.getElementById('game-filter').value;
            const timePeriod = document.getElementById('time-filter').value;
            const limit = document.getElementById('limit-filter').value;
            
            const params = new URLSearchParams();
            if (gameType) params.append('game_type', gameType);
            if (timePeriod) params.append('time_period', timePeriod);
            if (limit) params.append('limit', limit);
            
            try {
                const response = await fetch(`/games/api/leaderboard?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    renderLeaderboard(data.leaderboard);
                    renderStats(data.stats);
                    renderTopPlayers(data.stats.top_players);
                    renderGameStats(data.stats.games_by_type);
                } else {
                    document.getElementById('leaderboard-content').innerHTML = '<div class="loading">Error loading leaderboard</div>';
                }
            } catch (error) {
                document.getElementById('leaderboard-content').innerHTML = '<div class="loading">Error loading leaderboard</div>';
            }
        }

        function renderLeaderboard(leaderboard) {
            if (leaderboard.length === 0) {
                document.getElementById('leaderboard-content').innerHTML = '<div class="loading">No scores found</div>';
                return;
            }
            
            const html = leaderboard.map(entry => {
                let rankClass = '';
                if (entry.rank === 1) rankClass = 'gold';
                else if (entry.rank === 2) rankClass = 'silver';
                else if (entry.rank === 3) rankClass = 'bronze';
                
                const timeDisplay = entry.completion_time 
                    ? `${Math.floor(entry.completion_time / 60)}:${(entry.completion_time % 60).toString().padStart(2, '0')}`
                    : '-';
                
                return `
                    <div class="leaderboard-row">
                        <div class="rank ${rankClass}">#${entry.rank}</div>
                        <div class="player-name">${entry.player_name}</div>
                        <div class="score">${entry.score}/${entry.max_score}</div>
                        <div class="percentage">${entry.percentage}%</div>
                        <div class="time">${timeDisplay}</div>
                        <div class="time">${entry.time_ago}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('leaderboard-content').innerHTML = html;
        }

        function renderStats(stats) {
            const html = `
                <div class="stat-card">
                    <h3>Total Games</h3>
                    <div class="stat-value">${stats.total_games}</div>
                </div>
                <div class="stat-card">
                    <h3>Recent Games</h3>
                    <div class="stat-value">${stats.recent_games}</div>
                    <small>Last 7 days</small>
                </div>
                <div class="stat-card">
                    <h3>Active Players</h3>
                    <div class="stat-value">${stats.top_players.length}</div>
                    <small>With 3+ games</small>
                </div>
                <div class="stat-card">
                    <h3>Game Types</h3>
                    <div class="stat-value">${stats.games_by_type.length}</div>
                    <small>Available</small>
                </div>
            `;
            
            document.getElementById('stats-grid').innerHTML = html;
        }

        function renderTopPlayers(topPlayers) {
            if (topPlayers.length === 0) {
                document.getElementById('top-players-content').innerHTML = '<div class="loading">No players found</div>';
                return;
            }
            
            const html = topPlayers.map(player => `
                <div class="top-player">
                    <span>${player.player_name}</span>
                    <span>${player.avg_percentage}% avg</span>
                </div>
            `).join('');
            
            document.getElementById('top-players-content').innerHTML = html;
        }

        function renderGameStats(gameStats) {
            if (gameStats.length === 0) {
                document.getElementById('game-stats-content').innerHTML = '<div class="loading">No stats found</div>';
                return;
            }
            
            const html = gameStats.map(game => `
                <div class="game-stat">
                    <span>${game.game_type}</span>
                    <span>${game.count} games</span>
                </div>
            `).join('');
            
            document.getElementById('game-stats-content').innerHTML = html;
        }

        // Load initial data
        loadLeaderboard();
        
        // Auto-refresh every 30 seconds
        setInterval(loadLeaderboard, 30000);
    </script>
</body>
</html>