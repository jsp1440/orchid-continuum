<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔬 Orchid Research Lab - AI Pattern Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        .research-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .analysis-section {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        
        .pattern-card {
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #FFD700;
            transition: all 0.3s ease;
        }
        
        .pattern-card:hover {
            transform: translateX(5px);
            background: rgba(255,255,255,0.2);
        }
        
        .hypothesis-card {
            background: rgba(76, 175, 80, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #4CAF50;
        }
        
        .observation-card {
            background: rgba(255, 193, 7, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #FFC107;
        }
        
        .insight-box {
            background: rgba(33, 150, 243, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(33, 150, 243, 0.3);
        }
        
        .filter-section {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .btn-ai-analyze {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-ai-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            color: white;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .results-section {
            display: none;
        }
        
        .significance-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .significance-high {
            background: #e74c3c;
            color: white;
        }
        
        .significance-medium {
            background: #f39c12;
            color: white;
        }
        
        .significance-low {
            background: #95a5a6;
            color: white;
        }
        
        .follow-up-questions {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .follow-up-questions ul {
            margin-bottom: 0;
            padding-left: 20px;
        }
        
        .pattern-type-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            margin-right: 10px;
            margin-bottom: 5px;
            display: inline-block;
        }
        
        .analysis-summary {
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .summary-stat {
            display: inline-block;
            margin: 0 20px;
            text-align: center;
        }
        
        .summary-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #FFD700;
        }
        
        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body class="bg-dark">
    <div class="container-fluid">
        <!-- Header -->
        <div class="research-container">
            <div class="text-center mb-4">
                <h1 class="mb-3">🔬 Orchid Research Laboratory</h1>
                <p class="lead">AI-Powered Pattern Analysis & Hypothesis Generation</p>
                <p class="mb-0">Discover hidden patterns in orchid data and generate testable research hypotheses</p>
            </div>
            
            <!-- Analysis Filters -->
            <div class="filter-section">
                <h4 class="mb-3"><i data-feather="filter"></i> Analysis Parameters</h4>
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Focus Genus</label>
                        <input type="text" class="form-control" id="genusFilter" placeholder="e.g., Cattleya, Dendrobium">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Geographic Region</label>
                        <input type="text" class="form-control" id="regionFilter" placeholder="e.g., South America">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Latitude Range</label>
                        <div class="row">
                            <div class="col-6">
                                <input type="number" class="form-control form-control-sm" id="latMin" placeholder="Min">
                            </div>
                            <div class="col-6">
                                <input type="number" class="form-control form-control-sm" id="latMax" placeholder="Max">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">&nbsp;</label>
                        <div>
                            <button class="btn btn-ai-analyze w-100" onclick="runPatternAnalysis()">
                                <i data-feather="zap"></i> Analyze Patterns
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Loading State -->
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner-border text-light mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Analyzing patterns...</span>
                </div>
                <h4>🧠 AI is analyzing your orchid data...</h4>
                <p>Identifying geographic clusters, phylogenetic patterns, and ecological relationships</p>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <!-- Analysis Summary -->
            <div class="research-container">
                <div class="analysis-summary" id="analysisSummary">
                    <h3 class="mb-4">📊 Analysis Summary</h3>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="summary-stat">
                                <div class="summary-number" id="totalObservations">0</div>
                                <div class="summary-label">Interesting Patterns</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="summary-stat">
                                <div class="summary-number" id="hypothesesCount">0</div>
                                <div class="summary-label">Research Hypotheses</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="summary-stat">
                                <div class="summary-number" id="geographicClusters">0</div>
                                <div class="summary-label">Geographic Clusters</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="summary-stat">
                                <div class="summary-number" id="multiRegionSpecies">0</div>
                                <div class="summary-label">Multi-Region Species</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Interesting Observations -->
            <div class="research-container">
                <div class="analysis-section">
                    <h3><i data-feather="eye"></i> Most Interesting Observations</h3>
                    <p>AI-identified patterns that warrant further investigation</p>
                    <div id="observationsContainer">
                        <!-- Observations will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Research Hypotheses -->
            <div class="research-container">
                <div class="analysis-section">
                    <h3><i data-feather="help-circle"></i> Generated Research Hypotheses</h3>
                    <p>Testable hypotheses based on detected patterns</p>
                    <div id="hypothesesContainer">
                        <!-- Hypotheses will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- AI Insights -->
            <div class="research-container">
                <div class="analysis-section">
                    <h3><i data-feather="brain"></i> AI Insights & Interpretations</h3>
                    <div id="aiInsightsContainer" class="insight-box">
                        <!-- AI insights will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Quick Research Suggestions -->
            <div class="research-container">
                <div class="analysis-section">
                    <h3><i data-feather="compass"></i> Suggested Research Directions</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <button class="btn btn-outline-light mb-2" onclick="exploreEcosystemComparison()">
                                🌍 Ecosystem Comparison Study
                            </button>
                            <br>
                            <button class="btn btn-outline-light mb-2" onclick="investigateEndemism()">
                                🏝️ Endemic Species Investigation
                            </button>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-outline-light mb-2" onclick="analyzeBloomingPatterns()">
                                🌸 Phenological Pattern Analysis
                            </button>
                            <br>
                            <button class="btn btn-outline-light mb-2" onclick="studyClimateAdaptation()">
                                🌡️ Climate Adaptation Study
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Custom Hypothesis Generator -->
        <div class="research-container">
            <div class="analysis-section">
                <h3><i data-feather="edit-3"></i> Custom Hypothesis Generator</h3>
                <p>Have an interesting observation? Let AI help generate testable hypotheses.</p>
                <div class="row">
                    <div class="col-md-8">
                        <textarea class="form-control mb-3" id="customObservation" rows="3" 
                                placeholder="Describe an interesting pattern you've observed... e.g., 'I noticed that Dendrobium species in Thailand seem to bloom earlier than those in the Philippines'"></textarea>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-ai-analyze w-100 h-100" onclick="generateCustomHypotheses()">
                            Generate Hypotheses
                        </button>
                    </div>
                </div>
                <div id="customHypothesesResult" class="mt-3">
                    <!-- Custom hypotheses will appear here -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function runPatternAnalysis() {
            const loadingSpinner = document.getElementById('loadingSpinner');
            const resultsSection = document.getElementById('resultsSection');
            
            // Show loading
            loadingSpinner.style.display = 'block';
            resultsSection.style.display = 'none';
            
            // Gather filters
            const filters = {
                genus: document.getElementById('genusFilter').value.trim(),
                region: document.getElementById('regionFilter').value.trim(),
                latitude_min: document.getElementById('latMin').value,
                latitude_max: document.getElementById('latMax').value
            };
            
            // Remove empty filters
            Object.keys(filters).forEach(key => {
                if (!filters[key]) delete filters[key];
            });
            
            try {
                const response = await fetch('/api/analyze-patterns', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(filters)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayResults(data);
                } else {
                    alert('Analysis failed: ' + data.error);
                }
                
            } catch (error) {
                console.error('Analysis error:', error);
                alert('Analysis failed: ' + error.message);
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }
        
        function displayResults(data) {
            const resultsSection = document.getElementById('resultsSection');
            const patterns = data.patterns;
            const summary = data.analysis_summary;
            
            // Update summary statistics
            document.getElementById('totalObservations').textContent = summary.total_observations;
            document.getElementById('hypothesesCount').textContent = summary.hypotheses_generated;
            document.getElementById('geographicClusters').textContent = summary.geographic_clusters;
            document.getElementById('multiRegionSpecies').textContent = summary.multi_region_species;
            
            // Display interesting observations
            displayObservations(patterns.interesting_observations || []);
            
            // Display hypotheses
            displayHypotheses(patterns.research_hypotheses || {});
            
            // Display AI insights
            displayAIInsights(patterns.ai_insights || {});
            
            // Show results
            resultsSection.style.display = 'block';
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function displayObservations(observations) {
            const container = document.getElementById('observationsContainer');
            
            if (observations.length === 0) {
                container.innerHTML = '<p class="text-center opacity-75">No significant patterns detected. Try adjusting your search criteria.</p>';
                return;
            }
            
            container.innerHTML = observations.map(obs => `
                <div class="observation-card">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="mb-1">${obs.title}</h5>
                        <span class="significance-badge significance-${obs.significance.toLowerCase()}">${obs.significance}</span>
                    </div>
                    <div class="pattern-type-badge">${obs.type.replace('_', ' ').toUpperCase()}</div>
                    <p class="mb-3">${obs.details}</p>
                    ${obs.follow_up_questions && obs.follow_up_questions.length > 0 ? `
                        <div class="follow-up-questions">
                            <strong>🤔 Research Questions:</strong>
                            <ul class="mt-2">
                                ${obs.follow_up_questions.map(q => `<li>${q}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        function displayHypotheses(hypotheses) {
            const container = document.getElementById('hypothesesContainer');
            
            if (!hypotheses.generated_hypotheses || hypotheses.generated_hypotheses.length === 0) {
                container.innerHTML = '<p class="text-center opacity-75">No testable hypotheses generated from current data.</p>';
                return;
            }
            
            container.innerHTML = hypotheses.generated_hypotheses.map((hyp, index) => `
                <div class="hypothesis-card">
                    <div class="pattern-type-badge">${hyp.type.replace('_', ' ').toUpperCase()}</div>
                    <h5 class="mb-3">Hypothesis ${index + 1}: ${hyp.hypothesis}</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <strong>🎯 Testable Prediction:</strong>
                            <p>${hyp.testable_prediction}</p>
                        </div>
                        <div class="col-md-6">
                            <strong>📊 Statistical Analysis:</strong>
                            <p>${hyp.statistical_test}</p>
                        </div>
                    </div>
                    <strong>📋 Data Needed:</strong>
                    <ul class="mt-2">
                        ${hyp.data_needed.map(data => `<li>${data}</li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }
        
        function displayAIInsights(insights) {
            const container = document.getElementById('aiInsightsContainer');
            
            if (!insights.ai_analysis) {
                container.innerHTML = '<p class="text-center opacity-75">AI analysis not available. Ensure OpenAI API key is configured.</p>';
                return;
            }
            
            container.innerHTML = `
                <h4>🧠 AI Analysis Results</h4>
                <div class="mt-3" style="white-space: pre-line; line-height: 1.6;">${insights.ai_analysis}</div>
                <hr class="my-4">
                <small class="opacity-75">Generated: ${new Date(insights.generated_at).toLocaleString()}</small>
            `;
        }
        
        async function generateCustomHypotheses() {
            const observation = document.getElementById('customObservation').value.trim();
            const resultContainer = document.getElementById('customHypothesesResult');
            
            if (!observation) {
                alert('Please enter an observation first.');
                return;
            }
            
            resultContainer.innerHTML = '<div class="text-center"><div class="spinner-border text-light" role="status"></div><p class="mt-2">Generating hypotheses...</p></div>';
            
            try {
                const response = await fetch('/api/hypothesis-generator', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        observation: observation,
                        context: {
                            source: 'user_input',
                            timestamp: new Date().toISOString()
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultContainer.innerHTML = `
                        <div class="hypothesis-card">
                            <h5>🔬 AI-Generated Hypotheses</h5>
                            <div style="white-space: pre-line; line-height: 1.6;">${data.generated_hypotheses}</div>
                        </div>
                    `;
                } else {
                    resultContainer.innerHTML = `<div class="alert alert-warning">${data.error}</div>`;
                }
                
            } catch (error) {
                console.error('Hypothesis generation error:', error);
                resultContainer.innerHTML = `<div class="alert alert-danger">Error generating hypotheses: ${error.message}</div>`;
            }
        }
        
        // Quick research direction functions
        function exploreEcosystemComparison() {
            alert('🌍 Ecosystem Comparison Study:\n\nFocus on species found in multiple geographic regions. Compare environmental factors, local adaptations, and population genetics to understand how orchids adapt to different ecosystems.');
        }
        
        function investigateEndemism() {
            alert('🏝️ Endemic Species Investigation:\n\nStudy genera restricted to single regions. Investigate historical biogeography, conservation status, and unique adaptations that led to geographic isolation.');
        }
        
        function analyzeBloomingPatterns() {
            alert('🌸 Phenological Pattern Analysis:\n\nExamine bloom timing across latitudes and climates. Test how photoperiod, temperature, and seasonal rainfall influence flowering synchronization.');
        }
        
        function studyClimateAdaptation() {
            alert('🌡️ Climate Adaptation Study:\n\nCompare orchids from different climate zones. Analyze morphological and physiological adaptations to temperature, humidity, and seasonal variation.');
        }
        
        // Initialize Feather icons
        feather.replace();
        
        console.log('🔬 Research Lab Dashboard initialized');
        console.log('Ready for AI-powered pattern analysis and hypothesis generation');
    </script>
</body>
</html>